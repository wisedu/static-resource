function getUploadedAttachment(){}(function(){var e,t,a,i,n,o,l,r,s,d,c,p,h,u,m,f,v,b,g;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapAdvancedQuery.defaults,a),this.$element=$(e),this.$element.attr("emap-role","advancedQuery").attr("emap-pagePath","").attr("emap-action",this.options.data.name),this.options._initCount=0,this.options._initCounter=0,t(this.$element,this.options)}return e.prototype.getValue=function(){return v(this.options)},e}(),t=function(e,t){var y=t.data.controls,x=[],k=[],w=BH_UTILS.NewGuid();a=function(){return 450},i=function(t){var a=t.$advanced,i=t.$advancedModal;a.on("click","[bh-advanced-query-role=addTime]",function(){n($(this))}),a.on("click","[bh-advanced-query-role=cancelAddTime]",function(){o($(this))}),a.on("click","[bh-advanced-query-role=advancedOpen]",function(){$(a).addClass("bh-active"),t.searchModel="advanced"}),a.on("click","[bh-advanced-query-role=advancedClose]",function(){$(a).removeClass("bh-active"),t.searchModel="easy"}),a.on("click","[bh-advanced-query-role=conditionDismiss]",function(){$(this).closest(".bh-advancedQuery-form-row").remove()}),a.on("click","[bh-advanced-query-role=addCondition]",function(){d(t),$("[bh-advanced-query-role=addDialog][data-guid="+t.guid+"]").jqxWindow("open")}),i.on("click","[bh-advanced-query-role=addDialogConfirm]",function(){m(t,f(t)),$("[bh-advanced-query-role=addDialog]").jqxWindow("close")}),i.on("click","[bh-advanced-query-role=addDialogCancel]",function(){$("[bh-advanced-query-role=addDialog]").jqxWindow("close")}),i.on("click","[bh-advanced-query-role=modalListRightBtn]",function(){c()}),i.on("click","[bh-advanced-query-role=modalListLeftBtn]",function(){p()}),a.on("keyup",".bh-advancedQuery-quick-search-wrap input[type=text]",function(i){var n=28*a.data("easyarray").length+1,o=$(this).outerWidth(),l=$(this).val(),r=$(this).offset(),s=$(".bh-advancedQuery-quick-select[data-guid="+t.guid+"]");return r.top+=28,13==i.keyCode?(s.css({height:0,"border-width":"0"}),void e.trigger("search",[v(t),t])):void(""==l?s.css({height:0,"border-width":"0"}):($(".bh-advancedQuery-easy-query",s).html(l),s.css({height:n+"px",width:o+"px","border-width":"1px",top:r.top,left:r.left})))}),$("[bh-advanced-query-role=advancedEasySelect][data-guid="+t.guid+"]").on("click","p",function(){var a=$(this).closest("[bh-advanced-query-role=advancedEasySelect]");a.height()>0&&a.css({height:0,"border-width":"0"}),e.trigger("search",[v(t,$(this).data("name")),t])}),a.on("click","[bh-advanced-query-role=easySearchBtn]",function(){e.trigger("search",[v(t),t])}),a.on("click","[bh-advanced-query-role=quickSearchForm] .bh-label-radio",function(){setTimeout(function(){e.trigger("search",[v(t),t])},200)}),a.on("click","[bh-advanced-query-role=advancedSearchBtn]",function(){v(t),e.trigger("search",[v(t),t])}),i.on("click",function(e){var t=e.target;0==$(t).closest(".bh-advancedQuery-quick-search-wrap").length&&$(".bh-advancedQuery-quick-select").css({height:0,"border-width":"0"})}),e.on("bhInputInitComplete",function(){t._initCounter++,t._initCounter==t._initCount&&(e.trigger("init",[t]),t.initComplete&&t.initComplete())}),$(document).on("click",function(e){var t=e.target;if(0==$(t).closest("[bh-advanced-query-role=advancedEasySelect]").length){var a=$(".bh-advancedQuery-quick-select");a.css({height:0,"border-width":"0"})}})},n=function(e){var t=e.closest(".bh-advancedQuery-addBlock");t.addClass("bh-active");var a=t.children("div[bh-advanced-query-role=addTime]");t.children("div[bh-advanced-query-role=addTimeGroup]").show(),a.hide()},o=function(e){var t=e.closest(".bh-advancedQuery-addBlock");t.removeClass("bh-active");var i=t.children("div[bh-advanced-query-role=addTimeGroup]");i.removeClass("bh-entryLeft").addClass("bh-outLeft"),t.children("div[bh-advanced-query-role=addTime]").addClass("bh-entryRight").show(),setTimeout(function(){i.removeClass("bh-outLeft").addClass("bh-entryLeft").hide()},a())},l=function(e,t){var a="",i="";e.length&&e.length>0?(i+="请输入",$(e).each(function(){i+=this.caption+"/",a+='<p data-name="'+this.name+'">搜索 <span class="bh-advancedQuery-easy-caption">'+this.caption+'</span> : <span class="bh-advancedQuery-easy-query"></span></p>'}),$(".bh-advancedQuery-quick-select[data-guid="+t.guid+"]").html(a),i=i.substring(0,i.length-1),$(".bh-advancedQuery-quick-search-wrap input[type=text]",t.$advanced).attr("placeholder",i)):$(".bh-advancedQuery-inputGroup",t.$advanced).hide()},r=function(e){var t=$("<div></div>");return $(e).each(function(e){("select"==this.xtype||"radiolist"==this.xtype||"checkboxlist"==this.xtype)&&(this.xtype="buttonlist"),t.append(s(this))}),t},s=function(e,a){var i=e;i.get=function(e){return i[e]};var n=i.get("xtype"),o=i.get("caption"),l=i.get("defaultBuilder"),r=i.get("url"),s=i.get("name"),d=i.get("hidden")?"hidden":"",c=(i.get("placeholder")?i.get("placeholder"):"",i.get("checkType"),i.get("checkSize"),i.get("dataSize"),i.get("checkExp"),i.get("format")?i.get("format"):"yyyy-MM-dd",$(' <div class="bh-advancedQuery-form-row bh-advancedQuery-h-28"><div class="bh-advancedQuery-groupName">'+o+'：</div><div class="bh-advancedQuery-groupList bh-label-radio-group"></div></div>'));a&&c.append('<a class="bh-bh-advancedQuery-group-dismiss" href="javascript:void(0)" bh-advanced-query-role="conditionDismiss"> <i class="icon-close iconfont"></i></a>');var p="";switch(n){case"tree":p+='<div xtype="{{xtype}}" data-name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" data-url="{{url}}" {{hidden}} ></div>';break;case"date-local":p+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM-dd" {{hidden}}></div>';break;case"date-ym":p+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM" {{hidden}}></div>';break;case"switcher":p+='<div xtype="{{xtype}}"  data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" {{hidden}}></div>';break;case"radiolist":p+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-radio" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"checkboxlist":p+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-checkbox" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"buttonlist":case"select":p+='<div xtype="{{xtype}}" data-name="{{name}}" data-url="{{url}}" data-builder="{{builder}}" data-alloption={{allOption}} data-caption="{{caption}}" {{hidden}}></div>';break;default:p+='<input class="bh-form-control" data-name="{{name}}" name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" xtype="text" type="text" {{hidden}} />'}return p=p.replace(/\{\{xtype\}\}/g,n).replace(/\{\{name\}\}/g,s).replace(/\{\{builder\}\}/g,l).replace(/\{\{caption\}\}/g,o).replace(/\{\{url\}\}/g,r).replace(/\{\{hidden\}\}/g,d?'style="display:none;"':"").replace(/\{\{allOption\}\}/g,t.allowAllOption),$(".bh-advancedQuery-groupList",c).html(p),c},u=function(e){var t=$("[bh-advanced-query-role=advanceSearchForm]",e.$advanced),a=[];return $("[xtype][data-name]",t).each(function(){a.push($(this).data("name"))}),a},d=function(e){var t=e.$advanced.data("modalarray"),a=u(e);if(t.length&&t.length>0){var i=$("[bh-advanced-query-role=addList]",e.$advancedModal),n="";$(t).each(function(){n+=$.inArray(this.name,a)>-1?' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+this.name+'" data-caption="'+this.caption+'" checked><i class="bh-choice-helper"></i>'+this.caption+"</label></div></li>":' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+this.name+'" data-caption="'+this.caption+'"><i class="bh-choice-helper"></i>'+this.caption+"</label></div></li>"}),i.html(n),h()}},c=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i="",n=$("input[type=checkbox]:checked",e);n.length>0&&(n.each(function(){var e=$(this).attr("name"),t=$(this).data("caption");i+=' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+e+'" data-caption="'+t+'"><i class="bh-choice-helper"></i>'+t+"</label></div></li>",$(this).closest("li").remove()}),a.append(i),h())},p=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i="",n=$("input[type=checkbox]:checked",a);n.length>0&&(n.each(function(){var e=$(this).attr("name"),t=$(this).data("caption");i+=' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+e+'" data-caption="'+t+'"><i class="bh-choice-helper"></i>'+t+"</label></div></li>",$(this).closest("li").remove()}),e.append(i),h())},h=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i=$("input[type=checkbox]",e).length,n=$("input[type=checkbox]",a).length;$(".bh-advancedQuery-dialog-list-head span",e).html(i),$(".bh-advancedQuery-dialog-list-head span",a).html(n)},f=function(e){var t=$("[bh-advanced-query-role=addList]",e.$advancedModal),a=$("input[type=checkbox]:checked",t),i={};return $(a).each(function(){i[$(this).attr("name")]=""}),i},m=function(e,t){var a=$("[bh-advanced-query-role=advanceSearchForm]",e.$advanced),i=$("[bh-advanced-query-role=dropDownBtnWrap]",a);$(e.$advanced.data("modalarray")).each(function(){var e=$("[data-name="+this.name+"]",a);if(void 0!==t[this.name]&&null!=t[this.name]){if(e.length>0)return!0;i.before(s(this))}else e.length>0&&e.closest(".bh-advancedQuery-form-row").remove()}),a.emapFormInputInit();for(var n in t){if(!t[n])return!0;var o=$("[data-name="+n+"]",a),l=o.attr("xtype");WIS_EMAP_SERV._setEditControlValue(o,n,l,t,"")}},v=function(e,t){var a=[],i=e.$advanced.data("easyarray"),n=e.$advanced.data("modalarray"),o=[];if("easy"==e.searchModel){var l=$(".bh-advancedQuery-quick-search-wrap input",e.$advanced).val();if(""!=$.trim(l))if(t){var r=b(t,i);a.push({caption:r.caption,name:r.name,value:l,builder:"include",linkOpt:"AND"})}else{for(var s=0;s<i.length;s++)o.push({caption:i[s].caption,name:i[s].name,value:l,builder:"include",linkOpt:"OR"});a.push(o)}a=a.concat(g($("[bh-advanced-query-role=quickSearchForm]",e.$advanced)))}else if("advanced"==e.searchModel){var d=$("[bh-advanced-query-role=advancedInput]",e.$advanced).val();if(""!=$.trim(d)){for(var s=0;s<n.length;s++)n[s].xtype&&"text"!=n[s].xtype||o.push({caption:n[s].caption,name:n[s].name,value:d,builder:n[s].defaultBuilder,linkOpt:"OR"});a.push(o)}a=a.concat(g($("[bh-advanced-query-role=advanceSearchForm]",e.$advanced)))}return JSON.stringify(a)},g=function(e){for(var t=[],a=$("[xtype]",e),i=0;i<a.length;i++){var n={};switch($(a[i]).attr("xtype")){case"radiolist":n.value=$("input[type=radio]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"checkboxlist":n.value=$("input[type=checkbox]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"tree":n.value=$(a[i]).emapDropdownTree("getValue");break;case"buttonlist":n.value=$(".bh-label-radio.bh-active",a[i]).data("id");break;default:n.value=$(a[i]).val()}"ALL"!=n.value&&""!=$.trim(n.value)&&(n.name=$(a[i]).data("name"),n.caption=$(a[i]).data("caption"),n.builder=$(a[i]).data("builder"),n.linkOpt="AND",t.push(n))}return t},b=function(e,t){for(var a=0;a<t.length;a++)if(t[a].name==e)return t[a]},e.css({position:"relative","z-index":358}).html('<div class="bh-advancedQuery bh-mb-16" bh-advanced-query-role="advancedQuery"><div class="bh-advancedQuery-dropDown "><div class="" style="display: table-cell"><div class="bh-advancedQuery-form" bh-advanced-query-role="advanceSearchForm" ><div class="bh-advancedQuery-form-row bh-advancedQuery-h-28"><div class="bh-advancedQuery-groupName">关键词：</div><div class="bh-advancedQuery-groupList"><input type="text" bh-advanced-query-role="advancedInput" class="bh-form-control"></div></div><div class="bh-advancedQuery-form-row bh-advancedQuery-form-btn-row bh-advancedQuery-h-28" bh-advanced-query-role="dropDownBtnWrap"> <div class="bh-advancedQuery-groupName"></div><div class="bh-advancedQuery-groupList"><a class="bh-btn bh-btn-primary" bh-advanced-query-role="advancedSearchBtn" href="javascript:void(0)">执行高级搜索</a><a class="bh-btn bh-btn-default" bh-advanced-query-role="addCondition" href="javascript:void(0)">添加搜索字段</a><a class="bh-mh-4" bh-advanced-query-role="advancedClose" href="javascript:void(0)">[关闭高级搜索]</a></div></div></div></div></div><div class="bh-advancedQuery-quick"><div class="bh-advancedQuery-inputGroup bh-clearfix"><div class="bh-advancedQuery-quick-search-wrap" ><input type="text" class="bh-form-control"/><i class="iconfont icon-search" style="position: absolute;left: 6px;top: 6px;"></i></div><a class="bh-btn bh-btn bh-btn-primary bh-btn-small" bh-advanced-query-role="easySearchBtn" href="javascript:void(0);">搜索</a><a href="javascript:void(0);" class="bh-mh-8" bh-advanced-query-role="advancedOpen">[高级搜索]</a></div><div class="bh-advancedQuery-form bh-mt-8" bh-advanced-query-role="quickSearchForm"></div></div><div class="bh-advancedQuery-dialog" bh-advanced-query-role="addDialog" data-guid="'+w+'"><div class="bh-advancedQuery-dialog-head">添加搜索字段</div><div class="bh-advancedQuery-dialog-content bh-row"><ul class="bh-advancedQuery-dialog-list" bh-advanced-query-role="addList"></ul></div><a href="javascript:void(0)" bh-advanced-query-role="addDialogConfirm" class="bh-btn bh-btn-primary" >添加完成</a><a href="javascript:void(0)" bh-advanced-query-role="addDialogCancel" class="bh-btn bh-btn-default" >取消</a></div></div>'),t.$advanced=$("div[bh-advanced-query-role=advancedQuery]",e).css({overflow:"hidden"}),t.guid=w,$("body").append('<div class="bh-advancedQuery-quick-select" bh-advanced-query-role="advancedEasySelect" data-guid="'+w+'" ></div>'),$("[bh-advanced-query-role=addDialog]",t.$advanced).jqxWindow({resizable:!1,draggable:!1,isModal:!0,modalOpacity:.3,width:548,height:400,autoOpen:!1}),t.$advancedModal=$("[bh-advanced-query-role=addDialog][data-guid="+t.guid+"]"),i(t);var F="";$(y).each(function(e){var a=y.indexOf(this);return this.get("hidden")?(y.splice(a,1),!0):(this.xtype&&"text"!=this.xtype?t._initCount++:F+=this.caption+"/",void(this.quickSearch&&(this.xtype&&"text"!=this.xtype?k.push(this):x.push(this))))}),$("[bh-advanced-query-role=advancedInput]",e).attr("placeholder",F.substr(0,F.length-1)),t.$advanced.data("modalarray",y),t.$advanced.data("easyarray",x),t.$advanced.data("quickarray",k),"easy"==t.searchModel&&(t._initCount=k.length),0==x.length&&0==k.length&&console.warn("没有配置快速搜索字段,所以高级搜索控件无法展示!"),l(x,t),k=JSON.parse(JSON.stringify(k)),$("[bh-advanced-query-role=quickSearchForm]",t.$advanced).html(r(k)).emapFormInputInit({root:""}),m(t,t.defaultItem)},$.fn.emapAdvancedQuery=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return $(this).data("plugin",new e(this,t))})},$.fn.emapAdvancedQuery.defaults={allowAllOption:!0,defaultItem:[],searchModel:"easy"}}).call(this),function(){function e(e,t){t.token&&null!=t.token?(t.scope=t.token.substring(0,t.token.length-1),t.displayAvatar=t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+t.token+".do?date="+(new Date).getTime(),t.newToken=!1):(t.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),t.token=t.scope+1,t.displayAvatar=t.defaultAvatar,t.newToken=!0),t.$wrap=$('<div class="bh-emapAvatar-wrap"><img class="bh-emapAvatar-avatar" src="'+t.displayAvatar+'"><a class="bh-emapAvartar-btn" href="javascript:void(0)">修改头像</a></div>').css({height:t.width/t.ratio,width:t.width}),e.append(t.$wrap),a(e,t)}var t,a;t=function(){function t(t,a){this.options=$.extend({},$.fn.emapAvatarUpload.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.destroy=function(){this.options=null,$(this.$element).data("emapAvatarUpload",!1).empty()},t.prototype.getValue=function(){},t}(),a=function(e,t){var a=t.$wrap;a.on("click",".bh-emapAvartar-btn",function(){$.emapAvatarUploadWindow(e,t)}),$(".bh-emapAvatar-avatar",e).one("error",function(){$(this).attr("src",t.defaultAvatar)})},$.fn.emapAvatarUpload=function(e,a){var i;return i=$(this).data("emapAvatarUpload"),i?e===!0?i:"string"===$.type(e)?i[e](a):this:this.each(function(){return"destroy"==e?this:$(this).data("emapAvatarUpload",new t(this,e))})},$.fn.emapAvatarUpload.defaults={storeId:"image",contextPath:"/emap",defaultAvatar:"../u20.png",ratio:1,width:100,type:["jpg","png","gif"],size:5120},$.emapAvatarUploadWindow=function(e,t){function a(e,t){e.cropper({aspectRatio:t.ratio,viewMode:1,movable:!1,zoomOnWheel:!1,preview:".bh-emapAvatar-preview"})}function i(t){t.fileId?n(t).success&&o(t).success&&l(t).success&&r(t).success&&(t.onSubmit&&t.onSubmit(t.token),$(".bh-emapAvatar-avatar",e).attr("src",t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+t.token+".do?date="+(new Date).getTime()),t.displayAvatar=t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+t.token+".do?date="+(new Date).getTime()):t.newToken?t.onSubmit&&t.onSubmit():t.onSubmit&&t.onSubmit(t.token)}function n(e){return s(e.contextPath+"/sys/emapcomponent/file/cutTempFile/"+e.scope+"/"+e.token+"/"+e.fileId+".do",$(".bh-avatar-img",e.winContent).cropper("getData",!0))}function o(e){return e.fileId?s(e.contextPath+"/sys/emapcomponent/file/deleteTempFile/"+e.scope+"/"+e.token+"/"+e.fileId+".do",{}):{success:!0}}function l(e){return s(e.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+e.token+".do",{})}function r(e){return s(e.contextPath+"/sys/emapcomponent/file/saveAttachment/"+e.scope+"/"+e.token+".do",{attachmentParam:JSON.stringify({storeId:e.storeId})})}function s(e,t){var a;return $.ajax({type:"post",data:t,url:e,dataType:"json",async:!1}).done(function(e){a=e}).fail(function(e){a=e}),a}t.winContent=$('<div id="emapAvatarUploadWindow"><ul style="display: none;"><li>本地上传</li><li>推荐头像</li></ul><div><div class="bh-emapAvatar-local"></div></div><div></div>');var d=function(e,t){var i="FileReader"in window;e.fileupload({url:t.uploadUrl,autoUpload:!0,multiple:!1,dataType:"json",limitMultiFileUploads:1,formData:{size:t.size,type:t.type,storeId:t.storeId},submit:function(e,a){var n=a.files[0];return $(".bh-emapAvatar-text-info",t.winContent).show(),$(".bh-emapAvatar-text-error",t.winContent).hide(),t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(n.name.toUpperCase())?($(".bh-emapAvatar-text-info",t.winContent).hide(),$(".bh-emapAvatar-text-error",t.winContent).html("文件类型不正确").show(),!1):i&&t.size&&n.size/1024>t.size?($(".bh-emapAvatar-text-info",t.winContent).hide(),$(".bh-emapAvatar-text-error",t.winContent).html("文件大小超出限制").show(),!1):void $(".bh-emapAvatar-loader",t.winContent).jqxLoader("open")},done:function(e,i){i.files[0];i.result.success&&($(".bh-avatar-img",t.winContent).attr("src",i.result.tempFileUrl).cropper("destroy"),a($(".bh-avatar-img",t.winContent),t),$(".bh-avatar-img-block",t.winContent).show(),o(t),t.fileId=i.result.id),$(".bh-emapAvatar-loader",t.winContent).jqxLoader("close")},fail:function(e,a){a.files[0];$(".bh-emapAvatar-loader",t.winContent).jqxLoader("open")}})};t.uploadUrl=t.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+t.scope+"/"+t.token+".do",$(".bh-emapAvatar-local",t.winContent).html('<div class="bh-emapAvatar-editArea" bh-avatar-role="editArea"><div class="bh-emapAvatar-upload-block"><a href="javascript:void(0)" class="bh-btn bh-btn-default bh-emapAvatar-upload"><i class="iconfont icon-add"></i>选择图片<input type="file"></a><p class="bh-text-caption bh-color-caption bh-text-center bh-emapAvatar-text-info"></p><p class="bh-text-caption bh-color-danger bh-text-center bh-emapAvatar-text-error"></p></div><div class="bh-avatar-img-block"><img class="bh-avatar-img" src="'+t.displayAvatar+'" style="display: none;"><p ><a href="javascript:void(0)" class="bh-emapAvatar-reUpload">重新上传</a> </p></div><div class="bh-emapAvatar-loader"></div></div><div class="bh-emapAvatar-display"><div class="bh-emapAvatar-preview-100 bh-emapAvatar-preview"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-mb-8"></p><div><div class="bh-emapAvatar-preview-40 bh-pull-left bh-emapAvatar-preview" style="margin-right: 8px;"><div class="bh-emapAvatar-preview-div"></div></div><div class="bh-emapAvatar-preview-40 bh-pull-left bh-emapAvatar-preview" style="border-radius: 50%;"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-clearfix bh-mb-8"></p><div class="bh-emapAvatar-preview-28 bh-pull-left bh-emapAvatar-preview" style="margin-right: 8px;"><div class="bh-emapAvatar-preview-div"></div></div><div class="bh-emapAvatar-preview-28 bh-pull-left bh-emapAvatar-preview" style="border-radius: 50%;"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-clearfix bh-mb-8"></p></div></div>'),$(".bh-avatar-img",t.winContent).one("error",function(){$(this).attr("src",t.defaultAvatar)}).on("load",function(){a($(this),t)}),BH_UTILS.bhWindow(t.winContent,"头像上传",void 0,{width:"560px",close:function(){$(".bh-avatar-img",t.winContent).cropper("destroy")}},function(){i(t)}),$(".bh-emapAvatar-preview",t.winContent).each(function(){var e=$(this).width(),a=parseInt($(this).width()/t.ratio),i=$(this).next("p");$(this).css({height:a}),i.length>0&&i.html(e+" * "+a+"px")});var c=t.type.join("、").toUpperCase(),p=t.size>1024?t.size/1024+"M":t.size+"K";$(".bh-emapAvatar-text-info",t.winContent).html("只支持"+c+"，大小不超过"+p),$(".bh-emapAvatar-loader",t.winContent).jqxLoader({}),d($("input[type=file]",t.winContent),t),$(".bh-emapAvatar-reUpload",t.winContent).on("click",function(){$("input[type=file]",t.winContent).click()})}}.call(void 0),function(e){function t(e,t){a(t),i(e,t)}function a(e){var t='<div>	<div class="bh-emapCard-card-list"></div>	<div class="bh-emapCard-card-pagination" style="clear:both;"></div></div>';e.html(t)}function i(t,a,l,c){var c=parseInt(c||d.pageSize||s||t.pageSize||12),l=parseInt(l||d.pageNumber||r||t.pageNumber||0);r=l,s=c;var p=e.extend({},t.params,{pageSize:c,pageNumber:l+1,querySetting:d.querySetting}),h=n(t.pagePath,t.action);e.ajax({url:h.url,data:p}).done(function(e){var n=e.datas[t.action].totalSize,r=e.datas[t.action].rows;a.find(".bh-emapCard-card-list").empty();for(var s=0;s<r.length;s++)a.find(".bh-emapCard-card-list").append(o(t.template,r[s]));a.find(".bh-emapCard-card-pagination").pagination({pagenum:l,pagesize:c,totalSize:n,pageSizeOptions:t.pageSizeOptions}),a.find(".bh-emapCard-card-pagination").off("pagersearch").on("pagersearch",function(e,n,o,l){o=parseInt(o),i(t,a,n+"",o),t.pageSizeOptionsChange&&t.pageSizeOptionsChange(o,n)})})}function n(t,a){var i=null,n=null;e.ajax({url:t,async:!1}).done(function(e){i=e});for(var o=0;o<i.models.length;o++)if(i.models[o].name==a){n=i.models[o];break}return n}function o(e,t){var a=null;return a="object"==typeof e?e:Hogan.compile(settings.template),a.render(t)}var l,r=null,s=null,d={};l=function(){function a(a,i){this.settings=e.extend({},e.fn.emapCard.defaults,i),this.$element=e(a),t(this.settings,this.$element)}return a}(),l.prototype={reload:function(e){d=e||d,i(this.settings,this.$element,null,null,d)}},e.fn.emapCard=function(t,a){var i;return(i=this.data("emapCard"))?t===!0?i:("string"===e.type(t)&&i[t](a),this):this.each(function(){return e(this).data("emapCard",new l(this,t))})},e.fn.emapCard.defaults={template:"no template!",pagePath:null,action:null,pageSizeOptions:[12,24,48,96],pageSize:12,params:{}}}(jQuery),function(){function e(e){var a=$.extend({},e.settings);try{delete a.pk,delete a.url,delete a.pagePath,delete a.params,delete a.datamodel,delete a.method,delete a.action,delete a.customColumns}catch(i){}var n=new $.jqx.dataAdapter(e.source,{formatData:function(e){a.pageable&&(e.pageSize=e.pagesize,e.pageNumber=e.pagenum+1);var t="+";return a.sortable&&e.sortdatafield&&e.sortorder&&("asc"==e.sortorder?t="+":"desc"==e.sortorder&&(t="-"),e["*order"]=t+e.sortdatafield.split("_DISPLAY")[0]),delete e.pagesize,delete e.pagenum,delete e.filterslength,delete e.sortdatafield,delete e.sortorder,e},downloadComplete:function(t,a,i){return"undefined"!=typeof t.loginURL&&""!=t.loginURL?void(window.location.href=t.loginURL):(e.source.totalRecords=t.datas[e.settings.action].totalSize||t.datas[e.settings.action].total_size,void e.$element.data("tableResult",t))}}),o=a.ready,l=a.rendered;a.columns=t(e,a,o,l),a.source=n,e.$element.jqxDataTable(a),e.$element.on("sort",function(t){var a=t.args;e.$element.data("sortfield",a)})}function t(e,t,i,n){var o=[],l=e.settings.datamodel||WIS_EMAP_SERV.getModel(e.settings.pagePath,e.settings.action,"grid");e.$element.attr("emap-pagePath",e.settings.pagePath).attr("emap-action",e.settings.action).attr("emap-url",WIS_EMAP_SERV.url).attr("emap-name",WIS_EMAP_SERV.name).attr("emap-app-name",WIS_EMAP_SERV.appName).attr("emap-model-name",WIS_EMAP_SERV.modelName);var r=0,s=e.settings.customColumns;"undefined"!=typeof s&&null!=s&&(r=s.length);for(var d=[],c=null,p=[],h=0;r>h;h++){var u=s[h].colIndex,m=s[h].colField,f=s[h].type;if("last"==u)c=s[h];else if("undefined"!=typeof m&&""!=m)for(var v=0;v<l.length;v++)l[v].name==m&&(l[v].custom=s[h]);else"undefined"!=u&&(u=0>u?0:u,"link"!=f?d[u]={custom:s[h]}:p.push({colIndex:u,column:s[h]}))}for(var b=0;b<l.length;b++)("function"==typeof l[b].get&&l[b].get("hidden")===!0||l[b].hidden===!0||l[b]["grid.hidden"]===!0)&&(e.source.datafields.push({name:l[b].name,type:"string"}),"undefined"!=typeof l[b].url&&e.source.datafields.push({name:l[b].name+"_DISPLAY",type:"string"}),l.splice(b,1),b--);for(var g=0;g<d.length;g++)void 0==d[g]&&(l.length>0?d[g]=l.shift():(d.splice(g,1),g--));l.length>0&&(d=d.concat(l)),null!=c&&d.push({custom:c});for(var y,x=0;x<d.length;x++){for(var k=0;k<p.length;k++)x==p[k].colIndex&&(d[x].custom=p[k].column);"undefined"!=typeof d[x].name&&e.source.datafields.push({name:d[x].name,type:"string"}),"undefined"!=typeof d[x].url?(y=d[x].name+"_DISPLAY",e.source.datafields.push({name:y,type:"string"})):y=d[x].name;var w=null,F={};if(void 0==d[x].custom)w=void 0==d[x]["grid.width"]?null:d[x]["grid.width"],w&&(F={width:w}),o.push($.extend({},{text:d[x].caption,datafield:y,cellsRenderer:function(e,t,a,i){return'<span title="'+a+'">'+a+"</span>"}},F));else{var f=d[x].custom.type,C=d[x].custom.showCheckAll;w=d[x].custom.width,void 0==w&&(w=void 0==d[x]["grid.width"]?null:d[x]["grid.width"]),w&&(F={width:w}),o.push(a(f,e,t,C,F,d[x],y,i,n))}}return o}function a(e,t,a,n,o,l,r,s,d){var c=null;switch(e){case"checkbox":c={text:"checkbox",width:"32px",cellsAlign:"center",align:"center",renderer:function(e,t,a){var i='<div class="selectAllCheckboxFlag bh-checkbox bh-mh-8"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return n===!1?" ":i},rendered:function(e,a,i){return e.on("click","input",function(e){var a=t.$element,i=a.find("table"),n=i.find("div.bh-checkbox"),o=$(this);o.hasClass("selectFlag")?(o.prop("checked",!1).removeClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!1)})):(o.prop("checked",!0).addClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!0)})),$(this).trigger("checkall"),e.stopPropagation()}),!0},cellsRenderer:function(e,t,a,i){var n='<div data-sss="" class="bh-checkbox bh-mh-4" style="margin-left:0 !important;"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return n}},a.rendered=function(){var e=t.$element,a=e.find("table"),i=a.find("div.bh-checkbox"),n=!0;0==i.length&&(n=!1),i.each(function(){var e=$(this);return 0===e.find("input[checked]").length?void(n=!1):void 0});var o=e.find("div.selectAllCheckboxFlag").find("input");o.hasClass("selectFlag")&&i.find("input").attr("checked",!0),"function"==typeof d&&d()},a.ready=function(){t.$element.on("click","div.bh-checkbox",function(){i($(this).find("input"),t),$(this).trigger("checkone")}),"function"==typeof s&&s()};break;case"link":var p={text:l.caption,datafield:r},h={cellsRenderer:function(e,t,a,i){return isNaN(a)||(a=a.toString()),'<a href="javascript:void(0);" class="j_link_'+t+'">'+a+"</a>"}};c=$.extend(p,h,o);break;case"tpl":var p={text:l.caption,datafield:r};c=$.extend(p,l.custom.column,o)}return c}function i(e,t){if(!e.hasClass("selectAllCheckboxFlag")){var a=t.$element,i=a.find("div.selectAllCheckboxFlag").find("input"),n=a.find("table"),o=n.find("div.bh-checkbox");if(e.prop("checked")){var l=!0;o.find("input").each(function(){$(this).prop("checked")||(l=!1)}),l?i.prop("checked",!0).addClass("selectFlag"):i.prop("checked",!1).removeClass("selectFlag")}else i.prop("checked",!1).removeClass("selectFlag")}}var n;n=function(){function t(t,a){this.settings=$.extend({},$.fn.emapdatatable.defaults,a),this.$element=$(t),this.$element.attr("emap-role","datatable").attr("emap-pagePath",this.settings.pagePath).attr("emap-action",this.settings.action);var i=this.settings.url||WIS_EMAP_SERV.getAbsPath(this.settings.pagePath).replace(".do","/"+this.settings.action+".do"),n=this.settings.method||"POST";if("undefined"!=typeof window.MOCK_CONFIG&&(n=this.settings.method||"GET","undefined"==typeof this.settings.url))for(var o=BH_UTILS.doSyncAjax(i,{},n).models,l=0;l<o.length;l++)if(o[l].name==this.settings.action){i=o[l].url;break}this.source={root:"datas>"+this.settings.action+">rows",id:this.settings.pk||"WID",datatype:"json",url:i,data:this.settings.params||{},type:n,datafields:[]},e(this)}return t.prototype.reload=function(e,t){var a=e._gotoFirstPage;a&&delete e._gotoFirstPage,this.source.data=e,t===!0||a===!0?this.$element.jqxDataTable("goToPage",0)||this.$element.jqxDataTable("updateBoundData"):this.$element.jqxDataTable("updateBoundData");var i=this;if("function"==typeof t)var n=setInterval(function(){i.$element.jqxDataTable("isBindingCompleted")&&(clearInterval(n),t(),i.$element.jqxDataTable("refresh"))},10)},t.prototype.checkedRecords=function(){var e=[],t=this.$element.jqxDataTable("getRows");return this.$element.find("tr").each(function(a){var i=$(this).find('input[type="checkbox"]').prop("checked");i&&e.push(t[a])}),e},t.prototype.getTotalRecords=function(){return this.source.totalRecords},t.prototype.getResult=function(){return this.$element.data("tableResult")},t.prototype.getSort=function(){var e=this.$element.data("sortfield");if(void 0!==e){var t={direction:e.sortdirection,field:e.sortcolumn,exp:""};return 1==e.sortdirection.ascending?t.exp="+"+e.sortcolumn:1==e.sortdirection.descending&&(t.exp="-"+e.sortcolumn),t}},t}(),$.fn.emapdatatable=function(e,t,a,i){var o,l;if(o=this.data("emapdatatable"),l=this.data("initParams")||{},!o)return $(this).data("initParams",e.params),this.each(function(){return $(this).data("emapdatatable",new n(this,e))});if(e===!0)return o;if("string"===$.type(e)){var r=$.extend({},l,t),s=[];return"undefined"==typeof r.querySetting,"undefined"!=typeof r.querySetting&&i!==!1&&(s=JSON.parse(r.querySetting),$.each(r,function(e,t){"querySetting"==e||"number"!=$.type(t)&&"string"!=$.type(t)&&"boolean"!=$.type(t)||s.push({name:e,value:t,linkOpt:"and",builder:"equal"})}),r.querySetting=JSON.stringify(s)),o[e](r,a)}return this};var o=null;"undefined"!=typeof BH_UTILS&&(o=BH_UTILS.getTableHeight(10));var l=null;"undefined"!=typeof Globalize&&(l=Globalize.culture("zh-CN")),$.fn.emapdatatable.defaults={width:"100%",height:o,pageable:!0,pagerMode:"advanced",serverProcessing:!0,pageSizeOptions:["10","20","50","100"],localization:l,sortable:!1,selectionMode:"custom",enableBrowserSelection:!0,columnsResize:!0}}.call(this),function(){function e(e,t){t.eleWidth=e.width();var i=t.url.split("/");t.actionName=i[i.length-1].split(".")[0];var n={datatype:"json",root:"datas>"+t.actionName+">rows",url:t.url,type:"POST",async:!0},o=new $.jqx.dataAdapter(n,{beforeLoadComplete:function(e){return $(e).each(function(){this._displayData=JSON.stringify(this)}),e},formatData:function(t){return void 0!=e.jqxComboBox("searchString")?(t.queryopt=e.jqxComboBox("searchString"),t.pageSize=10,t.pageNumber=1,t):void 0;
}});e.addClass("bh-edt").jqxComboBox({remoteAutoComplete:!0,source:o,selectedIndex:0,displayMember:"_displayData",valueMember:"id",renderer:function(e,a,i,n){var o="",l=JSON.parse(a);if(!t.searchMember){t.searchMember=[];for(var r in l)"uid"!=r&&t.searchMember.push(r)}for(var r in l)"uid"!=r&&(o+='<div class="bh-mh-8" style="display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;max-width: '+t.eleWidth/t.searchMember.length+'px;" title="'+l[r]+'">'+l[r]+"</div>");return o},renderSelectedItem:function(e,t){return JSON.parse(t.label).id},search:function(e){o.dataBind()}}).on("open",function(){e.data("datainit")||(o.dataBind(),e.data("datainit",!0))}),a(e,t)}var t,a,i;t=function(){function t(t,a){this.options=$.extend({},$.fn.emapDropdownTable.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.getValue=function(){return this.$element.val()},t.prototype.setValue=function(e){var t=this.$element;""==e[0]&&t.val(""),t.jqxComboBox("getItemByValue",e[0])||t.jqxComboBox("addItem",{id:e[0],name:e[1],_displayData:function(){var t={};return t.name=e[1],t.id=e[0],JSON.stringify(t)}()}),t.jqxComboBox("selectItem",e[0])},t.prototype.destroy=function(){this.$element.jqxComboBox("destroy")},t}(),a=function(e,t){},i=function(e,t,a){$(a).each(function(){e.jqxComboBox("addItem",this)})},$.fn.emapDropdownTable=function(e,a){var i;return i=this.data("emapdropdowntable"),i?e===!0?i:"string"===$.type(e)?i[e](a):this:this.each(function(){return $(this).data("emapdropdowntable",new t(this,e))})},$.fn.emapDropdownTable.defaults={valueMember:"id",displayMember:"name",width:300}}.call(void 0),function(){var e,t,a,i,n,o;e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapDropdownTree.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e.prototype.getValue=function(){return $(this.$element.data("values")).map(function(){return this.value}).get().join(",")},e.prototype.setValue=function(e){var t=e[0],a=e[1];this.$element.jqxDropDownButton("setContent",a),this.$element.data("values",[{value:t,label:a}]),this.$element.trigger("change")},e.prototype.disable=function(){this.$element.jqxDropDownButton({disabled:!0})},e.prototype.enable=function(){this.$element.jqxDropDownButton({disabled:!1})},e}(),t=function(e,t){for(var a="",n=0;6>n;n++)a+=Math.floor(10*Math.random());t.$tree=$('<div style="border: none;" class="dropdown-tree"></div>'),t.$tree.attr("id","tree_"+a),e.attr("id","content_"+a),e.append(t.$tree),t.checkboxes?t.$tree.on("checkChange",function(e){var t=$(this),a=t.attr("id").substr("tree_".length),i=$("#content_"+a),n=e.args,o=t.jqxTree("getCheckedItems",n.element),l=[],r=o.map(function(e){return l.push({label:e.label,value:e.value}),e.label}).join(",");i.jqxDropDownButton("setContent",r),i.data({values:l}),this.$element.trigger("change")}):t.$tree.on("select",function(e){var a=$(this),n=e.args,o=a.attr("id").substr("tree_".length),l=$("#content_"+o),r=a.jqxTree("getItem",n.element),s=[],d=i(r,t.$tree).reverse().join("/"),c=r.value;s.push({label:d,value:c}),l.jqxDropDownButton("setContent",d),l.data({values:s}),l.trigger("select",[s]),l.jqxDropDownButton("close")}),e.jqxDropDownButton({width:"100%"}),e.on("close",function(){$(this).trigger("change")}).on("open",function(){t.treeInit||(o(e,t),t.treeInit=!0)})},o=function(e,t){if(t.$tree.niceScroll(),t.search){var i=$('<input class="treeSearchInput" type="text" class="bh-form-control" placeHolder="搜索..."/>');t.$tree.before(i),i.keyup(function(){var n=i.val();if(t.url);else{var o=e.data("emapDropdownTree").settings.datas.datas.code.rows,l=o.filter(function(e){return e.name.indexOf(n)>-1}),r=a({datas:{code:{rows:l}}});t.$tree.jqxTree("clear");var s=$.extend({height:220,hasThreeStates:!1,source:r},{checkboxes:t.checkboxes});t.$tree.jqxTree(s)}e.trigger("search",[n])})}if(t.url){var o={datatype:"json",root:"datas>code>rows",datafields:[{name:"id"},{name:"pId"},{name:"name"},{name:"isParent"}],id:"id",url:t.url,data:$.extend({pId:""},t.params)},l=new $.jqx.dataAdapter(o,{beforeLoadComplete:function(e,t){for(var a=[{name:"请选择...",pId:"...",value:""}],i=0;i<e.length;i++){var n=e[i];if(a.push({id:n.id,name:n.name,pId:"...",value:n.id}),1===n.isParent){var o={id:n.id+"_load",name:"加载中...",pId:n.id,value:n.id};a.push(o)}}return a},loadComplete:function(){var e=l.getRecordsHierarchy("id","pId","items",[{name:"name",map:"label"}]);n(e);var a=$.extend({width:"100%",height:220,hasThreeStates:!1,source:e,checkSize:16},{checkboxes:t.checkboxes});t.$tree.on("expand",function(e){var a=$(this),i=$(e.args.element),n=!1,o=null,l=i.find("ul:first").children();if($.each(l,function(){var e=a.jqxTree("getItem",this);return e&&"加载中..."==e.label?(o=e,n=!0,!1):void 0}),n){var r=t.unblind;$.ajax({url:t.url,data:{pId:o.value.replace(".fake","")},success:function(e,n,l){var s=e;if(s.datas&&s.datas.code&&s.datas.code.rows){for(var d=s.datas.code.rows,c=[],p=d.length-1;p>=0;p--){var h=d[p].name;r&&(h=h.substring(h.lastIndexOf(t.unblind)+1,h.length));var u={label:h,value:d[p].id};1===d[p].isParent&&(u.items=[{value:d[p].id,label:"加载中..."}]),c.push(u)}a.jqxTree("addTo",c,i[0]),a.jqxTree("removeItem",o.element)}}})}}),t.$tree.jqxTree(a)}});l.dataBind()}else{var r=a(t.datas),s=$.extend({width:"100%",height:220,hasThreeStates:!1,source:r,checkSize:16},{checkboxes:t.checkboxes});t.$tree.jqxTree(s)}},a=function(e){var t={datatype:"json",datafields:[{name:"id"},{name:"pId"},{name:"name"}],id:"id",localdata:e},a=new $.jqx.dataAdapter(t);a.dataBind();var i=a.getRecordsHierarchy("id","pId","items",[{name:"name",map:"label"},{name:"id",map:"value"}]);return i},i=function(e,t){var a=[];return a.push(e.label),null!=t.jqxTree("getItem",e.parentElement)&&(a=a.concat(i(t.jqxTree("getItem",e.parentElement),t))),a},n=function(e){for(var t=0;t<e.length;t++)delete e[t].id,delete e[t].pId,e[t].items&&n(e[t].items)},$.fn.emapDropdownTree=function(t,a){var i;return i=this.data("emapDropdownTree"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return $(this).data("emapDropdownTree",new e(this,t))})},$.fn.emapDropdownTree.defaults={width:"100%",checkboxes:!1,search:!1}}.call(this),function(){var e,t;e=function(){function e(e,a){a.mode&&(a.model=a.mode),this.options=$.extend({},$.fn.emapFileDownload.defaults,a),this.$element=$(e),t(this.$element,this.options)}return e}(),t=function(e,t){$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(a){if(a.success){var i="";if(!a.items||0==a.items.length)return i+=" 无",void $(e).append(i);if("file"==t.model)$(a.items).each(function(){i+='<div class="bh-pull-left bh-file-upload-file" data-fileId="'+this.id+'" data-fileurl="'+this.fileUrl+'"><div class="bh-file-upload-file-icon bh-pull-left"><i class="iconfont icon-insertdrivefile"></i></div><div class="bh-file-upload-file-info bh-pull-left"><span class="bh-file-upload-filename" title="'+this.name+'">'+this.name+'</span><p><a class="bh-file-upload-download" href="javascript:void(0)">下载</a></p></div></div>'}),$(e).append(i).find(".bh-file-upload-download").on("click",function(){var e=$(this).closest(".bh-file-upload-file");window.location.href=e.data("fileurl")});else if("image"==t.model){var n=parseInt(t.width)-6,o=parseInt(t.height)-6;$(a.items).each(function(){i+='<div data-fileid="'+this.id+'" data-name="'+this.name+'" class="bh-file-img-block success" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-table" style="width: '+n+"px;height: "+o+'px;"><span style="width: '+n+"px;height: "+o+'px;"><img style="max-width: '+n+"px;max-height: "+o+'px;" src="'+this.fileUrl+'" alt="'+this.name+'" /></span></div></div>'}),$(e).css("overflow","hidden").append(i)}}}})},$.fn.emapFileDownload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return $(this).data("emapfiledownload",new e(this,t))})},$.fn.emapFileDownload.defaults={model:"file",width:200,height:150}}.call(this),function(){var e,t,a,i,n="FileReader"in window;a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAMAAABGS8AGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAMAUExURQAAACagliejmSWnmyeimCqkmSilnECmiCmlmSikmiilmyinnCeimCekmieilyimmiagliiimCimmyikmiikmiikmieglielnCimnCilmyehlyekmSijmSalnCimmyikmyilmiaglvanL9ymUCeglt2pWuejQOqXMvaRItytXuOoTO+lO96pVnmmcPaVKPOcK+6pOd6hSeaeSO6oPYmqd2qgdu6rQd+rTtyeRuaZOueVMeesRieglimmnEgrG/aOH/qiHOrAp/LXvOvIrezBqPbZviWnnj8hEkkmFkgrHP2hFujLseK5oCapnx6mov+NGEgoGCWlm/qjHCaupUcqGkoiEf+hGR+kmyqmnPHXvRuhnfeOHv+iEiesoh6flUksHPbKtPmeHUsgD/HUue/Fq+nIrUBIOiehlym2SUYvIPTZvvrfw0ojEzCEeOnAp//bv/rDqTweD0YoGPmNG/LIr/WOH/yNGzB/cxqimhielfLWu/vMryKgmOq/puK/pyajmkynmS+hlem9oiqUif359P///+/KsTO0RkU2JySflfTCqCaxqC2Og0M7LKiDbVCwo/zZvkElFTCJfT2nmNK8o/uiGle0Sz21SDR0aCqbkZx9aGWqm49xXTGonb65pDN5bezEq+vWuyOmnv/ny3q1pfWlJs2VM/qNHeqkIdbDlimjmreaTWugdf+QGzpfUnZXRFehg2BCMPORJeTSuGxOPPXj0bepWfv18HqyoImzoJ26cEm0Qx22RsOnKManSlU3JjtaTNLQt6rFsJ+0ocLMtd61nLqXgOzPtVo8K8Kiij+ija6aUzxWSF+pit3Dp+rEqOmSJ/mOHYmnOGu1XnutOzdqXf+lIdGnP2ipgpepaummMFCqkZbBrveUJ4Cda7ONd2a2psGbhFmypGK1pfTax//9/NuUKUSqdpyiOuPDm4S3YGquP72bLLO/gn+baf6mKYVqVWxhUfLo2nNuXIyuRqaqL+bHoV6sX/qeHUo8LW+qis3LsIiob0QlFfieIdrSudHUgI4AAAA8dFJOUwDtjRAiCvsDGoPPFpni2DzeT+t5a6PGuvavuFYwyEVgc/zoIfczmdfsVYN3FPzn7NtfCsN1f+K4yIiAzsFKH5gAAAhNSURBVFjDpdn3XxPZGgfgkAAhVGmiItLsuvX2ezOTEDGF3RQkCSXEZCkhkICGEhAXkKIgAhqpIiqKiuva69pXd63rqqvu3bu93O3l9vbjnZn0nDMzwf3+AU/ez3vec2ZyhsGgS1BYVDInPiE0IiYmICAgInIWMyUxkMVm/KywQ6JSZkYEI3ikWq1Q2MIlEjCdEx0Y9MRs2BxmqB1FEGGOtH1rZU+ZtMxOc8umhSeGPBEbGJcwA3FGmtNzt7e8vPfuVmfReKZzZk+d5YQi7ki1u8qLVGKxuah8JLvMLXMjmVOjg1IiEc9oK1GVUoKiEqVKUu8lc6dxptCQOUnBXq70oKEIY/FIigzbWrheiUz2d82YMxDvaLeiCtQRhbIy2xvmpsYH+uNGJSG+0Y6oUFdUI0KubyKjaeeanRwDuptGnJ3AezGSkw3Ic2NppjqIE+zLSjcdrDSI3bDYUL9R2gLQ4WFULiseKDdHW29AxahHxKihPhtsxyyKRofNBN1tr0tUXi4mm9G77VJAnk4qsyDu1l5f1k73VgrL/JWDwD5oK7vMShQWc7nPRiG6Ae0zmwNxy8UoScTl9WCfw2GzEZcH9KGni9TF5K4eUI6F7AtgfrUHDWYJOSwxGzYCUzc3GhgIcL9tetesQCmiEL8rBdo8zXcBmeBAtFM1grQZ8T7n2Qxgw+UcIRkId8nmI+DMpXqddUFJkJ3Ra4Z71a7fM/e2Qw4kz/M5Nhjs8C4FvBNKnc4pixW7wA3IZbrdkEjAlUqPqOAFi8aO2py/oXq9BTyOprmfVpw8cG+UGYpgs6azHG/71AlLVIZt4BHKDXcVHIqAcHsXbIh1IuUN/fXjNp1jlGFz4S45DuwwdvrAdrNOZOurLakdtbj2dSUE5nIceyMBgcCVqOfu0OkkqA6ttqCYm1Fy/ZbIXrJCUQ+Dp4eQzDABK1ywstomIoKe+hxzMzJr+0TVjs0HhVMTiVONiVDCSpvtytGx0bG/jY3eaKrNzMBS0nbUoqSo2H7KwZYOf+Lbe6xTiq6M3hOYTKblpsYmgsVSe/uKhaLH9hNjTjAUbndsPMvxgQlThaBRIKh44UUnnKn/VCnCt15XTzYM5mKHHDsFgcJc+xyLbg1M4KrAC24a14/aRDqSOcbngs0ImgmFpdojRVgbq219ExX5Al84o6mktk9nge88Yi5YjJAIKIydFSJLNWq7dW+iWADCuPz5KYsIdlYQb+aBjKhgOKxt/2ffcZvoVKOpEQZnVI3XXu/7ezu8E1xuIiMZ7iINf949cVtnOSow5UNhbAVLVjdvX0MCpzA4cDd3x5urKkw3lFjFZDCW1TtbV8JhJiOeBP5i95Z8gen22E0KuKq7eR0JPIuRQAJ/tmU5hpnynUsHrTizezsJHMkIpYQFywU0MEmTIxgk05a7GW+FV6bUigBGDPni0cPki0cKIw2f5a+qoIYzu6tIx40czs7de3U3JVzVPLB95cYpw5i8Y/PV5eRw987+VlIXgyMQ0mQ3fOTZZ58t3X1uzUoulxwOJYfzsjfnV+TD4arM5nUbyV1s3BIQimRfc5Xc2Cg42dzU1OQaiDeoXGyDhFPB7mmuwHKyeXx8nHaCnVuaQ1lx7kf2mSs+3dHRcRZLR34bMWmrz1G62CGUjFCWjO0TAv6yYz2RszfbqI81R+JID3rnPtl8cpWj5K/Wr//qbHEb3uXVA+vWULrY0zQsAqGWvzhJdKO44vQ/Tn853kb0gdbFHk0kD1PPmq+uwvdJY/ELL7bZ3Z10Lv4wJXn8u4cZaei/Rixgxc1mYo4z3+inc/HHPyNqBk3JSG7etS1En50DvJLOxV9YGCFJdDDSsHdtsRO+v/Y12nodf8o4tHDu3rWlN4tx+H5p6drX6AsOZ5O+xgJwaemyDePjpX7BqdFktwk+y1dAwI740QrHizf0r4Kb3SMT5p3zhM+1thS8TAnHUvy5cbJCmaz/m0f3Nrjh2oH/fnOngIp2/5+ODSZrgkz29pl/DQ/9xwPe8MqFC9++dayggOIAcv31JykZZw8UXurs/EnvhvXnjcNfyx9gdANdwfAuY8398Mw+tVp9YMj4qMRVsv67IeMPGqtVfuKtO9B+pHI8/6RDniOyHe/vK1QP8vnqfxs7z+s3LMPZZfqS743DP8rreJpJ+YNPDkL6Ecryul8BZlnWf7kwi49HzX+Myff1RL77vtP40Krh4bEefrW1gO6OhQO47xUO8u1RH/jBaHz00ytYzg9dND6um+TZ844clMN979y8Twyh7H1HvXb5YedF4/DQ0PDFi8Pf8uQOl1dnlX9SQHFbQWS214G/J+9yId8d9eClxxc6jcbOCw/3y608V+rkr5Z5LWDAHPAaK9GzzbIPP/CE+Wo1/8ClSz/ufzApn6zzhPe3vuz9qINc6MV6wn/6Yxaf702r1Yfl1kmeV6wfH/PsBRN6jcz2eMWQPeVaOldW/E+j4flEc/iQBzyTRXu5KT1TyAfgl3hANPK/5LpfUkg/AwQ5axYil/2D8dWjdzHZccUgzHvPX3i/cyziKa+82bHEbOxZ94HfMNcOM1k0t/+J+DzL3v5rlp/w13dwOCCO/nPZ7ARi2gb9gnk1Hx/DTs/QKH8+hLA4MbJDar5/MD5vc8P9/SoUlQAZYzjMkx9Kip7CB8Jfpq3IyqKHNTW8p3/FmtL3sXnzn/WlARhjF8yfN+UvevMW/2JflqftDdfU1JxYsHjqLJ70RfOfxe3BQR9Yo6mxnlgw/7n0J/5q+nz6osV/SNu3YrAQ0+1wTc07dScWLvjdovTnf+aH3qVLFy1Z8ptfp6WlPbNw4cKnn/nt75c8l76Udj/8H1/k4P/j+w/zAAAAAElFTkSuQmCC",e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapFilePhoto.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e}(),t=function(e,t){t.token&&""!=t.token&&null!=t.token?(t.defaultPhoto=t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+t.token+".do?date="+(new Date).getTime(),t.scope=t.token.substring(0,t.token.length-1),t.newToken=!1):(t.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),t.token=t.scope+1,t.newToken=!0),t.uploadUrl=t.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+t.scope+"/"+t.token+".do",$(e).addClass("bh-file-photo").append('<div class="bh-file-photo-block"></div><p class="bh-file-photo-info"><span class="icon icon-spinner icon-pulse bh-file-photo-loading"></span><span class="bh-file-photo-error"></span><span class="bh-file-photo-success">上传成功</span></p><a class="bh-file-upload" href="javascript:void(0)"><input name="bhFile" type="file">上传</a>'),i(t.defaultPhoto?t.defaultPhoto:a,function(t){var a=t.width,i=t.height;a>i?$(t).css({position:"absolute",height:"88px",top:0,left:"50%","margin-left":"-"+a/2/i*88+"px"}):$(t).css({position:"absolute",width:"88px",left:0,top:"50%","margin-top":"-"+i/2/a*88+"px"}),$(e).find(".bh-file-photo-block").html(t)}),$(e).find("input[type=file][name=bhFile]").fileupload({url:t.uploadUrl,autoUpload:!0,dataType:"json",formData:{storeId:"image"},submit:function(a,i){var o=i.files[0];return $(e).addClass("loading"),t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(o.name.toUpperCase())?($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("文件类型不正确"),!1):n&&t.size&&o.size/1024>t.size?($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("文件大小超出限制"),!1):void(t.submit&&t.submit(a,i))},done:function(a,n){n.result.success?($(e).removeClass("loading").addClass("success"),t.tempUrl=n.result.tempFileUrl,t.fileUrl=n.result.fileUrl,i(n.result.tempFileUrl,function(i){var o=i.width,l=i.height;o>l?$(i).css({position:"absolute",height:"88px",top:0,left:"50%","margin-left":"-"+o/2/l*88+"px"}):$(i).css({position:"absolute",width:"88px",left:0,top:"50%","margin-top":"-"+l/2/o*88+"px"}),$(e).find(".bh-file-photo-block").html(i),t.done&&t.done(a,n)})):($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html(n.result.error?n.result.error:"上传失败"),t.fail&&t.fail(a,n))},fail:function(a,i){$(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("上传失败"),t.fail&&t.fail(a,i)}}),t.attachmentParams={storeId:"image",scope:t.scope,fileToken:t.token}},i=function(e,t){var a=new Image;a.src=e,a.conplete?t(a.width,a.height):a.onload=function(){t(a),a.onload=null}},e.prototype.saveTempFile=function(){var e=!1,t=this;return!this.settings.tempUrl||this.settings.tempUrl.length<1?e:($.ajax({type:"post",url:this.settings.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+this.settings.token+".do",async:!1,dataType:"json",success:function(e){}}),$.ajax({type:"post",async:!1,url:this.settings.contextPath+"/sys/emapcomponent/file/saveAttachment/"+this.settings.scope+"/"+this.settings.token+".do",data:{attachmentParam:JSON.stringify(this.settings.attachmentParams)},dataType:"json",success:function(a){t.settings.tempFileSaved=!0,e=a}}),e)},e.prototype.getFileToken=function(){return!this.settings.newToken||this.settings.tempUrl&&0!=this.settings.tempUrl.length?this.settings.token:null},e.prototype.destroy=function(){this.settings=null,$(this.$element).data("plugin",!1).removeClass("success error loading").empty().attr("class","bh-file-photo")},$.fn.emapFilePhoto=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapFilePhoto.defaults={storeId:"image",type:["jpg","png","bmp"],size:2048}}.call(this),function(){var e,t,a,i="FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapFileUpload.defaults,a),this.$element=$(e),t(this.$element,this.options)}e.prototype.getFileToken=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.saveTempFile=function(){var e=this.options,t=e.fileInput.emapUploadCore("saveTempFile");return $(".bh-file-upload-name-a",this.options.loadedCon).each(function(){var t=$(this).attr("href");if(new RegExp("getTempFile").test(t)){var a=$(this).closest(".bh-file-upload-file").data("fileid");$(this).attr("href",e.contextPath+"/sys/emapcomponent/file/getAttachmentFile/"+a+".do")}}),t},e.prototype.getFileNum=function(){return this.options.loadedCon.getFileNum()},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},t=function(e,t){$(e).css("line-height","28px").append('<a class="bh-file-upload" href="javascript:void(0)"><input name="bhFile" type="file" '+(t.multiple?"multiple":"")+' />上传</a><span class="bh-text-caption bh-color-caption bh-mh-8 bh-file-upload-info">('+a(t)+')</span><div class="bh-file-upload-loading-wrap bh-clearfix"></div><div class="bh-file-upload-loaded-wrap bh-clearfix"></div><input type="hidden" class="file-array" value="" />'),t.fileInput=$("input[type=file]",e).parent(),t.loadingCon=$(e).find(".bh-file-upload-loading-wrap").bhFileUploadingList({onDelete:function(e){e.hasClass("bh-error")?e.remove():(e.data("xhr").abort(),e.remove())}}),t.loadedCon=$(e).find(".bh-file-upload-loaded-wrap").bhFileUploadedList({onDelete:function(a){var i=$(a).closest(".bh-file-upload-file");i.data("save")?(t.fileInput.emapUploadCore("deleteArrAdd",i.data("fileid")),i.remove()):t.fileInput.emapUploadCore("deleteTempFile",{url:i.data("deleteurl"),fileId:i.data("fileid"),done:function(e){i.remove()}}),e.trigger("bh.file.upload.delete")}}),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(a){a.success&&("image"==t.storeId?$(a.items).each(function(){t.loadedCon.addImage(this.name,"",this.id,this.fileUrl,function(e){e.data("save",!0)})}):$(a.items).each(function(){t.loadedCon.add(this.name,"",this.id,this.fileUrl,function(e){e.data("save",!0)})}),e.trigger("bh.file.upload.done",a))}}),t.fileInput.emapUploadCore($.extend({},t,{add:function(e,a){var i=a.files,n=(new Date).getTime();$(i).each(function(e){a.files[e].bhId=n+e,t.loadingCon.add(this.name,n+e)}),t.add&&t.add(e,a)},submit:function(e,a){var n=a.files[0];if(t.limit){var o=t.loadingCon.getFileNum()+t.loadedCon.getFileNum();if(o>t.limit)return t.loadingCon.error("文件数量超出限制",n.bhId),!1}return t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(n.name.toUpperCase())?(t.loadingCon.error("文件类型不正确",n.bhId),!1):i&&t.size&&n.size/1024>t.size?(t.loadingCon.error("文件大小超出限制",n.bhId),!1):(t.loadingCon._findFile(n.bhId).data("xhr",a),void(t.submit&&t.submit(e,a)))},done:function(e,a){var i=a.files[0];t.loadingCon.remove(i.bhId),"image"==t.storeId?t.loadedCon.addImage(i.name,i.bhId,a.result.id,a.result.tempFileUrl,function(e){e.data("deleteurl",a.result.deleteUrl)}):t.loadedCon.add(i.name,i.bhId,a.result.id,a.result.tempFileUrl,function(e){e.data("deleteurl",a.result.deleteUrl)}),t.done&&t.done(e,a)},fail:function(e,a){var i=a.files[0];t.loadingCon.error(a.result.error?a.result.error:"上传失败",i.bhId),t.fail&&t.fail(e,a)}}))},a=function(e){var t="请上传附件";return e.size&&(t+=",文件最大为"+(e.size<1024?e.size+"K":e.size/1024+"M")),e.type&&e.type.length>0&&(t+=",格式限制为"+e.type.join(",").toUpperCase()),t},$.fn.emapFileUpload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapFileUpload.defaults={multiple:!1,dataType:"json",storeId:"file",type:[],size:0}}()}.call(this),$.fn.bhFileUploadingList=function(e){return $(this).on("click","a.bh-file-upload-delete",function(){e.onDelete&&e.onDelete($(this).closest(".bh-file-upload-file"))}),this.add=function(e,t,a){$(this).append('<div class="bh-pull-left bh-file-upload-file" data-bhid="'+t+'" data-fileid="'+(a?a:0)+'"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span><span class="bh-file-upload-error-msg"></span><i class="icon icon-spinner icon-pulse bh-file-uploading-icon"></i><a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></div>')},this._findFile=function(e,t){var a=t?t:e,i=t?"fileid":"bhid";return $(this).find(".bh-file-upload-file[data-"+i+"="+a+"]")},this.error=function(e,t,a){var i=this._findFile(t,a);i.length>0&&i.addClass("bh-error").find(".bh-file-upload-error-msg").text(e)},this.remove=function(e,t){var a=this._findFile(e,t);a.length>0&&a.remove()},this.getFileNum=function(){return $(this).find(".bh-file-upload-file:not(.bh-error)").length},this},$.fn.bhFileUploadedList=function(e){return $(this).on("click","a.bh-file-upload-delete",function(){e.onDelete&&e.onDelete($(this).closest(".bh-file-upload-file"))}),this.add=function(e,t,a,i,n){var o=$('<div class="bh-pull-left bh-file-upload-file" data-bhid="'+t+'" data-fileId="'+(a?a:0)+'"><div class="bh-file-upload-file-icon bh-pull-left"><i class="iconfont icon-insertdrivefile"></i></div><div class="bh-file-upload-file-info bh-pull-left"><a class="bh-file-upload-name-a" href="'+i+'" style="color:#333;"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span></a><p><span class="bh-file-upload-success-info">上传成功</span> <a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></p></div></div>');$(this).append(o),n&&n(o)},this.addImage=function(e,t,a,i,n){var o=$('<div class="bh-pull-left bh-file-upload-file bh-file-upload-img" data-bhid="'+t+'" data-fileId="'+(a?a:0)+'"><div class="bh-file-upload-img-block"><span><img src="'+i+'" /></span></div><div class="bh-file-upload-file-info"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span><p><span class="bh-file-upload-success-info">上传成功</span> <a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></p></div></div>');$(this).append(o),n&&n(o)},this._findFile=function(e,t){var a=t?t:e,i=t?"fileid":"bhid";return $(this).find(".bh-file-upload-file[data-"+i+"="+a+"]")},this.remove=function(e,t){var a=this._findFile(e,t);a.length>0&&a.remove()},this.getFileNum=function(){return $(this).find(".bh-file-upload-file").length},this},function(){var e,t,a,i,n,o,l;e=function(){function e(e,a){a.mode&&(a.model=a.mode),("L"==a.model||"horizontal"==a.model)&&(a.model="h"),("S"==a.model||"vertical"==a.model)&&(a.model="v"),a.rows&&(a.cols=a.rows),this.options=$.extend({},$.fn.emapForm.defaults,a),this.options&&null!=this.options&&""!=this.options||(this.options=WIS_EMAP_SERV.getContextPath()),this.$element=$(e),this.$element.attr("emap-role","datatable"),t(this.$element,this.options),!this.options.readonly&&this.options.data&&(this.$element.emapFormInputInit(this.options),this.options.validate&&this.$element.emapValidate({}))}return e.prototype.disableItem=function(e){function t(e){var t=$("[data-name="+e+"]",a);switch(t.attr("xtype")){case"select":t.jqxDropDownList({disabled:!0});break;case"date-local":case"date-ym":case"date-full":t.jqxDateTimeInput({disabled:!0});break;case"tree":t.emapDropdownTree("disable");break;case"radiolist":case"checkboxlist":$("input[type=radio], input[type=checkbox]",t).prop("disabled",!0);break;case"switcher":t.jqxSwitchButton("disable");break;case"multi-select":case"selecttable":t.jqxComboBox({disabled:!0});break;case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":$("input[type=file]",t).attr("disabled",!0);break;default:t.attr("disabled",!0)}t.closest(".bh-form-group").addClass("bh-disabled")}var a=this.$element;l(e,t),a.emapForm("reloadValidate")},e.prototype.enableItem=function(e){function t(e){var t=$("[data-name="+e+"]",a);switch(t.attr("xtype")){case"text":case"textarea":t.attr("disabled",!1);break;case"select":t.jqxDropDownList({disabled:!1});break;case"date-local":case"date-ym":t.jqxDateTimeInput({disabled:!1});break;case"tree":t.emapDropdownTree("enable");break;case"radiolist":case"checkboxlist":$("input[type=radio], input[type=checkbox]",t).prop("disabled",!1);break;case"switcher":t.jqxSwitchButton("enable");break;case"multi-select":case"selecttable":t.jqxComboBox({disabled:!1});break;case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":$("input[type=file]",t).attr("disabled",!1)}t.closest(".bh-form-group").removeClass("bh-disabled")}var a=this.$element;l(e,t),a.emapForm("reloadValidate")},e.prototype.saveUpload=function(){var e=$("[xtype=uploadphoto], [xtype=uploadfile], [xtype=uploadsingleimage], [xtype=uploadmuiltimage]",this.$element);e.each(function(){switch($(this).attr("xtype")){case"uploadphoto":$(this).emapFilePhoto("saveTempFile");break;case"uploadfile":$(this).emapFileUpload("saveTempFile");break;case"uploadsingleimage":$(this).emapSingleImageUpload("saveTempFile");break;case"uploadmuiltimage":$(this).emapImageUpload("saveTempFile")}})},e.prototype.showItem=function(e){function t(e){$("[data-name="+e+"]",a).closest(".bh-row").show().attr("hidden",!1)}var a=this.$element;l(e,t),a.emapForm("reloadValidate")},e.prototype.hideItem=function(e){function t(e){$("[data-name="+e+"]",a).closest(".bh-row").hide().attr("hidden",!0)}var a=this.$element;l(e,t),a.emapForm("reloadValidate")},e.prototype.getValue=function(){var e=this.options;if(e.readonly)return e.formValue;var t={};return this.$element.find("[xtype]").each(function(){var e="";switch($(this).attr("xtype")){case"radiolist":e=$(this).find("input[type=radio]:checked").map(function(){return $(this).val()}).get().join(",");break;case"checkboxlist":e=$(this).find("input[type=checkbox]:checked").map(function(){return $(this).val()}).get().join(",");break;case"tree":e=$(this).emapDropdownTree("getValue");break;case"uploadfile":e=$(this).emapFileUpload("getFileToken");break;case"uploadsingleimage":e=$(this).emapSingleImageUpload("getFileToken");break;case"uploadmuiltimage":e=$(this).emapImageUpload("getFileToken");break;case"uploadphoto":e=$(this).emapFilePhoto("getFileToken");break;case"switcher":e=$(this).val()?1:0;break;case"multi-select":e=$(this).jqxComboBox("getSelectedItems").map(function(e){return e.value}).join(",");break;default:e=$(this).val()}t[$(this).data("name")]=e}),t},e.prototype.clear=function(e){var t=this.options;if(t.readonly)if(void 0==e)this.$element.find("[xtype]").each(function(){$(this).html("")});else for(var a=0;a<e.length;a++)this.$element.find("[data-name="+e[a]+"][xtype]").html("");else if(void 0===e)this.$element.find("[xtype]").each(function(){var e=$(this).data("name"),a=$(this).attr("xtype"),i=$(this);WIS_EMAP_SERV._setEditControlValue(i,e,a,"",t.root)});else for(var a=0;a<e.length;a++){var i=e[a],n=this.$element.find("[data-name="+i+"][xtype]"),o=n.attr("xtype"),e={};e[i]="",WIS_EMAP_SERV._setEditControlValue(n,i,o,e,t.root)}},e.prototype.setValue=function(e){var t=this.options;this.options.readonly?(this.options.formValue=e,this.$element.find("[xtype]").each(function(){function a(e){null!=e&&n.text(e).attr("title",e)}var i=$(this).data("name"),n=$(this),o=null;if(void 0!==e[i]&&null!==e[i])switch($(this).attr("xtype")){case"multi-select":case"select":e[i+"_DISPLAY"]?a(e[i+"_DISPLAY"]):WIS_EMAP_SERV._getInputOptions(n.data("url"),function(t){n.data("model",t);var o=e[i].split(","),l=[];$(t).each(function(){$.inArray(this.id,o)>-1&&l.push(this.name)}),a(l.join(","))});break;case"radiolist":e[i+"_DISPLAY"]?a(e[i+"_DISPLAY"]):WIS_EMAP_SERV._getInputOptions(n.data("url"),function(t){n.data("model",t),$(t).each(function(){return this.id==e[i]?(o=this.name,!1):void 0})});break;case"checkboxlist":e[i+"_DISPLAY"]?a(e[i+"_DISPLAY"]):WIS_EMAP_SERV._getInputOptions(n.data("url"),function(t){n.data("model",t);var o=e[i].split(","),l=[];$(t).each(function(){$.inArray(this.id,o)>-1&&l.push(this.name)}),a(l.join(","))});break;case"tree":e[i+"_DISPLAY"]?a(e[i+"_DISPLAY"]):WIS_EMAP_SERV._getInputOptions(n.data("url"),function(t){n.data("model",t);var o=e[i].split(","),l=[];$(t).each(function(){$.inArray(this.id,o)>-1&&l.push(this.name)}),a(l.join(","))});break;case"uploadfile":$(this).emapFileDownload($.extend({},{contextPath:t.root,token:e[i]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadsingleimage":case"uploadmuiltimage":$(this).emapFileDownload($.extend({},{model:"image",contextPath:t.root,token:e[i]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadphoto":$(this).emapFilePhoto("destroy"),$(this).emapFilePhoto($.extend({},{token:e[i],contextPath:t.root},JSON.parse(decodeURI($(this).data("jsonparam"))))),$("a",this).hide();break;default:a(e[i])}})):this.$element.find("[xtype]").each(function(){var a=$(this).data("name"),i=$(this),n=i.attr("xtype");void 0===e||void 0!==e[a]&&null!==e[a]&&WIS_EMAP_SERV._setEditControlValue(i,a,n,e,t.root)})},e.prototype.destroy=function(){$("[xtype]",this.$element).each(function(){var e=$(this),t=e.attr("xtype");switch(t){case"select":e.jqxDropDownList("destroy");break;case"multi-select":e.jqxComboBox("destroy");break;case"date-local":case"date-ym":case"date-full":e.jqxDateTimeInput("destroy");break;case"tree":e.jqxDropDownButton("destroy")}}),this.options=null,$(this.$element).removeAttr("emap-role"),$(this.$element).data("emapform",!1).empty()},e.prototype.reloadValidate=function(){this.$element.emapValidate("destroy"),this.$element.emapValidate({})},e.prototype.requireItem=function(e){function t(e){var t=$("[data-name="+e+"]",a).closest(".bh-form-group");t.hasClass("bh-required")||(t.addClass("bh-required"),a.emapForm("reloadValidate"))}var a=this.$element;l(e,t)},e.prototype.unRequireItem=function(e){function t(e){var t=$("[data-name="+e+"]",a).closest(".bh-form-group");t.hasClass("bh-required")&&(t.removeClass("bh-required"),a.emapForm("reloadValidate"))}var a=this.$element;l(e,t)},e.prototype.getModel=function(e){return this.options.hasGroup&&e?n(this.options.data):this.options.data},e}(),t=function(e,t){if(t.data){e.attr("emap-role","form");var o=t.readonly?t.readonly:!1,l=$('<div class="bh-form-horizontal" bh-form-role="bhForm" ></div>');if(o?l.addClass("bh-form-readonly"):"v"==t.model&&l.addClass("bh-form-S"),t.hasGroup=t.data.filter(function(e){return!!e.groupName&&""!=e.groupName}).length>0,t.hasGroup&&t.renderByGroup)for(var r=n(t.data),s=0;s<r.length;s++){var d=$('<div bh-form-role=groupContainer><div class="bh-col-md-12 bh-form-groupname sc-title-borderLeft bh-mb-16" bh-role-form-outline="title" title="'+r[s].groupName+'">'+r[s].groupName+'</div><div class="bh-form-block bh-mb-16" bh-role-form-outline="container" style="margin-left: 12px;"></div></div>'),c=$("[bh-role-form-outline=container]",d),p=r[s].items.filter(function(e){return!e.get("hidden")});r[s].groupName&&0!=p.length||(d.css("display","none"),$(".bh-form-groupname",d).removeAttr("bh-role-form-outline"),$(".bh-form-block",d).attr("bh-role-form-outline","hidden")),o?a(c,r[s].items,t.cols):i(c,r[s].items,t.model),l.append(d)}else o?a(l,t.data,t.cols):i(l,t.data,t.model);e.append(l)}},n=function(e){for(var t=[],a=0;a<e.length;a++){var i=t.filter(function(t){return t.groupName==e[a].groupName});0==i.length?t.push({groupName:e[a].groupName,items:[e[a]]}):i[0].items.push(e[a])}return t},a=function(e,t,a){a=a?a:3;var i=12/a,n="";$(t).each(function(){var e=o(this);switch("textarea"==e.xtype&&(e.col=a),n+='<div class="bh-form-group  bh-col-md-'+e.col*i+'" '+(e.hidden?'style="display: none;"':"")+' ><label class="bh-form-label bh-form-readonly-label" title="'+e.caption+'">'+e.caption+'</label><div class="bh-ph-8 bh-form-readonly-input">',e.xtype){case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":n+='<div xtype="'+e.xtype+'" class="" data-name="'+e.name+'" data-JSONParam="'+encodeURI(JSON.stringify(e.JSONParam))+'"></div>';
break;case"textarea":n+='<textarea xtype="textarea" data-name="'+e.name+'" class="bh-form-control" rows="3" maxlength="'+e.dataSize+'" readOnly placeholder="'+(e.placeholder?e.placeholder:"")+'" style="background: #fff;resize: none;border: none!important;box-shadow: none!important;" ></textarea>';break;default:n+='<p data-name="'+e.name+'" data-url="'+e.url+'" xtype="'+e.xtype+'" class="bh-form-static"></p>'}n+="</div></div>"}),e.append(n).addClass("bh-form-block")},i=function(e,t,a){$(t).each(function(){var t=o(this),i="",n="";switch(t.xtype){case void 0:case"text":t.xtype="text",n='<input class="bh-form-control" data-name="{{name}}" name="{{name}}" xtype="{{xtype}}" type="{{xtype}}" {{checkType}}  {{dataSize}} {{checkSize}} {{checkExp}} '+(t.inputReadonly?"readOnly":"")+"  />";break;case"textarea":n='<textarea xtype="{{xtype}}" class="bh-form-control" rows="3" data-name="{{name}}" {{checkType}} {{dataSize}} {{checkSize}} {{checkExp}} '+(t.inputReadonly?"readOnly":"")+" ></textarea>";break;case"selecttable":case"select":case"tree":case"date-local":case"date-ym":case"date-full":case"switcher":case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":case"buttonlist":case"multi-select":case"div":n='<div xtype="{{xtype}}" data-name="{{name}}" {{url}} {{format}} {{checkType}} {{JSONParam}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"radiolist":n='<div xtype="{{xtype}}" class="bh-radio jqx-radio-group" data-name="{{name}}" {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"checkboxlist":n='<div xtype="{{xtype}}" class="bh-checkbox" data-name="{{name}}" {{checkType}} {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>'}n=n.replace(/\{\{xtype\}\}/g,t.xtype).replace(/\{\{name\}\}/g,t.name).replace(/\{\{inputReadonly\}\}/g,t.inputReadonly),n=n.replace(/\{\{url\}\}/g,t.url?'data-url="'+t.url+'"':""),n=n.replace(/\{\{format\}\}/g,t.format?'data-format="'+t.format+'"':""),n=n.replace(/\{\{JSONParam\}\}/g,t.JSONParam?'data-jsonparam="'+encodeURI(JSON.stringify(t.JSONParam))+'"':""),n=n.replace(/\{\{checkType\}\}/g,t.checkType?'data-checktype="'+encodeURI(JSON.stringify(t.checkType))+'"':""),n=n.replace(/\{\{dataSize\}\}/g,t.dataSize?'data-size="'+t.dataSize+'"':""),n=n.replace(/\{\{checkSize\}\}/g,t.checkSize?'data-checksize="'+t.checkSize+'"':""),n=n.replace(/\{\{checkExp\}\}/g,t.checkExp?'data-checkexp="'+encodeURI(t.checkExp)+'"':""),"h"==a?i='<div class="bh-row" {{hidden}} data-field='+t.name+' ><div class="bh-form-group bh-col-md-6 '+t.required+' {{inputReadonly}}"><label class="bh-form-label bh-form-h-label bh-pull-left" title="'+t.caption+'">'+t.caption+'</label><div class="bh-ph-8" style="margin-left: 115px;">'+n+'</div></div><div class="bh-form-group bh-col-md-3 bh-color-caption bh-form-placeholder">'+t.placeholder+"</div></div>":"v"==a&&(i='<div class="bh-row" {{hidden}} data-field='+t.name+'><div class="bh-form-group bh-col-md-12 '+t.required+' {{inputReadonly}}" style="padding: 0 4px 0 12px;"><label class="bh-form-label  ">'+t.caption+'</label><div class="">'+n+'</div></div><div class="bh-form-group bh-col-md-12 bh-color-caption bh-form-placeholder">'+t.placeholder+"</div></div>"),i=i.replace(/\{\{hidden\}\}/g,t.hidden?'style="display: none;" hidden=true':"").replace(/\{\{inputReadonly\}\}/g,t.inputReadonly?"bh-disabled":""),e.append(i),"hidden"!=e.attr("bh-role-form-outline")&&e.attr("bh-role-form-outline","container")})},o=function(e){return{xtype:e.get("xtype"),caption:e.get("caption"),col:e.get("col")?e.get("col"):1,url:e.get("url"),name:e.get("name"),hidden:e.get("hidden"),placeholder:e.get("placeholder")?e.get("placeholder"):"",inputReadonly:e.get("readonly")?!0:!1,required:e.get("required")?"bh-required":"",checkType:e.get("checkType")?e.get("checkType"):!1,checkSize:e.get("checkSize"),dataSize:e.get("dataSize")?e.get("dataSize"):99999,checkExp:e.get("checkExp"),JSONParam:e.get("JSONParam")?e.get("JSONParam"):{},format:e.get("format")}},l=function(e,t){$.isArray(e)?$(e).each(function(){t(this)}):t(e)},$.fn.emapForm=function(t,a){var i;return i=this.data("emapform"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return"destroy"==t?this:$(this).data("emapform",new e(this,t))})},$.fn.emapForm.defaults={readonly:!1,model:"h",size:"M",cols:"3",root:"",validate:!0,renderByGroup:!0}}.call(this),$.fn.emapFormInputInit=function(e){var t=$.extend({},{root:""},e),a=t.root;$(this).find("[xtype]").each(function(){var e,i,n,o=$(this),l=t.defaultOptions?t.defaultOptions[o.attr("xtype")]||{}:{},r=o.attr("xtype");switch(r){case"select":i=$.extend({},{placeHolder:"请选择…",source:[{id:"",name:"请选择...",uid:""}],displayMember:"name",valueMember:"id",itemHeight:28,filterable:!0,width:"100%",filterPlaceHolder:"请查找",searchMode:"containsignorecase",disabled:o.data("disabled")?!0:!1},l),o.jqxDropDownList(i).on("open",function(){var e=$(this);if(!e.data("loaded")){var t=(e.val(),new $.jqx.dataAdapter({url:e.data("url"),datatype:"json",async:!1,root:"datas>code>rows",formatData:function(t){return e.data("jsonparam")&&(t=e.data("jsonparam")),t}},{beforeLoadComplete:function(e){e.unshift({id:"",name:"请选择...",uid:""})},loadComplete:function(t){e.data("loaded",!0)}}));e.jqxDropDownList({source:t})}});break;case"multi-select":e=new $.jqx.dataAdapter({url:o.data("url"),datatype:"json",root:"datas>code>rows",beforeLoadComplete:function(e){return o.data("initdata")||o.data("initdata",e),e},formatData:function(e){return e.pageSize=10,e.pageNumber=1,e.queryopt=JSON.stringify({name:"name",value:o.jqxComboBox("searchString"),builder:"include",linkOpt:"AND"}),e}}),i=$.extend({},{placeHolder:"请选择…",source:e,displayMember:"name",multiSelect:!0,remoteAutoComplete:!0,autoDropDownHeight:!0,valueMember:"id",width:"100%",height:"26px",disabled:o.data("disabled")?!0:!1,search:function(t){e.dataBind()}},l),o.jqxComboBox(i).on("keyup","input.jqx-combobox-input",function(){var e=$(this).val();if(""==e&&0==o.jqxComboBox("getItems").length){var t=o.data("initdata");$(t).each(function(){o.jqxComboBox("addItem",this)})}}),e.dataBind();break;case"selecttable":i=$.extend({},{url:o.data("url"),width:"100%"},l),o.emapDropdownTable(i);break;case"date-ym":case"date-local":case"date-full":i=$.extend({},{width:"100%",disabled:o.data("disabled"),value:null,formatString:"yyyy-MM",culture:"zh-CN",showFooter:!0,clearString:"清除",todayString:"今天"},l),"date-local"==r?i.formatString="yyyy-MM-dd":"date-full"==r&&(i.formatString="yyyy-MM-dd HH:mm",i.showTimeButton=!0),i.formatString=o.data("format")||i.formatString,o.jqxDateTimeInput(i),"date-full"!=r&&o.on("click",function(){$(this).jqxDateTimeInput("open")});break;case"radiolist":if(o.data("init"))break;e=new $.jqx.dataAdapter({url:o.data("url"),datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(e){var t="";"_"+parseInt(1e3*Math.random());$(e.datas.code.rows).each(function(){t+='<label><input type="radio" name="'+o.data("name")+'" value="'+this.id+'" /><i class="bh-choice-helper"></i>'+this.name+"</label>"}),o.html(t).data("init",!0)}}),e.dataBind();break;case"checkboxlist":if(o.data("init"))break;e=new $.jqx.dataAdapter({url:o.data("url"),datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(e){var t="";"_"+parseInt(1e3*Math.random());$(e.datas.code.rows).each(function(){t+='<label><input type="checkbox" name="'+o.data("name")+'" value="'+this.id+'" /><i class="bh-choice-helper"></i>'+this.name+"</label>"}),o.html(t).data("init",!0)}}),e.dataBind();break;case"tree":if(i=$.extend({},{url:o.data("url"),checkboxes:!1},l),o.emapDropdownTree(i),o.data("disabled")){o.emapDropdownTree("disable");var s=o.closest(".bh-form-group");s.length>0&&s.addClass("disabled")}break;case"switcher":i=$.extend({},{checked:!1,onLabel:"是",offLabel:"否"},l),o.jqxSwitchButton(i);break;case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":n=JSON.parse(decodeURI(o.data("jsonparam"))),i=$.extend({},{contextPath:a},l),$.extend(i,n),"uploadfile"==r?o.emapFileUpload(i):"uploadphoto"==r?o.emapFilePhoto(i):"uploadsingleimage"==r?o.emapSingleImageUpload(i):"uploadmuiltimage"==r&&o.emapImageUpload(i),1==o.data("disabled")&&$("input[type=file]",o).attr("disabled",!0);break;case"buttonlist":i=$.extend({},{url:o.data("url"),allOption:o.data("alloption")},l),o.bhButtonGroup(i);break;case"div":case"textarea":break;default:o.jqxInput({width:"100%"})}})},function(e){function t(e,t){n(t),i("list",e,t),a(e,t)}function a(t,a){a.find(".bh-switch-item").click(function(n){var o=e(n.currentTarget).attr("data-x-type");e(".bh-switch-item").removeClass("bh-active"),e(n.currentTarget).addClass("bh-active"),i(o,t,a)}),a.find(".bh-grid-table").on("pageSizeChanged",function(e){var t=e.args;c=t.pagenum,p=t.pageSize}),a.find(".bh-grid-table").on("pageChanged",function(e){var t=e.args;c=t.pagenum,p=t.pageSize})}function i(e,t,a){s=e,"list"==e?(a.find(".bh-grid-table").prop("rendered")?(a.find(".bh-grid-table").jqxDataTable({pageSize:p||12}),a.find(".bh-grid-table").jqxDataTable("goToPage",c||0),a.find(".bh-grid-table").emapdatatable(!0).source.data=d,a.find(".bh-grid-table").jqxDataTable("updateBoundData")):o(t,a),a.find(".bh-grid-table").show(),a.find(".bh-grid-card").hide()):"card"==e&&(d.pageSize=p,d.pageNumber=0===c?c+"":c,a.find(".bh-grid-card").prop("rendered")?a.find(".bh-grid-card").emapCard("reload",d):l(t,a),a.find(".bh-grid-table").hide(),a.find(".bh-grid-card").show())}function n(e){var t='<div class="bh-grid-container">	<div class="bh-switch-card-view">   	<span class="bh-switch-item bh-switch-list bh-active" data-x-type="list"><i class="iconfont icon-viewlist"></i><span>列表</span></span>   	<span class="bh-switch-item bh-switch-card" data-x-type="card"><i class="iconfont icon-viewmodule"></i><span>卡片</span></span>	</div>	<div class="bh-grid-table"></div>	<div class="bh-grid-card"></div></div>';e.html(t)}function o(t,a){var i=e.extend({},t);delete i.template,i.pageSize=p||12,i.pageSizeOptions=[12,24,48,96],a.find(".bh-grid-table").prop("rendered",!0),a.find(".bh-grid-table").emapdatatable(i)}function l(e,t){e.params=d,e.pageSize=p,e.pageNumber=c,e.pageSizeOptionsChange=function(e,t){p=e,c=t},t.find(".bh-grid-card").prop("rendered",!0),t.find(".bh-grid-card").emapCard(e)}var r,s="table",d={},c=null,p=null;r=function(){function a(a,i){this.settings=e.extend({},e.fn.emapGrid.defaults,i),this.$element=e(a),t(this.settings,this.$element)}return a}(),r.prototype={reload:function(e){d=e||d,i(s,this.settings,this.$element,e)}},e.fn.emapGrid=function(t,a){var i;return(i=this.data("emapGrid"))?t===!0?i:("string"===e.type(t)&&i[t](a),this):this.each(function(){return e(this).data("emapGrid",new r(this,t))})},e.fn.emapGrid.defaults={}}(jQuery),function(){var e,t,a,i="FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapImageUpload.defaults,a),this.$element=$(e),t(this.$element,this.options)}e.prototype.getFileToken=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.saveTempFile=function(){return this.options.fileInput.emapUploadCore("saveTempFile")},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},t=function(e,t){var a=parseInt(t.width)-6,n=parseInt(t.height)-6;$(e).addClass("bh-clearfix").append('<p class="bh-file-img-info"></p><div class="bh-file-img-container"><div class="bh-file-img-input bh-file-img-block" style="width: '+t.width+"px;height: "+t.height+'px;"><span><span class="bh-file-img-plus">+</span><span class="bh-file-img-text">点击上传</span></span><input type="file" '+(t.multiple?"multiple":"")+"></div></div>"),t.fileInput=$("input[type=file]",e).parent();var o="请上传图片";t.type&&t.type.length>0&&(o+=", 支持"+t.type.join(",").toUpperCase()+"类型"),t.size&&t.size>0&&(o+=",大小在"+t.size+"K以内"),t.limit&&t.limit>0&&(o+=",数量在"+t.limit+"以内"),$(".bh-file-img-info",e).html(o),t.height<=100&&$(".bh-file-img-text",e).hide(),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(i){if(i.success){var o="";$(i.items).each(function(){o+='<div class="bh-file-img-block saved" data-fileid="'+this.id+'" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-loading" style="line-height: '+n+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+a+"px;height: "+n+'px;"><span style="width: '+a+"px;height: "+n+'px;"><img src="'+this.fileUrl+'" style="max-width: '+a+"px;max-height: "+n+'px;" /></span></div><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div>'}),$(".bh-file-img-input",e).before(o)}}}),t.fileInput.emapUploadCore($.extend({},t,{add:function(i,o){var l=o.files,r=(new Date).getTime();$(l).each(function(i){o.files[i].bhId=r+i,$(".bh-file-img-input",e).before('<div class="bh-file-img-block loading" data-bhid="'+o.files[i].bhId+'" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-loading" style="line-height: '+n+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+a+"px;height: "+n+'px;"><span style="width: '+a+"px;height: "+n+'px;"><img style="max-width: '+a+"px;max-height: "+n+'px;" /></span></div><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div>')}),t.add&&t.add(i,o),o.submit()},submit:function(a,n){var o=n.files[0],l=$(".bh-file-img-block[data-bhid="+o.bhId+"]",e);if(t.limit){var r=$(".bh-file-img-block",e).length-1;if(r>t.limit)return l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件数量超出限制"),!1}return t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(o.name.toUpperCase())?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件类型不正确"),!1):i&&t.size&&o.size/1024>t.size?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件大小超出限制"),!1):(l.data("xhr",n),void(t.submit&&t.submit(a,n)))},done:function(a,i){var n=i.files[0],o=$(".bh-file-img-block[data-bhid="+n.bhId+"]",e);o.removeClass("loading").addClass("success"),$("img",o).attr("src",i.result.tempFileUrl),o.data({fileid:i.result.id,deleteurl:i.result.deleteUrl}),t.done&&t.done(a,i)},fail:function(a,i){var n=i.files[0],o=$(".bh-file-img-block[data-bhid="+n.bhId+"]",e);o.removeClass("loading").addClass("error").find(".bh-file-img-fail").html(i.result.error?i.result.error:"上传失败"),t.fail&&t.fail(a,i)}})),$(e).on("click",".bh-file-img-delete",function(){var e=$(this).closest(".bh-file-img-block");e.hasClass("success")?t.fileInput.emapUploadCore("deleteTempFile",{url:e.data("deleteurl"),fileId:e.data("fileid"),done:function(t){e.remove()}}):e.hasClass("error")?e.remove():e.hasClass("loading")?(e.data("xhr").abort(),e.remove()):e.hasClass("saved")&&(t.fileInput.emapUploadCore("deleteArrAdd",e.data("fileid")),e.remove())})},a=function(e,t){var a=$(".bh-file-img-block",e).length-1,i=$(".bh-file-img-input",e);a>=t.limit?i.hide():i.show()},$.fn.emapImageUpload=function(t,a){var i;return i=this.data("plugin"),i?t===!0?i:"string"===$.type(t)?i[t](a):void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapImageUpload.defaults={multiple:!1,dataType:"json",storeId:"image",width:200,height:150,type:["jpg","png","bmp"],size:0}}()}.call(this),$.emapImport=function(e){e.content='<div class="bh-import-content"><div class="bh-import-step active"><h5 class="bh-import-step-title"><span>1</span>上传文件</h5><div class="bh-import-step-content bh-import-step1-content"><a href="javascript:void(0)" class="bh-btn bh-btn-primary bh-import-input-a">开始上传<input type="file" role="fileInput"/></a><p class="bh-color-caption bh-import-p bh-import-step1-intro">如果您是初次使用，建议您<a role="downTplBtn" href="javascript:void(0)">下载导入模板</a>进行查看。</p></div><div class="bh-import-step-content bh-import-step1-content" style="display: none;"><a href="javascript:void(0)" role="importConfirmBtn" class="bh-btn bh-btn-primary bh-pull-right">确认上传</a><a href="javascript:void(0)" class="bh-pull-right bh-import-reload-a" role="reImportBtn">重新上传</a><p class="bh-color-caption bh-import-p  bh-import-step1-file"><span class="bh-import-file-name">2015级教职工统计表.docx</span><span class="bh-import-file-size"></span></p></div></div><div class="bh-import-step "><h5 class="bh-import-step-title"><span>2</span>导入数据</h5><div class="bh-import-step-content"><p class="bh-import-step2-intro">等待文件上传完毕后自动导入数据</p><div class="bh-import-step2-content"><div class="bh-import-loading-bar"><div></div></div><p class="bh-import-step2-count"></p></div></div></div><div class="bh-import-step "><h5 class="bh-import-step-title"><span>3</span>完成</h5><div class="bh-import-step-content bh-import-step3-content"><button role="closeConfirmBtn" class="bh-btn bh-btn-primary bh-pull-right">确定关闭</button><p class="bh-import-result-detail">该文件全部导入数据10000条，其中失败导入2条</p><p>具体结果可查看<a class="bh-import-export" href="javascript:void(0)">下载导入结果</a>查看明细。</p></div></div></div>',BH_UTILS.bhWindow(e.content,"导入数据",{},{close:function(){e.closeCallback&&""!=e.closeCallback&&e.closeCallback()}}),e.preCallback&&""!=e.preCallback&&e.preCallback(),$("[role=fileInput]").emapImportData(e)},$.fn.emapImportData=function(e){function t(e,t,a){$("[role=fileInput]",n).data("loading",!1),$("div.bh-import-step-content:eq(2)",n).html("<p>数据导入完成</p>"),$("div.bh-import-step:eq(2)",n).addClass("active").find(".bh-import-result-detail").html("该文件全部导入数据"+e+"条，其中失败导入"+(e-t)+"条"),a&&""!=a&&a($("div.bh-import-step:eq(2)",n).find(".bh-import-export"))}var a,i,n=$(this).closest(".bh-import-content"),o={app:e.app,module:e.module,page:e.page,action:e.action,storeId:e.storeId?e.storeId:"imexport"},l=e.contextPath;e.params&&$.extend(o,e.params),a=Date.parse(new Date),i=a+1,$(this).fileupload({autoUpload:!1,url:l+"/sys/emapcomponent/file/uploadTempFile/"+a+"/"+i+".do",dataType:"json",formData:{storeId:e.storeId?e.storeId:"file"},add:function(e,t){var a=t.files,i=$(this).closest(".bh-import-step").find(".bh-import-step-content");if(e.target.files){i.eq(0).hide(),i.eq(1).show();var o=a[0].name.split(".");if(!new RegExp("xlsx|xlsm|xltx|xltm|xlsb|xlam|xls").test(o[o.length-1].toLowerCase()))return i.eq(1).find("span.bh-import-file-name").html('<span class="bh-color-danger">请上传正确的Ecxel文件</span>').attr("title",a[0].name),$("[role=importConfirmBtn]",n).attr("disabled",!0),!1;i.eq(1).find("span.bh-import-file-name").text(a[0].name).attr("title",a[0].name),i.eq(1).find("span.bh-import-file-size").text("("+a[0].size/1024+"k)"),$("[role=importConfirmBtn]",n).attr("disabled",!1)}$("[role=importConfirmBtn]",n).unbind("click").bind("click",function(){$("[role=fileInput]",n).data("loading",!0);var e=$(this).closest(".bh-import-step-content");e.children("a").hide(),e.prepend('<div class="bh-import-step1-loading-block bh-pull-right"><div class="sk-spinner sk-spinner-fading-circle bh-pull-right" style="height: 28px; width: 28px;"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div><p class="bh-pull-right" style="margin-right: 12px;line-height:28px;">上传中……</p></div>'),t.submit()})},done:function(r,s){if(s.result.success){var d=s.result.id;o.attachment=s.result.id,$.ajax({type:"post",url:l+"/sys/emapcomponent/file/saveAttachment/"+a+"/"+i+".do",data:{attachmentParam:JSON.stringify({scope:a,fileToken:i,attachmentParam:{storeId:o.storeId}})},success:function(a){$.ajax({type:"post",url:l+"/sys/emapcomponent/imexport/importRownum.do",data:$.extend(o,{app:o.app,attachment:d}),success:function(a){$(".bh-import-step2-count",n).html("本次共导入数据"+JSON.parse(a).rowNumber+"条"),$(".bh-import-step1-content",n).find("div.bh-import-step1-loading-block").remove(),$("div.bh-import-step:eq(1)",n).addClass("active"),$(".bh-import-loading-bar div",n).animate({width:"87%"},3e3),$.ajax({type:"post",url:l+"/sys/emapcomponent/imexport/import.do",data:o,success:function(a){var a=JSON.parse(a);1==a.status?$(".bh-import-loading-bar div",n).stop().animate({width:"100%"},500,function(){if(e.importCallback&&""!=e.importCallback){var i=$.extend({total:a.total,success:a.success,callback:null},e.importCallback(a.total,a.success));t(i.total,i.success,i.callback)}else t(a.total,a.success,function(e){});$("div.bh-import-step:eq(2)",n).find(".bh-import-export").attr("href",l+"/sys/emapcomponent/file/getAttachmentFile/"+a.attachment+".do"),1==e.autoClose&&BH_UTILS.bhWindow.close()}):($("[role=fileInput]",n).data("loading",!1),$("div.bh-import-step-content:eq(2)",n).html("<p></p>"),$("div.bh-import-step:eq(2)",n).addClass("active").find(".bh-import-result-detail").html('<span style="color: red">导入失败</span>'))}})},error:function(e){}})}})}}}),$("[role=reImportBtn]",n).on("click",function(){$("[role=fileInput]",n).click()}),$("[role=closeConfirmBtn]",n).on("click",function(){BH_UTILS.bhWindow.close()}),$("[role=downTplBtn]",n).on("click",function(){e.tplUrl&&""!=e.Url?location.href=e.tplUrl:$.ajax({type:"post",url:l+"/sys/emapcomponent/imexport/importTemplate.do",data:o,success:function(e){location.href=l+"/sys/emapcomponent/file/getAttachmentFile/"+JSON.parse(e).attachment+".do"},error:function(e){console.log(e)}})})},function(){var e,t;e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapRepeater.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e.prototype.getValue=function(){var e=[];$(this.$element).find(".repeateritem").each(function(){var t=$(this).data("value");void 0!==t&&e.push($(this).data("value"))}),this.$element.val(e)},e.prototype.setValue=function(e){$(this.$element).find(".repeateritem").each(function(){$(this).trigger("setValue",[e])})},e}(),t=function(e,t){var a=e,i={datatype:"json",root:"datas>code>rows",datafields:[{name:"id"},{name:"name"}],id:"id",url:t.url,data:t.params},n=new $.jqx.dataAdapter(i,{loadComplete:function(){for(var e=n.records,i=0;i<e.length;i++){var o=e[i],l=$("<div class='repeateritem'></div>");"horizontal"==t.align&&l.css({"float":"left"}),t.render(l,o),a.append(l)}}});n.dataBind()},$.fn.emapRepeater=function(t,a){var i;return(i=this.data("emapRepeater"))?t===!0?i:("string"===$.type(t)&&i[t](a),this):this.each(function(){return $(this).data("emapRepeater",new e(this,t))})},$.fn.emapRepeater.defaults={align:"vertical",itemWidth:"50%"}}.call(this),function(){function e(e,a){e.html(d),t(e,a)}function t(e,t){$(".bh-ers-j-add-btn",e).on("click",function(){a(e,t)}),e.on("click",".bh-ers-close",function(){var e=$(this);BH_UTILS.bhDialogWarning({title:"确定要删除该条件吗？",buttons:[{text:"确定",className:"bh-btn-warning",callback:function(){e.parent().remove()}},{text:"取消",className:"bh-btn-default"}]})}),e.on("change",".bh-ers-select .bh-ers-nice-select",function(){var e=$(this).closest(".bh-ers-row"),a=t.data.controls,i=$(this).val(),n=a.filter(function(e){return e.name==i})[0];o(t,n,e)})}function a(e,t,a){var n=$('<div class="bh-clearfix bh-ers-row" ></div>'),l=t.data.controls;if(n.append('<div class="'+(t.showBuilder?"bh-ers-col-3":"bh-ers-col-2")+'"><div class="bh-ers-select"></div></div>'),t.showBuilder&&n.append('<div class="bh-ers-col-3"><div class="bh-ers-builder"></div></div>'),n.append('<div class="'+(t.showBuilder?"bh-ers-col-3":"bh-ers-col-2")+'"><div class="bh-ers-option"></div></div>'),n.append('<i class="iconfont icon-close bh-ers-close"></i>'),i({dom:$(".bh-ers-select",n),source:l}),$(".bh-ers-j-condition",e).append(n),a){var r=l.filter(function(e){return e.name==a.name})[0];$(".bh-ers-select select",n).val(a.name),o(t,r,n)}else o(t,l[0],n);a&&($(".bh-ers-builder select",n).val(a.builder),$(".bh-ers-option select, .bh-ers-option input",n).val(a.value))}function i(e){var t=$('<select class="bh-ers-nice-select"></select>');$(e.source).each(function(){t.append('<option value="'+this.name+'">'+this.caption+"</option>")}),e.dom.html(t),e.dom.append('<i class="iconfont icon-arrowdropdown bh-ers-nice-select-arrow"></i>')}function n(e){var t=$('<select class="bh-ers-nice-select"></select>');$(e.source).each(function(){t.append('<option value="'+this.id+'">'+this.name+"</option>")}),e.dom.html(t),e.dom.append('<i class="iconfont icon-arrowdropdown bh-ers-nice-select-arrow"></i>')}function o(e,t,a){var o=t.builderList;switch(i({dom:$(".bh-ers-builder",a),source:e.data.builderLists[o]}),t.xtype){case"select":case"radiolist":case"checkboxlist":l(t.url,function(e){n({dom:$(".bh-ers-option",a),source:e})});break;case"date-local":case"date-ym":case"date-full":$(".bh-ers-option",a).empty().append('<div class="bh-ers-control"></div>'),$(".bh-ers-option div",a).jqxDateTimeInput({width:"100%",value:null,formatString:"yyyy-MM-dd",culture:"zh-CN"});break;default:$(".bh-ers-option",a).html('<input class="bh-form-control bh-ers-control" type="text">')}}function l(e,t){var a=new $.jqx.dataAdapter({url:e,datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(e){t(e.datas.code.rows)}});a.dataBind()}function r(e,t){var a=[];return $(".bh-ers-row",e).each(function(){var e,t=$(this);if(e=0==$(".bh-ers-option .bh-ers-control",t).length?$(".bh-ers-option .bh-ers-nice-select",t).val():$(".bh-ers-option .bh-ers-control",t).val(),!e||""==$.trim(e))return!0;var i={name:$(".bh-ers-select .bh-ers-nice-select",t).val(),value:e,linkOpt:"AND"};$(".bh-ers-builder .bh-ers-nice-select",t).length>0?i.builder=$(".bh-ers-builder .bh-ers-nice-select",t).val():i.builder=$("bh-.ers-control",t).val(),a.push(i)}),JSON.stringify(a)}var s,d='<div class="bh-ers-j-condition"></div><div class="bh-ers-add bh-ph-8 bh-ers-j-add-btn"><i class="iconfont icon-addcircle"></i><span>添加条件</span></div>';s=function(){function t(t,a){this.options=$.extend({},$.fn.emapRuleSetting.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.getValue=function(){return r(this.$element,this.options)},t.prototype.setValue=function(e){var t,i=this;$(".bh-ers-j-condition",i.$element).empty(),e&&null!=e&&""!=e&&(t="string"==typeof e?JSON.parse(e):e,t.length&&t.length>0&&$(t).each(function(){a(i.$element,i.options,this)}))},t}(),$.fn.emapRuleSetting=function(e,t){var a;return a=this.data("emapRuleSetting"),a?e===!0?a:"string"===$.type(e)?a[e](t):this:this.each(function(){return $(this).data("emapRuleSetting",new s(this,e))})},$.fn.emapRuleSetting.defaults={showBuilder:!0,builderData:[{name:"等于",id:"equal"}]}}.call(void 0),function(e,t){e.getPageMeta=function(t,a){var a=a||{"*json":"1"},i=BH_UTILS.doSyncAjax(e.getAbsPath(t),a);return window._EMAP_PageMeta=window._EMAP_PageMeta||{},window._EMAP_PageMeta[t]=i,"undefined"!=typeof i.loginURL&&(window._EMAP_PageMeta={}),i},e.getModel=function(t,a,i){var n,o=this.getPageMeta(t);if("search"==i){var l=e.getAbsPath(t).replace(".do","/"+a+".do");o=BH_UTILS.doSyncAjax(l,{"*searchMeta":"1"}),n=o.searchMeta}else{var r=o.models.filter(function(e){return e.name==a});n=r[0]}return e.modelName=n.modelName,e.appName=n.appName,e.url=n.url,e.name=n.name,this.convertModel(n,i)},e.convertModel=function(e,a){return e===t||null==e?t:a===t?e.controls:(e.controls.map(function(e){e.get=function(e){return this[a+"."+e]!==t?this[a+"."+e]:this[e]}}),"search"==a?e:e.controls)},e.getData=function(a,i,n){window._EMAP_PageMeta=window._EMAP_PageMeta||{};var o=window._EMAP_PageMeta[a];o===t&&(o=this.getPageMeta(a));var l=o.models.filter(function(e){return e.name==i}),r=a.substring(0,a.indexOf("/"))+"/"+l[0].url,s=BH_UTILS.doSyncAjax(e.getAbsPath(r),n);return s===t||null==s?(s={code:0,msg:"没有数据",datas:{}},{rows:[]}):(s.result!==t&&s.result.datas!==t&&(s=s.result),s.datas[i])},e.getCode=function(e,a,i,n,o){var l={};a&&(l.id=a),i&&(l.name=i),n&&(l.pid=n),o&&(l.searchValue=o);var r=BH_UTILS.doSyncAjax(e,l);return r===t||null==r?t:r.datas.code.rows},e.buildCodeSearchParam=function(e,t){if($.isArray(e)){for(var a=e,i=[],n=a.length-1;n>=0;n--)i.push({name:a[n].name,value:a[n].value,linkOpt:"and",builder:"equal"});return{searchValue:JSON.stringify(i)}}return{searchValue:JSON.stringify([{name:e,value:t,linkOpt:"and",builder:"equal"}])}},e.getContextPath=function(){var e=window.location.pathname,t=e.indexOf("/sys/");return e.substring(0,t)||"/emap"},e.getAppPath=function(){var t=window.location.pathname,a=t.indexOf("/sys/")+"/sys/".length,i=t.substring(a,t.length),n=i.substring(0,i.indexOf("/"));return e.getContextPath()+"/sys/"+n},e.getAbsPath=function(t){if("http://"==t.substring(0,7)||"https://"==t.substring(0,8))return t;"/"==t.substring(0,1)&&(t=t.substring(1,t.length));var a=(t.match(/module*(.*?)\//),e.getAppPath()+"/"+t);return a},e._setEditControlValue=function(a,i,n,o,l){function r(e,t){"object"==typeof t?(e.jqxDropDownList("addItem",t[0]),e.jqxDropDownList("checkAll")):""==t?e.jqxDropDownList("clearSelection"):e.val(t)}switch(n){case"multi-select":if(o[i+"_DISPLAY"]){var s=a.jqxComboBox("getItems").map(function(e){return e.value}),d=o[i+"_DISPLAY"].split(",");o[i].split(",").map(function(e,t){$.inArray(e,s)<0&&a.jqxComboBox("addItem",{id:e,name:d[t]}),a.jqxComboBox("selectItem",e)})}else e._getInputOptions(a.data("url"),function(e){a.data("model",e);var t=o[i].split(","),n=a.jqxComboBox("getItems").map(function(e){return e.value});$(e).each(function(){$.inArray(this.id,t)>-1&&($.inArray(this.id,n)<0&&a.jqxComboBox("addItem",this),a.jqxComboBox("selectItem",this.id))})});break;case"select":a.jqxDropDownList("getItemByValue",o[i])?r(a,o[i]):o[i+"_DISPLAY"]?(a.jqxDropDownList("addItem",{id:o[i],name:o[i+"_DISPLAY"]}),r(a,o[i])):e._getInputOptions(a.data("url"),function(e){$(e).each(function(){a.jqxDropDownList("addItem",this)}),r(a,o[i])});break;case"selecttable":a.emapDropdownTable("setValue",[o[i],o[i+"_DISPLAY"]]);break;case"radiolist":o[i]!==t&&null!==o[i]&&""!==o[i]?$("input[type=radio][value="+o[i]+"]",a).prop("checked",!0):$("input[type=radio]",a).prop("checked",!1);break;case"checkboxlist":o[i]!==t&&null!==o[i]&&""!==o[i]?$(o[i].split(",")).each(function(){$('input[type=checkbox][value="'+this+'"]',a).prop("checked",!0)}):$("input[type=checkbox]",a).prop("checked",!1),a.emapRepeater("setValue",o[i]);break;case"switcher":a.jqxSwitchButton({checked:1*o[i]});break;case"uploadfile":a.emapFileUpload("destroy"),a.emapFileUpload($.extend({},JSON.parse(decodeURI(a.data("jsonparam"))),{contextPath:l,token:o[i]}));break;case"uploadphoto":a.emapFilePhoto("destroy"),a.emapFilePhoto($.extend({},JSON.parse(decodeURI(a.data("jsonparam"))),{contextPath:l,token:o[i]}));break;case"uploadsingleimage":a.emapSingleImageUpload("destroy"),a.emapSingleImageUpload($.extend({},JSON.parse(decodeURI(a.data("jsonparam"))),{contextPath:l,token:o[i]}));break;case"uploadmuiltimage":a.emapImageUpload("destroy"),a.emapImageUpload($.extend({},JSON.parse(decodeURI(a.data("jsonparam"))),{contextPath:l,token:o[i]}));break;case"tree":o[i+"_DISPLAY"]?a.emapDropdownTree("setValue",[o[i],o[i+"_DISPLAY"]]):e._getInputOptions(a.data("url"),function(e){a.data("model",e),$(e).each(function(){return this.id==o[i]?(a.emapDropdownTree("setValue",[this.id,this.name]),!1):void 0})});break;default:a.val(o[i])}},e._getInputOptions=function(e,t){var a=new $.jqx.dataAdapter({url:e,datatype:"json",root:"datas>code>rows"},{loadComplete:function(e){t(e.datas.code.rows)}});a.dataBind()},e._html2Escape=function(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})},window.WIS_CONFIG==t||WIS_CONFIG.ROOT_PATH!==t&&""!=WIS_CONFIG.ROOT_PATH||(WIS_CONFIG.ROOT_PATH=e.getAppPath())}(window.WIS_EMAP_SERV=window.WIS_EMAP_SERV||{}),function(){var e,t,a="FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapSingleImageUpload.defaults,a),
this.$element=$(e),t(this.$element,this.options)}e.prototype.getFileToken=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.saveTempFile=function(){return this.options.fileInput.emapUploadCore("saveTempFile")},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},t=function(e,t){var i=parseInt(t.width)-6,n=parseInt(t.height)-6;$(e).addClass("bh-clearfix").append('<p class="bh-file-img-info"></p><div class="bh-file-img-container" style="width: '+t.width+'px;"><div class="bh-file-img-input bh-file-img-block bh-file-img-single-block" style="width: '+t.width+"px;height: "+t.height+'px;"><span class="bh-file-img-single-info"><span class="bh-file-img-plus">+</span><span class="bh-file-img-text">点击上传</span></span><input type="file"><div class="bh-file-img-loading" style="line-height: '+n+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+i+"px;height: "+n+'px;"><span style="width: '+i+"px;height: "+n+'px;"><img style="max-width: '+i+"px;max-height: "+n+'px;" /></span></div></div><div class="bh-file-img-single-edit"><a href="javascript:void(0)" class="bh-file-img-retry">重新上传</a><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div></div>');var o="请上传图片";t.type&&t.type.length>0&&(o+=", 支持"+t.type.join(",").toUpperCase()+"类型"),t.size&&t.size>0&&(o+=",大小在"+t.size/1e3+"K以内"),$(".bh-file-img-info",e).html(o),t.height<=100&&$(".bh-file-img-text",e).hide(),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(t){if(t.success&&t.items&&t.items.length>0){var a=$(".bh-file-img-container",e);$(".bh-file-img-table img",a).attr("src",t.items[0].fileUrl),a.addClass("saved").data({fileid:t.items[0].id})}}}),t.fileInput=$("input[type=file]",e).parent(),t.fileInput.emapUploadCore($.extend({},t,{add:function(a,i){i.files[0];$(".bh-file-img-container",e).addClass("loading"),t.add&&t.add(a,i),i.submit()},submit:function(i,n){var o=n.files[0],l=$(".bh-file-img-container",e);return t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(o.name.toUpperCase())?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件类型不正确"),!1):a&&t.size&&o.size/1024>t.size?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件大小超出限制"),!1):(l.data("xhr",n),void(t.submit&&t.submit(i,n)))},done:function(a,i){var n=(i.files[0],$(".bh-file-img-container",e));n.removeClass("loading").addClass("success"),t.tempUpload=!0,$("img",n).attr("src",i.result.tempFileUrl),n.data({fileid:i.result.id,deleteurl:i.result.deleteUrl}),t.done&&t.done(a,i)},fail:function(a,i){var n=(i.files[0],$(".bh-file-img-container",e));n.removeClass("loading").addClass("error").find(".bh-file-img-fail").html(i.result.error?i.result.error:"上传失败"),t.fail&&t.fail(a,i)}})),$(e).on("click",".bh-file-img-delete",function(){var e=$(this).closest(".bh-file-img-container");e.hasClass("success")?t.fileInput.emapUploadCore("deleteTempFile",{url:e.data("deleteurl"),fileId:e.data("fileid"),done:function(t){e.removeClass("success"),$(".bh-file-img-table img",e).attr("src","")}}):e.hasClass("error")?e.removeClass("error"):e.hasClass("loading")?(e.data("xhr").abort(),e.removeClass("loading")):e.hasClass("saved")&&(t.fileInput.emapUploadCore("deleteArrAdd",e.data("fileid")),e.removeClass("saved"),$(".bh-file-img-table img",e).attr("src",""),t.tempUpload=!0)}),$(e).on("click",".bh-file-img-retry",function(){var a=$(".bh-file-img-container",e);t.fileInput.emapUploadCore("deleteArrAdd",a.data("fileid")),a.removeClass("saved success fail loading"),$(".bh-file-img-table img",a).attr("src",""),$("input[type=file]",a).click()})},$.fn.emapSingleImageUpload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapSingleImageUpload.defaults={tempUpload:!1,multiple:!1,dataType:"json",storeId:"image",width:200,height:150,type:["jpg","png","bmp"],size:0}}()}.call(this),function(){var e,t,a;"FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapUploadCore.defaults,a),this.$element=$(e),this.options.token&&""!=this.options.token?(this.options.scope=this.options.token.substring(0,this.options.token.length-1),this.options.newToken=!1):(this.options.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),this.options.token=this.options.scope+1,this.options.newToken=!0),this.options.arrToDelete=[],this.options.uploadUrl=this.options.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+this.options.scope+"/"+this.options.token+".do",t(this.$element,this.options)}e.prototype.getFileToken=function(){return this.options.token},e.prototype.getFileUrl=function(){var e,t=this.options;return $.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",async:!1,success:function(t){t.success&&(e=$(t.items).map(function(){return this.fileUrl}).get())}}),e},e.prototype.deleteArrAdd=function(e){-1==this.options.arrToDelete.indexOf(e)&&this.options.arrToDelete.push(e)},e.prototype.deleteArrRemove=function(e){var t=this.options.arrToDelete.indexOf(e);t>-1&&this.options.arrToDelete.splice(t,1)},e.prototype.saveTempFile=function(){var e=this.options;this.$element.emapUploadCore("deleteFormalFile");var t=!1;return $.ajax({type:"post",async:!1,url:e.contextPath+"/sys/emapcomponent/file/saveAttachment/"+e.scope+"/"+e.token+".do",data:{attachmentParam:JSON.stringify(this.options.attachmentParams)},dataType:"json",success:function(a){a.success&&(t=e.token)}}),t},e.prototype.deleteFormalFile=function(e){function t(e){var t=[e,e+"_1",e+"_2"];t.map(function(e){$.ajax({type:"post",url:a.contextPath+"/sys/emapcomponent/file/deleteFileByWid/"+e+".do",dataType:"json",success:function(e){}})})}var a=this.options;if(e)t(e);else{var i=this.options.arrToDelete;if(i.length>0)for(var n=0;n<i.length;n++)t(i[n])}},e.prototype.deleteTempFile=function(e){var t=this.options;$.ajax({type:"post",url:e.url,dataType:"json",data:{attachmentParam:JSON.stringify({storeId:t.storeId,scope:t.scope,fileToken:t.token,items:[{id:e.fileId,status:"Delete"}]})},success:function(t){t.success&&e.done&&e.done(t)}})},e.prototype.deleteFileByToken=function(){var e=this.options;$.ajax({type:"post",url:e.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+e.token+".do",async:!1,dataType:"json"}).done(function(e){})},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},e.prototype.reload=function(){var e=this.options;e.newToken=!0,e.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),e.token=this.options.scope+1,e.uploadUrl=this.options.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+this.options.scope+"/"+this.options.token+".do",e.arrToDelete=[],e.attachmentParams={storeId:e.storeId,scope:e.scope,fileToken:e.token,params:e.params},$("input[type=file]",this.$element).fileupload({url:e.uploadUrl})},t=function(e,t){t.attachmentParams={storeId:t.storeId,scope:t.scope,fileToken:t.token,params:t.params},0==$("input[type=file]",e).length&&e.append('<input type="file" name="bhFile" />'),$("input[type=file]",e).fileupload({url:t.uploadUrl,autoUpload:!0,multiple:t.multiple,dataType:"json",limitMultiFileUploads:2,formData:{size:t.size,type:t.type,storeId:t.storeId},add:function(e,a){var i=!0;return t.add&&(i=t.add(e,a)),i===!1?!1:void a.submit()},submit:function(e,a){var i=!0;return t.submit&&(i=t.submit(e,a)),i===!1?!1:void 0},done:function(a,i){i.files[0];i.result.success?(t.done&&t.done(a,i),e.trigger("bh.file.upload.done",i)):t.fail&&t.fail(a,i)},fail:function(e,a){t.fail&&t.fail(e,a)}})},a=function(e,t){function a(e){$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/deleteFileByWid/"+e+".do",dataType:"json",success:function(e){}})}var i=t.arrToDelete;if(i.length>0)for(var n=0;n<i.length;n++)a(i[n]),a(i[n]+"_1"),a(i[n]+"_2")},$.fn.emapUploadCore=function(t,a){var i;return i=this.data("emapuploadcore"),i?t===!0?i:"string"===$.type(t)?i[t](a):void 0:this.each(function(){return"destroy"==t?this:$(this).data("emapuploadcore",new e(this,t))})},$.fn.emapUploadCore.defaults={multiple:!1,dataType:"json",storeId:"file",type:[],size:0}}()}.call(this),function(){var e,t,a,i;e=function(){function e(e,a){$.fn.emapValidate.rules?$.fn.emapValidate.allRules=$.extend({},$.fn.emapValidate.defaultRules,$.fn.emapValidate.rules):$.fn.emapValidate.allRules=$.fn.emapValidate.defaultRules,this.options=$.extend({},$.fn.emapValidate.defaults,a),this.$element=$(e),t($(e),a)}return e.prototype.validate=function(){return this.$element.jqxValidator("validate")},e.prototype.destroy=function(){return this.options=null,$(this.$element).data("validate",!1).find(".jqx-validator-error-info").remove(),this.$element.jqxValidator("destroy")},e}(),t=function(e,t){var i=a(e,t);t.callback&&t.callback(i),e.jqxValidator({useHintRender:!0,rules:i})},a=function(e,t){var a=[];return $("[xtype]",e).each(function(){var e,t=$(this);if(t.closest(".bh-row").attr("hidden")||t.closest(".bh-form-group").hasClass("bh-disabled"))return!0;var n=t.closest(".bh-row"),o=t.data("name"),l=$("label.bh-form-label",n).text(),r=t.attr("xtype");$(".bh-required",n).length>0&&(e={input:"[data-name="+o+"]",message:l+"不能为空",action:"change, blur, valuechanged",rule:"required"},("select"==r||"date-local"==r||"date-ym"==r||"date-full"==r||"selecttable"==r)&&(e.rule=function(){return""!=t.val()}),"tree"==r&&(e.rule=function(){return""!=t.emapDropdownTree("getValue")}),"multi-select"==r&&(e.rule=function(){return""!=t.jqxComboBox("getSelectedItems").map(function(e){return e.value}).join(",")}),a.push(e));var s=t.data("checksize");s||(s=t.data("size")?t.data("size"):0),s&&(e={input:"[data-name="+o+"]",message:l+"长度超出限制",action:"change, blur, valuechanged",rule:function(){return i(t.val())<=s}},"multi-select"==r&&(e.message="最多选择"+s+"项",e.rule=function(){return t.jqxComboBox("getSelectedItems").length<=s}),a.push(e));var d=(decodeURI(t.data("checkexp")),decodeURI(t.data("checktype")));d=d.replace(/\[|\]|\"|custom/g,""),$.fn.emapValidate.allRules[d]&&(e={input:"[data-name="+o+"]",message:$.fn.emapValidate.allRules[d].alertText,action:"change, blur, valuechanged"},$.fn.emapValidate.allRules[d].regex?e.rule=function(){return""==t.val()?!0:new RegExp($.fn.emapValidate.allRules[d].regex).test(t.val())}:$.fn.emapValidate.allRules[d].func&&(e.rule=function(){return""==t.val()?!0:$.fn.emapValidate.allRules[d].func(t.val())}),a.push(e))}),a},i=function(e){return e.replace(/[\u4E00-\u9FA5]/g,"***").length},$.fn.emapValidate=function(t){var a;return a=this.data("validate"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return $(this).data("validate",new e(this,t))})},$.fn.emapValidate.defaults={},$.fn.emapValidate.defaultRules={dateRange:{regex:"none",alertText:"* 无效的 ",alertText2:" 日期范围"},dateTimeRange:{regex:"none",alertText:"* 无效的 ",alertText2:" 时间范围"},minSize:{regex:"none",alertText:"最少 ",alertText2:" 个字符"},maxSize:{regex:"none",alertText:"最多 ",alertText2:" 个字符"},groupRequired:{regex:"none",alertText:"* 至少填写其中一项"},min:{regex:"none",alertText:"* 最小值为 "},max:{regex:"none",alertText:"* 最大值为 "},past:{regex:"none",alertText:"* 日期需在 ",alertText2:" 之前"},future:{regex:"none",alertText:"* 日期需在 ",alertText2:" 之后"},maxCheckbox:{regex:"none",alertText:"* 最多选择 ",alertText2:" 个项目"},minCheckbox:{regex:"none",alertText:"* 最少选择 ",alertText2:" 个项目"},equals:{regex:"none",alertText:"* 两次输入的密码不一致"},creditCard:{regex:"none",alertText:"* 无效的信用卡号码"},phone:{regex:/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/,alertText:"无效的电话号码"},email:{regex:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,alertText:"无效的邮件地址"},integer:{regex:/^[\-\+]?\d+$/,alertText:"只能填写整数"},number:{regex:/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/,alertText:"只能填写数字"},date:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/,alertText:"无效的日期，格式必需为 YYYY-MM-DD"},ipv4:{regex:/^((([01]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))[.]){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))$/,alertText:"无效的 IP 地址"},url:{regex:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,alertText:"无效的网址"},onlyNumberSp:{regex:/^[0-9\ ]+$/,alertText:"只能填写数字"},onlyLetterSp:{regex:/^[a-zA-Z\ \']+$/,alertText:"只能填写英文字母"},onlyLetterNumber:{regex:/^[0-9a-zA-Z]+$/,alertText:"只能填写数字与英文字母"},dateFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/,alertText:"无效的日期格式"},dateTimeFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/,alertText:"* 无效的日期或时间格式",alertText2:"可接受的格式： ",alertText3:"mm/dd/yyyy hh:mm:ss AM|PM 或 ",alertText4:"yyyy-mm-dd hh:mm:ss AM|PM"},chinese:{regex:/^[\u4E00-\u9FA5]+$/,alertText:"* 只能填写中文汉字"},chinaId:{regex:/^[1-9]\d{5}[1-9]\d{3}(((0[13578]|1[02])(0[1-9]|[12]\d|3[0-1]))|((0[469]|11)(0[1-9]|[12]\d|30))|(02(0[1-9]|[12]\d)))(\d{4}|\d{3}[xX])$/,alertText:"* 无效的身份证号码"},chinaIdLoose:{regex:/^(\d{18}|\d{15}|\d{17}[xX])$/,alertText:"* 无效的身份证号码"},chinaZip:{regex:/^\d{6}$/,alertText:"* 无效的邮政编码"},qq:{regex:/^[1-9]\d{4,10}$/,alertText:"* 无效的 QQ 号码"},maxLength:{func:function(e,t,a,i){for(var n=t[a+2],o=e.val(),l=0,r=0;r<o.length;r++)null!=o[r].match(/[^\x00-\xff]/gi)?l+=3:l++;return i.allrules.maxLength.alertText="* 内容过长，超过 "+(l-n)+" 个字符",n>=l}},before:{func:function(e,t,a,i){var n=$.trim(e.closest(".form-group").find(".control-label").text()),o="",l=t[a+2],r=e.closest("form"),s=r.find("*[name='"+l.replace(/^#+/,"")+"']");if(s.size()>0&&s.validationEngine("hide"),!e.val())return!0;var d=null;if("now"==l.toLowerCase()?(d=new Date,o="当前时间"):s.size()>0?(s.val()&&(d=$.parseDate(s.val())),o=$.trim(s.closest(".form-group").find(".control-label").text())):(d=$.parseDate(l),o=l),!d)return!0;var c=$.parseDate(e.val());return c>d?(i.allrules.before.alertText=n+"不能晚于"+o,!1):!0}},after:{func:function(e,t,a,i){var n=$.trim(e.closest(".form-group").find(".control-label").text()),o="",l=t[a+2],r=e.closest("form"),s=r.find("*[name='"+l.replace(/^#+/,"")+"']");if(s.size()>0&&s.validationEngine("hide"),!e.val())return!0;var d=null;if("now"==l.toLowerCase()?(d=new Date,o="当前时间"):s.size()>0?(s.val()&&(d=$.parseDate(s.val())),o=$.trim(s.closest(".form-group").find(".control-label").text())):(d=$.parseDate(l),o=l),!d)return!0;var c=$.parseDate(e.val());return d>c?(i.allrules.after.alertText=n+"不能早于"+o,!1):!0}}}}.call(this);