function getUploadedAttachment(){}$.fn.emapFormInputInit=function(e){WIS_EMAP_INPUT.init($(this),e)},function(e,t){function a(e,t){var a=$(e),i=a.attr("xtype"),n=$.extend({},{placeHolder:"请选择...",source:[{id:"",name:"请选择...",uid:""}],displayMember:"name",valueMember:"id",itemHeight:28,enableBrowserBoundsDetection:!0,filterable:!0,width:"100%",filterPlaceHolder:"请查找",searchMode:"containsignorecase",disabled:a.data("disabled")?!0:!1},t);if("multi-select2"===i&&(n.source=[],n.checkboxes=!0),a.data("optiondata")){var o=a.data("optiondata");if("string"==typeof o)try{o=JSON.parse(o)}catch(l){console&&console.error(a.data("name")+"optionData 格式错误, 必须是json格式")}return a.jqxDropDownList(n),void a.jqxDropDownList({source:o})}a.jqxDropDownList(n).on("open",function(e){var t=$(this);if(!t.data("loaded")){e.stopPropagation();var a=t.val().split(","),n=[],o=new $.jqx.dataAdapter({url:t.data("url"),datatype:"json",async:!1,root:"datas>code>rows",formatData:function(e){return t.data("jsonparam")&&(e=t.data("jsonparam")),e}},{beforeLoadComplete:function(e){"select"===i&&e.unshift({id:"",name:"请选择...",uid:""});for(var t=0;t<e.length;t++)$.inArray(e[t].id,a)>-1&&""!==e[t].id&&n.push(t)},loadComplete:function(e){t.data("loaded",!0);var a="select"==i?"selectIndex":"checkIndex";n.length>0?$(n).each(function(){t.jqxDropDownList(a,this)}):t.jqxDropDownList(a,-1)}});t.jqxDropDownList({source:o})}}),d(a,"change")}function i(e,t){var a=e,i=a.attr("xtype"),n=$.extend({},{width:"100%",disabled:a.data("disabled"),value:null,formatString:"yyyy-MM",culture:"zh-CN",showFooter:!0,clearString:"清除",enableBrowserBoundsDetection:!0,todayString:"今天"},t);"date-local"==i?n.formatString="yyyy-MM-dd":"date-full"==i&&(n.formatString=a.data("format")?a.data("format"):"yyyy-MM-dd HH:mm",n.showTimeButton=!0),n.formatString=a.data("format")||n.formatString,a.jqxDateTimeInput(n),"date-full"!=i&&(a.on("click",function(e){e.stopPropagation();var t=$(this).jqxDateTimeInput("disabled");t||$(this).jqxDateTimeInput("open")}),a.on("input",function(){isNaN(parseInt(a.val()))&&a.val("")})),d(a,"change")}function n(e,t){var a=e.attr("xtype"),i=$.extend({},{url:e.data("url"),checkboxes:!1,search:!0},t);if("multi-tree"===a&&(i.checkboxes=!0),e.emapDropdownTree(i),e.data("disabled")){e.emapDropdownTree("disable");var n=e.closest(".bh-form-group");n.length>0&&n.addClass("disabled")}var o="change";"multi-tree"==a&&(o="checkChange"),d(e,o)}function o(e,t,a){var i=e,n=i.attr("xtype"),o=$.extend({},{contextPath:a.root},t);i.data("defaultoptions",o),"uploadfile"==n?i.emapFileUpload(o):"uploadphoto"==n?i.emapFilePhoto(o):"uploadsingleimage"==n?i.emapSingleImageUpload(o):"uploadmuiltimage"==n&&i.emapImageUpload(o),1==i.data("disabled")&&$("input[type=file]",i).attr("disabled",!0)}function l(e,t){var a=e.attr("xtype"),i=$.extend({},{url:e.data("url"),allOption:e.data("alloption")},t);"multi-buttonlist"==a&&(i.multiple=!0,i.allOption=!1),e.bhButtonGroup(i),d(e,"change")}function r(e,a){"object"==typeof a?(e.jqxDropDownList("addItem",a[0]),e.jqxDropDownList("checkAll")):""===a||a===t?e.jqxDropDownList("clearSelection"):e.val(a)}function s(e,a,i,n){e.val(null!==i[a]&&i[a]!==t?i[a]:"")}function d(e,t){e.on(t,function(){e.trigger("_formChange")})}e.init=function(t,a){function i(t,a){var i=$(t),n=i.data("jsonparam");if("string"==typeof n)try{n=JSON.parse(n)}catch(o){console&&console.warn("无效的json param格式!"),n={}}var l=a.defaultOptions?a.defaultOptions[i.attr("xtype")]||{}:{},r=$.extend({},l,n),s=i.attr("xtype")||"text";e.core[s].init(i,r,a)}var n=$.extend({},{root:""},a);if($(t).attr("xtype")){if($(t).hasClass("bh-form-static"))return;i(t,n)}else a._inputInitCount=0,a._inputInitCounter=0,$(t).find("[xtype]:not(.bh-form-static)").each(function(){"TEXTAREA"==this.nodeName&&this.hasAttribute("readOnly")||($.inArray($(this).attr("xtype"),["checkboxlist","radiolist","buttonlist","multi-buttonlist","uploadfile","uploadsingleimage","uploadmuiltimage"])>-1&&a._inputInitCount++,i(this,n))}),$(t).on("bhInputInitComplete",function(){a._inputInitCounter++,a._inputInitCounter==a._inputInitCount&&$(this).trigger("_init")})},e.setValue=function(t,a,i,n,o){var l=$(t);a||(a=l.data("name")),"undefined"==i&&(i="text"),i=i||"text",e.core[i].setValue(t,a,n,o)},e.formSetValue=function(a,i,n){var o=$(a);n&&n.readonly?(n.formValue=i,o.find("[xtype]").each(function(){function a(e,t){null!=e&&l.text(e).attr("title",e).data("value",t)}var o=$(this).data("name"),l=$(this),r=null;if(i[o]!==t&&null!==i[o])switch($(this).attr("xtype")){case"multi-select":case"select":case"multi-select2":i[o+"_DISPLAY"]?a(i[o+"_DISPLAY"],i[o]):e.getInputOptions(l.data("url"),function(e){l.data("model",e);var t=i[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),a(n.join(","),i[o])});break;case"radiolist":i[o+"_DISPLAY"]?a(i[o+"_DISPLAY"],i[o]):e.getInputOptions(l.data("url"),function(e){l.data("model",e),$(e).each(function(){return this.id==i[o]?(r=this.name,!1):void 0})});break;case"checkboxlist":i[o+"_DISPLAY"]?a(i[o+"_DISPLAY"],i[o]):e.getInputOptions(l.data("url"),function(e){l.data("model",e);var t=i[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),a(n.join(","),i[o])});break;case"tree":i[o+"_DISPLAY"]?a(i[o+"_DISPLAY"],i[o]):e.getInputOptions(l.data("url"),function(e){l.data("model",e);var t=i[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),a(n.join(","),i[o])});break;case"uploadfile":$(this).emapFileDownload($.extend({},{contextPath:n.root,token:i[o]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadsingleimage":case"uploadmuiltimage":$(this).emapFileDownload($.extend({},{model:"image",contextPath:n.root,token:i[o]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadphoto":$(this).emapFilePhoto("destroy"),$(this).emapFilePhoto($.extend({},{token:i[o],contextPath:n.root},JSON.parse(decodeURI($(this).data("jsonparam"))))),$("a",this).hide();break;case"switcher":i[o+"DISPLAY"]=parseInt(i[o])?"是":"否",a(i[o+"DISPLAY"],i[o]);break;default:a(i[o])}})):o.find("[xtype]").each(function(){var a=$(this).data("name"),o=$(this),l=o.attr("xtype");n&&"t"==n.model&&o.hasClass("bh-form-static")&&null!=i[a]&&(i[a+"_DISPLAY"]!==t&&null!==i[a+"_DISPLAY"]?o.text(i[a+"_DISPLAY"]).attr("title",i[a+"_DISPLAY"]).data("value",i[a]):o.text(i[a]).attr("title",i[a]).data("value",i[a])),i===t||i[a]!==t&&null!==i[a]&&e.setValue(o,a,l,i,n.root||"")})},e.getInputOptions=function(e,t){var a=new $.jqx.dataAdapter({url:e,datatype:"json",root:"datas>code>rows"},{loadComplete:function(e){t(e.datas.code.rows)}});a.dataBind()},e.formClear=function(a,i,n){var o=$(a);if(n=n||{},n&&n.readonly)if(i==t)o.find("[xtype]").each(function(){$(this).html("")}),n.formValue={};else for(var l=0;l<i.length;l++)o.find("[data-name="+i[l]+"][xtype]").html(""),n.formValue[i[l]]="";else if(i===t)o.find("[xtype]").each(function(){var t=$(this).data("name"),a=$(this).attr("xtype"),i=$(this);e.setValue(i,t,a,"",n.root)});else for(var l=0;l<i.length;l++){var r=i[l],s=o.find("[data-name="+r+"][xtype]"),d=s.attr("xtype"),i={};i[r]="",e.setValue(s,r,d,i,n.root)}},e.formGetValue=function(e,a){var i=$(e);if(a&&a.readonly)return a.formValue;var n={};return i.find("[xtype]").each(function(){var e="";if($(this).hasClass("bh-form-static"))$.inArray($(this).attr("xtype"),["radiolist","checkboxlist","tree","multi-select","select"])>-1?(n[$(this).data("name")+"_DISPLAY"]=$(this).text(),e=$(this).data("value")):e=$(this).data("value");else switch($(this).attr("xtype")){case"radiolist":e=$(this).find("input[type=radio]:checked").map(function(){return $(this).val()}).get().join(",");var a=$(this).find("input[type=radio]:checked").map(function(){return $(this).data("caption")}).get().join(",");n[$(this).data("name")+"_DISPLAY"]=a;break;case"checkboxlist":e=$(this).find("input[type=checkbox]:checked").map(function(){return $(this).val()}).get().join(",");var a=$(this).find("input[type=checkbox]:checked").map(function(){return $(this).data("caption")}).get().join(",");n[$(this).data("name")+"_DISPLAY"]=a;break;case"tree":e=$(this).emapDropdownTree("getValue"),n[$(this).data("name")+"_DISPLAY"]=$(this).emapDropdownTree("getText");break;case"uploadfile":e=$(this).emapFileUpload("getFileToken");break;case"uploadsingleimage":e=$(this).emapSingleImageUpload("getFileToken");break;case"uploadmuiltimage":e=$(this).emapImageUpload("getFileToken");break;case"uploadphoto":e=$(this).emapFilePhoto("getFileToken");break;case"switcher":e=$(this).val()?1:0,n[$(this).data("name")+"_DISPLAY"]=e?"是":"否";break;case"multi-select":var i=[],o=[];$($(this).jqxComboBox("getSelectedItems")).each(function(){i.push(this.value),o.push(this.label)}),e=i.join(","),n[$(this).data("name")+"_DISPLAY"]=o.join(",");break;case"select":var l=$(this).jqxDropDownList("getSelectedItem");l&&(n[$(this).data("name")+"_DISPLAY"]=l.label),e=$(this).val();break;case"multi-select2":var r=$(this).jqxDropDownList("getCheckedItems");r.length>0&&(n[$(this).data("name")+"_DISPLAY"]=r.map(function(e){return e.label}).join(",")),e=$(this).val();break;case"static":e=$(this).data("value"),$(this).data("valuedisplay")!==t&&(n[$(this).data("name")+"_DISPLAY"]=$(this).data("valuedisplay"));break;case"textarea":e=$(this).bhTxtInput("getValue");break;case"number-range":e=$(this).bhNumRange("getValue");break;case"date-range":var s=$(this).bhTimePicker("getValue");e=s.startTime+","+s.endTime;break;case"buttonlist":case"multi-buttonlist":e=$(this).bhButtonGroup("getValue");var d=$(".bh-label-radio.bh-active",$(this));d.length&&(n[$(this).data("name")+"_DISPLAY"]=d.map(function(e){return $(e).data("name")}).join(","));break;default:e=$(this).val()}n[$(this).data("name")]=e}),n},e.disable=function(e){var t=$(e);switch(t.attr("xtype")){case"select":case"multi-select2":t.jqxDropDownList({disabled:!0});break;case"date-local":case"date-ym":case"date-full":t.jqxDateTimeInput({disabled:!0});break;case"tree":t.emapDropdownTree("disable");break;case"radiolist":case"checkboxlist":$("input[type=radio], input[type=checkbox]",t).prop("disabled",!0);break;case"switcher":t.jqxSwitchButton("disable");break;case"multi-select":case"selecttable":t.jqxComboBox({disabled:!0});break;case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":$("input[type=file]",t).attr("disabled",!0);var a=$(".bh-file-img-single-edit",t);a.length>0&&a.hide();var i=$(".bh-file-img-info",t);i.length>0&&i.hide();break;case"textarea":t.bhTxtInput("disabled",!0);break;case"number-range":t.bhNumRange("disabled",!0);break;default:t.attr("disabled",!0)}var n=t.closest(".bh-form-group");n.length&&n.addClass("bh-disabled")},e.formDisable=function(t,a){a?a instanceof Array?a.map(function(a){e.disable($("[data-name="+a+"]",$(t)))}):$("[data-name="+a+"]",$(t)).each(function(){e.disable(this)}):$("[xtype]",$(t)).each(function(){e.disable(this)})},e.enable=function(e){var t=$(e);switch(t.attr("xtype")){case"textarea":t.bhTxtInput("disabled",!1);break;case"number-range":t.bhNumRange("disabled",!1);break;case"select":t.jqxDropDownList({disabled:!1});break;case"date-local":case"date-ym":t.jqxDateTimeInput({disabled:!1});break;case"tree":t.emapDropdownTree("enable");break;case"radiolist":case"checkboxlist":$("input[type=radio], input[type=checkbox]",t).prop("disabled",!1);break;case"switcher":t.jqxSwitchButton("enable");break;case"multi-select":case"selecttable":t.jqxComboBox({disabled:!1});break;case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":$("input[type=file]",t).attr("disabled",!1);var a=$(".bh-file-img-single-edit",t);a.length>0&&$(".bh-file-img-single-edit",t).show();var i=$(".bh-file-img-info",t);i.length>0&&i.show();break;default:t.attr("disabled",!1)}var n=t.closest(".bh-form-group");n.length&&n.removeClass("bh-disabled")},e.formEnable=function(t,a){a?a instanceof Array?a.map(function(a){e.enable($("[data-name="+a+"]",$(t)))}):$("[data-name="+a+"]",$(t)).each(function(){e.enable(this)}):$("[xtype]",$(t)).each(function(){e.enable(this)})},e.renderPlaceHolder=function(e){var a=WIS_EMAP_SERV.getAttr(e);a.inputReadonly&&(a.xtype="static");var i="";switch(a.xtype){case t:case"text":a.xtype="text",i='<input class="bh-form-control" data-caption="{{caption}}" data-type="{{dataType}}" data-name="{{name}}" name="{{name}}" xtype="{{xtype}}" type="{{xtype}}" {{checkType}} {{JSONParam}}  {{dataSize}} {{checkSize}} {{checkExp}} '+(a.inputReadonly?"readOnly":"")+"  />";break;case"textarea":i='<div xtype="{{xtype}}" data-caption="{{caption}}" data-type="{{dataType}}" data-name="{{name}}" {{checkType}} {{dataSize}} {{checkSize}} {{checkExp}} {{JSONParam}} '+(a.inputReadonly?"readOnly":"")+" ></div>";break;case"selecttable":case"select":case"multi-select2":case"tree":case"multi-tree":case"date-local":case"date-ym":case"date-full":case"date-range":case"switcher":case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":case"buttonlist":case"multi-buttonlist":case"multi-select":case"div":case"static":case"number":case"number-range":i='<div xtype="{{xtype}}" data-caption="{{caption}}" data-type="{{dataType}}" data-name="{{name}}" {{url}} {{format}} {{checkType}} {{JSONParam}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"radiolist":i='<div xtype="{{xtype}}" data-caption="{{caption}}" data-type="{{dataType}}" class="bh-radio jqx-radio-group" data-name="{{name}}" {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"checkboxlist":i='<div xtype="{{xtype}}" data-caption="{{caption}}" data-type="{{dataType}}" class="bh-checkbox" data-name="{{name}}" {{checkType}} {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>'}return i=i.replace(/\{\{xtype\}\}/g,a.xtype).replace(/\{\{name\}\}/g,a.name).replace(/\{\{dataType\}\}/g,a.dataType).replace(/\{\{inputReadonly\}\}/g,a.inputReadonly).replace(/\{\{caption\}\}/g,a.caption),i=i.replace(/\{\{url\}\}/g,function(){return a.url?'data-url="'+a.url+'"':""}),i=i.replace(/\{\{format\}\}/g,a.format?'data-format="'+a.format+'"':""),i=i.replace(/\{\{checkType\}\}/g,a.checkType?'data-checktype="'+encodeURI(a.checkType)+'"':""),i=i.replace(/\{\{dataSize\}\}/g,a.dataSize?'data-size="'+a.dataSize+'"':""),i=i.replace(/\{\{checkSize\}\}/g,a.checkSize?'data-checksize="'+a.checkSize+'"':""),i=i.replace(/\{\{checkExp\}\}/g,a.checkExp?"data-checkexp="+encodeURI(a.checkExp):""),i=$(i),a.optionData&&i.data("optiondata",a.optionData),("buttonlist"==a.xtype||"multi-buttonlist"==a.xtype)&&i.addClass("bh-label-radio-group"),i.data("jsonparam",a.JSONParam),i},e.placeHolder=function(e){if(9==document.documentMode){if(!e)return;"INPUT"==$(e)[0].nodeName?JPlaceHolder.fix($(e).parent()):JPlaceHolder.fix(e)}},e.core={select:{init:a,setValue:function(a,i,n,o){return n[i]===t||null===n[i]?void a.jqxDropDownList("clearSelection"):void(a.jqxDropDownList("getItemByValue",n[i])?r(a,n[i]):n[i+"_DISPLAY"]?(a.jqxDropDownList("addItem",{id:n[i],name:n[i+"_DISPLAY"]}),r(a,n[i])):e.getInputOptions(a.data("url"),function(e){$(e).each(function(){a.jqxDropDownList("addItem",this)}),r(a,n[i])}))}},"multi-select2":{init:a,setValue:function(a,i,n,o){if(n[i]===t||null===n[i])return void a.jqxDropDownList("uncheckAll");var l=n[i].split(",");if(n[i+"_DISPLAY"]===t||null===n[i+"_DISPLAY"])return void e.getInputOptions(a.data("url"),function(e){a.data("loaded")||($(e).each(function(){a.jqxDropDownList("addItem",this)}),a.data("loaded",!0)),l.map(function(e){a.jqxDropDownList("checkItem",e)})});var r=n[i+"_DISPLAY"].split(",");$(l).each(function(e){a.jqxDropDownList("getItemByValue",l[e])?a.jqxDropDownList("checkItem",l[e]):(a.jqxDropDownList("addItem",{id:l[e],name:r[e]}),a.jqxDropDownList("checkItem",l[e]))})}},"multi-select":{init:function(e,t){var a=e,i=new $.jqx.dataAdapter({url:a.data("url"),datatype:"json",root:"datas>code>rows",beforeLoadComplete:function(e){return a.data("initdata")||a.data("initdata",e),e},formatData:function(e){return e.pageSize=10,e.pageNumber=1,e.queryopt=JSON.stringify({name:"name",value:a.jqxComboBox("searchString"),builder:"include",linkOpt:"AND"}),e}}),n=$.extend({},{placeHolder:"请选择...",source:i,displayMember:"name",multiSelect:!0,remoteAutoComplete:!0,enableBrowserBoundsDetection:!0,valueMember:"id",minLength:1,width:"100%",height:"26px",disabled:a.data("disabled")?!0:!1,search:function(e){i.dataBind()}},t);a.jqxComboBox(n).on("keyup open","input.jqx-combobox-input",function(){var e=$(this).val(),t=a.jqxComboBox("getItems");if(""==e&&(!t||0==t.length)){var i=a.data("initdata");$(i).each(function(){a.jqxComboBox("addItem",this)})}}),d(a,"select"),i.dataBind()},setValue:function(a,i,n,o){if(n[i]===t||null===n[i])return void a.jqxComboBox("clearSelection");if(n[i+"_DISPLAY"]!==t&&null!==n[i+"_DISPLAY"]){var l=a.jqxComboBox("getItems").map(function(e){return e.value}),r=n[i+"_DISPLAY"].split(",");n[i].split(",").map(function(e,t){$.inArray(e,l)<0&&a.jqxComboBox("addItem",{id:e,name:r[t]}),a.jqxComboBox("selectItem",e)})}else n[i]===t||null===n[i]?a.jqxComboBox("clearSelection"):e.getInputOptions(a.data("url"),function(e){a.data("model",e);var t=n[i].split(","),o=a.jqxComboBox("getItems").map(function(e){return e.value});$(e).each(function(){$.inArray(this.id,t)>-1&&($.inArray(this.id,o)<0&&a.jqxComboBox("addItem",this),a.jqxComboBox("selectItem",this.id))})})}},selecttable:{init:function(e,t){var a=$.extend({},{url:e.data("url"),width:"100%"},t);e.emapDropdownTable(a),d(e,"select")},setValue:function(e,t,a,i){e.emapDropdownTable("setValue",[a[t],a[t+"_DISPLAY"]])}},"date-ym":{init:i,setValue:s},"date-local":{init:i,setValue:s},"date-full":{init:i,setValue:s},"date-range":{init:function(e,t){var a=$.extend({},{format:e.data("format")},t);e.bhTimePicker(a)},setValue:function(e,a,i,n){if(""===i||i===t||""===i[a])e.bhTimePicker("setValue",{startTime:"",endTime:""});else{var o=i[a].split(",");2==o.length&&e.bhTimePicker("setValue",{startTime:o[0],endTime:o[1]})}}},radiolist:{init:function(e,t){function a(e,t){var a="";$(e).each(function(){a+='<label><input type="radio" name="'+t.data("name")+'" value="'+this.id+'" data-caption="'+this.name+'" /><i class="bh-choice-helper"></i>'+this.name+"</label>"}),t.html(a).data("init",!0).trigger("bhInputInitComplete")}if(!e.data("init")){if(e.data("optiondata")){var i=e.data("optiondata");if("string"==typeof i)try{i=JSON.parse(i)}catch(n){console&&console.error(_this.data("name")+"optionData 格式错误, 必须是json格式")}return void a(i,e)}var o=new $.jqx.dataAdapter({url:e.data("url"),datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(t){"_"+parseInt(1e5*Math.random());a(t.datas.code.rows,e)}});o.dataBind(),d(e,"change")}},setValue:function(e,a,i,n){i[a]!==t&&null!==i[a]&&""!==i[a]?$("input[type=radio][value="+i[a]+"]",e).prop("checked",!0):$("input[type=radio]",e).prop("checked",!1)}},checkboxlist:{init:function(e,t){function a(e,t){var a="";$(e).each(function(){a+='<label><input type="checkbox" name="'+t.data("name")+'" value="'+this.id+'" data-caption="'+this.name+'" /><i class="bh-choice-helper"></i>'+this.name+"</label>"}),t.html(a).data("init",!0).trigger("bhInputInitComplete")}if(!e.data("init")){if(e.data("optiondata")){var i=e.data("optiondata");if("string"==typeof i)try{i=JSON.parse(i)}catch(n){console&&console.error(_this.data("name")+"optionData 格式错误, 必须是json格式")}return void a(i,e)}var o=new $.jqx.dataAdapter({url:e.data("url"),datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(t){"_"+parseInt(1e3*Math.random());a(t.datas.code.rows,e)}});o.dataBind(),d(e,"change")}},setValue:function(e,a,i,n){i[a]!==t&&null!==i[a]&&""!==i[a]?$(i[a].toString().split(",")).each(function(){$('input[type=checkbox][value="'+this+'"]',e).prop("checked",!0)}):$("input[type=checkbox]",e).prop("checked",!1),e.emapRepeater("setValue",i[a])}},tree:{init:n,setValue:function(a,i,n,o){return n[i]===t||null===n[i]?void a.emapDropdownTree("setValue",["","请选择..."]):void(n[i+"_DISPLAY"]?a.emapDropdownTree("setValue",[n[i],n[i+"_DISPLAY"]]):e.getInputOptions(a.data("url"),function(e){a.data("model",e),$(e).each(function(){return this.id==n[i]?(a.emapDropdownTree("setValue",[this.id,this.name]),!1):void 0})}))}},"multi-tree":{init:n,setValue:function(){}},switcher:{init:function(e,t){var a=$.extend({},{checked:!1,onLabel:"是",offLabel:"否"},t);e.jqxSwitchButton(a),d(e,"change")},setValue:function(e,t,a,i){e.jqxSwitchButton({checked:1*a[t]})}},uploadfile:{init:o,setValue:function(e,t,a,i){e.emapFileUpload("destroy"),e.emapFileUpload($.extend({},e.data("defaultoptions"),{contextPath:i,token:a[t]}))}},uploadphoto:{init:o,setValue:function(e,t,a,i){e.emapFilePhoto("destroy"),e.emapFilePhoto($.extend({},e.data("defaultoptions"),{contextPath:i,token:a[t]}))}},uploadsingleimage:{init:o,setValue:function(e,t,a,i){e.emapSingleImageUpload("destroy"),e.emapSingleImageUpload($.extend({},e.data("defaultoptions"),{contextPath:i,token:a[t]}))}},uploadmuiltimage:{init:o,setValue:function(e,t,a,i){e.emapImageUpload("destroy"),e.emapImageUpload($.extend({},e.data("defaultoptions"),{contextPath:i,token:a[t]}))}},buttonlist:{init:l,setValue:function(e,a,i,n){if($(".bh-label-radio.bh-active",e).removeClass("bh-active"),i[a]===t||null===i[a]||""===i[a]){var o=$(".bh-label-radio[data-id=ALL]",e);o.length>0&&o.addClass("bh-active")}else{var l=$(".bh-label-radio[data-id="+i[a]+"]",e);l.length>0&&l.addClass("bh-active")}}},"multi-buttonlist":{init:l,setValue:function(){}},div:{init:function(e,t,a){},setValue:function(){}},textarea:{init:function(e,t,a){var i=$.extend({},{checkSize:e.data("checksize"),dataSize:e.data("size"),name:e.data("name"),textareaEasyCheck:a.textareaEasyCheck},t);!a||a.textareaEasyCheck?i.limit=e.data("checksize")?e.data("checksize"):parseInt(e.data("size")/3):i.limit=e.data("checksize")?e.data("checksize"):e.data("size"),e.bhTxtInput(i),d(e,"change")},setValue:function(e,a,i,n){e.bhTxtInput("setValue",null!==i[a]&&i[a]!==t?i[a]:"")}},"static":{init:function(){},setValue:function(e,a,i,n){i[a+"_DISPLAY"]!==t?(e.text(i[a+"_DISPLAY"]),e.data("valuedisplay",i[a+"_DISPLAY"])):e.text(i[a]),e.data("value",i[a])}},number:{init:function(e,t){var a=$.extend({},{inputMode:"simple",spinButtons:!0,decimal:null,decimalDigits:0,promptChar:""},t);e.jqxNumberInput(a),d(e,"change")},setValue:s},"number-range":{init:function(e,t){e.bhNumRange(t)},setValue:function(e,a,i,n){if(i[a]===t||null===i[a]||""===i[a])e.bhNumRange("setValue",{input1:"",input2:""});else{var o=i[a].toString().split(",");1==o.length&&(o[1]=o[0]),e.bhNumRange("setValue",{input1:o[0],input2:o[1]})}}},text:{init:function(e,t){e.jqxInput({width:"100%"}),d(e,"change")},setValue:s}}}(window.WIS_EMAP_INPUT=window.WIS_EMAP_INPUT||{}),function(e,t){e.validateRules={dateRange:{regex:"none",alertText:"* 无效的 ",alertText2:" 日期范围"},dateTimeRange:{regex:"none",alertText:"* 无效的 ",alertText2:" 时间范围"},minSize:{regex:"none",alertText:"最少 ",alertText2:" 个字符"},maxSize:{regex:"none",alertText:"最多 ",alertText2:" 个字符"},groupRequired:{regex:"none",alertText:"* 至少填写其中一项"},min:{regex:"none",alertText:"* 最小值为 "},max:{regex:"none",alertText:"* 最大值为 "},past:{regex:"none",alertText:"* 日期需在 ",alertText2:" 之前"},future:{regex:"none",alertText:"* 日期需在 ",alertText2:" 之后"},maxCheckbox:{regex:"none",alertText:"* 最多选择 ",alertText2:" 个项目"},minCheckbox:{regex:"none",alertText:"* 最少选择 ",alertText2:" 个项目"},equals:{regex:"none",alertText:"* 两次输入的密码不一致"},creditCard:{regex:"none",alertText:"无效的信用卡号码"},tele:{regex:/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/,alertText:"无效的电话号码"},tel:{regex:/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/,alertText:"无效的电话号码"},phone:{regex:/^(0|86|17951)?(13[0-9]|15[012356789]|17[0678]|18[0-9]|14[57])[0-9]{8}$/,alertText:"无效的手机号码"},email:{regex:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,alertText:"无效的邮件地址"},mail:{regex:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,alertText:"无效的邮件地址"},integer:{regex:/^[\-\+]?\d+$/,alertText:"只能填写整数"},"integer+0":{regex:/^[\+]?\d+$/,alertText:"只能填写非负整数"},"integer+":{regex:/^[\+]?[1-9]+$/,alertText:"只能填大于零的整数"},money:{regex:/^\d+(\.\d{1,2})?$/,alertText:"无效的金额"},score:{regex:/^\d+(\.\d{1,2})?$/,alertText:"无效的分数"},number:{regex:/^[\-\+]?((([0-9]{1,3})([,][0-9]{3})*)|([0-9]+))?([\.]([0-9]+))?$/,alertText:"只能填写数字"},date:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/,alertText:"无效的日期，格式必需为 YYYY-MM-DD"},ipv4:{regex:/^((([01]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))[.]){3}(([0-1]?[0-9]{1,2})|(2[0-4][0-9])|(25[0-5]))$/,alertText:"无效的 IP 地址"},url:{regex:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,alertText:"无效的网址"},onlyNumberSp:{regex:/^[0-9\ ]+$/,alertText:"只能填写数字"},onlyLetterSp:{regex:/^[a-zA-Z\ \']+$/,alertText:"只能填写英文字母"},onlyLetterNumber:{regex:/^[0-9a-zA-Z]+$/,alertText:"只能填写数字与英文字母"},dateFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/,alertText:"无效的日期格式"},dateTimeFormat:{regex:/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/,alertText:"无效的日期或时间格式",alertText2:"可接受的格式： ",alertText3:"mm/dd/yyyy hh:mm:ss AM|PM 或 ",alertText4:"yyyy-mm-dd hh:mm:ss AM|PM"},chinese:{regex:/^[\u4E00-\u9FA5]+$/,alertText:"只能填写中文汉字"},chinaId:{regex:/^[1-9]\d{5}[1-9]\d{3}(((0[13578]|1[02])(0[1-9]|[12]\d|3[0-1]))|((0[469]|11)(0[1-9]|[12]\d|30))|(02(0[1-9]|[12]\d)))(\d{4}|\d{3}[xX])$/,alertText:"无效的身份证号码"},chinaIdLoose:{regex:/^(\d{18}|\d{15}|\d{17}[xX])$/,alertText:"无效的身份证号码"},chinaZip:{regex:/^\d{6}$/,alertText:"无效的邮政编码"},qq:{regex:/^[1-9]\d{4,10}$/,alertText:"无效的 QQ 号码"},maxLength:{func:function(e,t,a,i){for(var n=t[a+2],o=e.val(),l=0,r=0;r<o.length;r++)null!=o[r].match(/[^\x00-\xff]/gi)?l+=3:l++;return i.allrules.maxLength.alertText="内容过长，超过 "+(l-n)+" 个字符",n>=l}},before:{func:function(e,t,a){var i,n=WIS_EMAP_SERV.toDateStp(e);if("now"==t)i=parseInt((new Date).getTime()/1e3);else{!a&&(a=$(document));var o=$("[data-name="+t+"]",a).val();if(!o)return!0;i=WIS_EMAP_SERV.toDateStp(o)}return i>n},alertText:"*1不能晚于*2"},"before=":{func:function(e,t,a){var i,n=WIS_EMAP_SERV.toDateStp(e);if("now"==t)i=parseInt((new Date).getTime()/1e3);else{!a&&(a=$(document));var o=$("[data-name="+t+"]",a).val();if(!o)return!0;i=WIS_EMAP_SERV.toDateStp(o)}return i>=n},alertText:"*1不能晚于*2"},after:{func:function(e,t,a){var i,n=WIS_EMAP_SERV.toDateStp(e);if("now"==t)i=parseInt((new Date).getTime()/1e3);else{!a&&(a=$(document));var o=$("[data-name="+t+"]",a).val();if(!o)return!0;i=WIS_EMAP_SERV.toDateStp(o)}return n>i},alertText:"*1不能早于*2"},"after=":{func:function(e,t,a){var i,n=WIS_EMAP_SERV.toDateStp(e);if("now"==t)i=parseInt((new Date).getTime()/1e3);else{!a&&(a=$(document));var o=$("[data-name="+t+"]",a).val();if(!o)return!0;i=WIS_EMAP_SERV.toDateStp(o)}return n>=i},alertText:"*1不能早于*2"}}}(window.WIS_EMAP_INPUT=window.WIS_EMAP_INPUT||{}),function(){var e,t,a,i,n,o,l,r,s,d,c,p,h,u,m,f,b,g,v,y,x,A,w,k;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapAdvancedQuery.defaults,a),this.$element=$(e),this.$element.attr("emap-role","advancedQuery").attr("emap-pagePath","").attr("emap-action",this.options.data.name),this.options._initCount=0,this.options._initCounter=0,t(this.$element,this.options)}return e.prototype.getValue=function(){return b(this.options)},e.prototype.setValue=function(e){var t=this.$element;this.$element.emapAdvancedQuery("clear");var a="string"==typeof e?JSON.parse(e):e;if(a.length>0){var i={};$(a).each(function(){$.isArray(this)?$("[bh-advanced-query-role=advancedInput]",t).val(this[0].value):(i[this.name]=this.value,this.value_display&&(i[this.name+"_DISPLAY"]=this.value_display))}),m(this.options,i),WIS_EMAP_SERV.inputSetValue(t,i,this.options)}},e.prototype.clear=function(){var e=this.$element,t=this.options;$("[bh-advanced-query-role=advancedInput]",e).val(""),$("[bh-advanced-query-role=advanceSearchForm] [xtype]",e).each(function(){var e=$(this),a=e.data("name"),i=e.attr("xtype");WIS_EMAP_INPUT.setValue(e,a,i,"",t.contextPath)}),$(".bh-advancedQuery-quick-search-wrap input[type=text]",e).val(""),$('[bh-advanced-query-role="quickSearchForm"] [xtype]',e).each(function(){var e=$(this),a=e.data("name"),i=e.attr("xtype");WIS_EMAP_INPUT.setValue(e,a,i,"",t.contextPath)})},e.prototype.updateTotalNum=function(e){if(this.options.showTotalNum){var t=$(".bh-advancedQuery-totalNum-wrap",this.$element);"none"==t.css("display")&&t.show(),$(".bh-advancedQuery-totalNum span",t).text(e);
}},e}(),t=function(e,t){e.attr("emap",JSON.stringify({"emap-url":WIS_EMAP_SERV.url,"emap-name":WIS_EMAP_SERV.name,"emap-app-name":WIS_EMAP_SERV.appName,"emap-model-name":WIS_EMAP_SERV.modelName})),delete WIS_EMAP_SERV.url,delete WIS_EMAP_SERV.name,delete WIS_EMAP_SERV.appName,delete WIS_EMAP_SERV.modelName;var F=t.data.controls,I=[],S=[],C=BH_UTILS.NewGuid();a=function(){return 450},i=function(e,t){var a=e.$advanced,i=e.$advancedModal;a.on("click","[bh-advanced-query-role=addTime]",function(){n($(this))}),a.on("click","[bh-advanced-query-role=cancelAddTime]",function(){o($(this))}),a.on("click","[bh-advanced-query-role=advancedOpen]",function(){$(a).addClass("bh-active"),e.searchModel="advanced",9==document.documentMode&&$.fn.placeholder&&setTimeout(function(){WIS_EMAP_INPUT.placeHolder()},300),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter()}),a.on("click","[bh-advanced-query-role=advancedClose]",function(i){$(a).removeClass("bh-active"),e.searchModel="easy",t.emapAdvancedQuery("clear"),t.trigger("search",[b(e,$(this).data("name")),e,i]),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter()}),a.on("click","[bh-advanced-query-role=conditionDismiss]",function(){$(this).closest(".bh-advancedQuery-form-row").remove()}),a.on("click","[bh-advanced-query-role=addCondition]",function(){d(e);var t=$("[bh-advanced-query-role=addDialog][data-guid="+e.guid+"]");t.jqxWindow({position:[window.innerWidth/2-274,window.innerHeight/2+$(window).scrollTop()-200]}),t.jqxWindow("open")}),i.on("click","[bh-advanced-query-role=addDialogConfirm]",function(){m(e,f(e)),$("[bh-advanced-query-role=addDialog]").jqxWindow("close")}),i.on("click","[bh-advanced-query-role=addDialogCancel]",function(){$("[bh-advanced-query-role=addDialog]").jqxWindow("close")}),i.on("click","[bh-advanced-query-role=modalListRightBtn]",function(){c()}),i.on("click","[bh-advanced-query-role=modalListLeftBtn]",function(){p()}),a.on("keyup",".bh-advancedQuery-quick-search-wrap input[type=text]",function(i){var n=28*a.data("easyarray").length+1,o=$(this).outerWidth(),l=$(this).val(),r=$(this).offset(),s=$(".bh-advancedQuery-quick-select[data-guid="+e.guid+"]");return r.top+=28,13==i.keyCode?(s.css({height:0,"border-width":"0"}),void t.trigger("search",[b(e),e,i])):void(""==l?s.css({height:0,"border-width":"0"}):($(".bh-advancedQuery-easy-query",s).html(l),s.css({height:n+"px",width:o+"px","border-width":"1px",top:r.top,left:r.left})))}),$("[bh-advanced-query-role=advancedEasySelect][data-guid="+e.guid+"]").on("click","p",function(a){var i=$(this).closest("[bh-advanced-query-role=advancedEasySelect]");i.height()>0&&i.css({height:0,"border-width":"0"}),t.trigger("search",[b(e,$(this).data("name")),e,a])}),a.on("click","[bh-advanced-query-role=easySearchBtn]",function(a){t.trigger("search",[b(e),e,a])}),a.on("click","[bh-advanced-query-role=quickSearchForm] .bh-label-radio",function(a){setTimeout(function(){t.trigger("search",[b(e),e,a])},200)}),a.on("selectedTime",'.bh-advancedQuery-quick div[xtype="date-range"]',function(a){var i=b(e);t.trigger("search",[i,e,a])}),a.on("click","[bh-advanced-query-role=advancedSearchBtn]",function(a){b(e),t.trigger("search",[b(e),e,a])}),i.on("click",function(e){var t=e.target;0==$(t).closest(".bh-advancedQuery-quick-search-wrap").length&&$(".bh-advancedQuery-quick-select").css({height:0,"border-width":"0"})}),t.one("_init",function(){t.trigger("init",[e]),e.initComplete&&e.initComplete()}),$(document).on("click",function(e){var t=e.target;if(0==$(t).closest("[bh-advanced-query-role=advancedEasySelect]").length){var a=$(".bh-advancedQuery-quick-select");a.css({height:0,"border-width":"0"})}}),a.on("click","[bh-advanced-query-role=saveSchema]",function(){$(this).closest(".bh-schema-btn-wrap").addClass("active")}),a.on("click","[bh-advanced-query-role=saveSchemaCancel]",function(){x(e)}),a.on("click","[bh-advanced-query-role=saveSchemaConfirm]",function(){var i=$(".bh-schema-name-input",a).val(),n=b(e),o=$("[bh-schema-role=fixCheckbox]",a).prop("checked")?1:0,l=$(".bh-rules-program",a);t.emapSchema("saveSchema",[i,n,o]).done(function(){x(e);var a=e.schemaList.filter(function(e){return e.SCHEMA_NAME==i});if(a.length>0?e.schemaList.filter(function(e){e.SCHEMA_NAME==i&&(e.CONTENT=n,e.FIXED=o)}):(a={CONTENT:n,SCHEMA_NAME:i,FIXED:o},e.schemaList.push(a)),1==o){var r=$('<a  data-name="'+i+'" href="javascript:void(0)">'+i+"</a>");r.data("info",a),$(".bh-rules-program [bh-schema-role=more]",t).before(r)}else{var r=$(".bh-rules-program",t).find("a[data-name="+i+"]");r.length>0&&r.remove()}l.show()}).fail(function(e){console&&console.log(e)})}),a.on("click","[bh-schema-role=more]",function(){0==$("main > article aside").length&&$("main > article").append("<aside></aside>"),$.bhPropertyDialog.show({content:'<h3>高级搜索方案</h3><section><div id="schemaDialog" style="display: none;"><p class="bh-color-caption">置顶方案(将直接出现在搜索栏上)</p><ul class="bh-schema-list" bh-schema-role="fixedUl"></ul><p class="bh-color-caption">其他方案(<span>4</span>)</p><ul class="bh-schema-list" bh-schema-role="unFixedUl"></ul></div></section>',footer:"",ready:function(){var a=$("[bh-schema-role=fixedUl]"),i=$("[bh-schema-role=unFixedUl]");$(e.schemaList).each(function(){var e;e=$('<li data-name="'+this.SCHEMA_NAME+'"><a href="javascript:void(0)" class="bh-pull-right" bh-schema-role="delete">删除</a><a href="javascript:void(0)" class="bh-pull-right" bh-schema-role="unfixed">取消置顶</a><a href="javascript:void(0)" class="bh-pull-right" bh-schema-role="fixed">置顶</a>'+this.SCHEMA_NAME+"</li>").data("info",this),1==this.FIXED?a.append(e):i.append(e),k(i)}),0==e.schemaList.length?$("#schemaDialog").length>0&&$("#schemaDialog").hide():$("#schemaDialog").length>0&&$("#schemaDialog").show(),w(t,e)}})}),a.on("click",".bh-rules-program a:not([bh-schema-role=more])",function(a){var i=$(this).data("info");t.emapAdvancedQuery("setValue",i.CONTENT),t.trigger("search",[i.CONTENT,e,a])}),a.on("click","[bh-advanced-query-role=clearBtn]",function(a){$(t).emapAdvancedQuery("clear"),t.trigger("search",[b(e),e,a])}),9==document.documentMode&&$.fn.placeholder&&t.on("search",function(){})},k=function(e){var t=$("li",e).length;e.prev("p").find("span").html(t),0==t?e.hide().prev("p").hide():e.show().prev("p").show();var a=$(e).siblings("[bh-schema-role=fixedUl]");0==$("li",a).length?a.hide().prev("p").hide():a.show().prev("p").show()},n=function(e){var t=e.closest(".bh-advancedQuery-addBlock");t.addClass("bh-active");var a=t.children("div[bh-advanced-query-role=addTime]");t.children("div[bh-advanced-query-role=addTimeGroup]").show(),a.hide()},o=function(e){var t=e.closest(".bh-advancedQuery-addBlock");t.removeClass("bh-active");var i=t.children("div[bh-advanced-query-role=addTimeGroup]");i.removeClass("bh-entryLeft").addClass("bh-outLeft"),t.children("div[bh-advanced-query-role=addTime]").addClass("bh-entryRight").show(),setTimeout(function(){i.removeClass("bh-outLeft").addClass("bh-entryLeft").hide()},a())},l=function(e,t){var a="",i="";e.length&&e.length>0?(i+="请输入",$(e).each(function(){i+=this.caption+"/",a+='<p data-name="'+this.name+'">搜索 <span class="bh-advancedQuery-easy-caption">'+this.caption+'</span> : <span class="bh-advancedQuery-easy-query"></span></p>'}),$(".bh-advancedQuery-quick-select[data-guid="+t.guid+"]").html(a),i=i.substring(0,i.length-1),$(".bh-advancedQuery-quick-search-wrap input[type=text]",t.$advanced).attr("placeholder",i)):$(".bh-advancedQuery-inputGroup",t.$advanced).hide()},r=function(e){var t=$("<div></div>");return $(e).each(function(e){("select"==this.xtype||"radiolist"==this.xtype||"checkboxlist"==this.xtype||"multi-select2"==this.xtype)&&(this.xtype="buttonlist"),this["search.quickSearchXtype"]&&(this.xtype=this["search.quickSearchXtype"]),t.append(s(this))}),t},s=function(e,a){var i=e;i.get=function(e){return void 0!==i["search."+e]?i["search."+e]:i[e]};var n=i.get("xtype"),o=i.get("caption"),l=i.get("defaultBuilder"),r=i.get("url"),s=i.get("name"),d=i.get("hidden")?"hidden":"",c=(i.get("placeholder")?i.get("placeholder"):"",i.get("checkType"),i.get("checkSize"),i.get("dataSize"),i.get("checkExp"),i.get("format")?i.get("format"):"yyyy-MM-dd"),p=$(' <div class="bh-advancedQuery-form-row bh-advancedQuery-h-28"><div class="bh-advancedQuery-groupName">'+o+'：</div><div class="bh-advancedQuery-groupList bh-label-radio-group"></div></div>');a&&p.append('<a class="bh-bh-advancedQuery-group-dismiss" bh-advanced-query-role="conditionDismiss"> <i class="icon-close iconfont"></i></a>');var h="";switch(n){case"tree":case"multi-tree":h+='<div xtype="{{xtype}}" data-name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" data-url="{{url}}" {{hidden}} style="max-width: 300px;"></div>';break;case"date-local":case"date-range":h+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="{{format}}" {{hidden}} style="max-width: 300px;"></div>';break;case"date-ym":h+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM" {{hidden}}></div>';break;case"date-full":h+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM-dd HH:mm" {{hidden}}></div>';break;case"switcher":h+='<div xtype="{{xtype}}"  data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" {{hidden}}></div>';break;case"radiolist":h+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-radio" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"checkboxlist":h+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-checkbox" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"buttonlist":case"multi-buttonlist":h+='<div xtype="{{xtype}}" data-name="{{name}}" data-url="{{url}}" data-builder="{{builder}}" data-alloption={{allOption}} data-caption="{{caption}}" {{hidden}} ></div>';break;case"select":case"multi-select":case"multi-select2":h+='<div xtype="{{xtype}}" data-name="{{name}}" data-url="{{url}}" data-builder="{{builder}}" data-alloption={{allOption}} data-caption="{{caption}}" {{hidden}} style="max-width: 300px;"></div>';break;case"number":case"number-range":h+='<div xtype="{{xtype}}" data-name="{{name}}" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}} style="max-width: 300px;"></div>';break;default:h+='<input class="bh-form-control" data-name="{{name}}" name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" xtype="text" type="text" {{hidden}} />'}return h=h.replace(/\{\{xtype\}\}/g,n).replace(/\{\{name\}\}/g,s).replace(/\{\{builder\}\}/g,l).replace(/\{\{caption\}\}/g,o).replace(/\{\{url\}\}/g,r).replace(/\{\{hidden\}\}/g,d?'style="display:none;"':"").replace(/\{\{allOption\}\}/g,t.allowAllOption).replace(/\{\{format\}\}/g,c),$(".bh-advancedQuery-groupList",p).html(h),p},u=function(e){var t=$("[bh-advanced-query-role=advanceSearchForm]",e.$advanced),a=[];return $("[xtype][data-name]",t).each(function(){a.push($(this).data("name"))}),a},d=function(e){var t=e.$advanced.data("modalarray"),a=u(e);if(t.length&&t.length>0){var i=$("[bh-advanced-query-role=addList]",e.$advancedModal),n="";$(t).each(function(){n+=$.inArray(this.name,a)>-1?' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+this.name+'" data-caption="'+this.caption+'" checked><i class="bh-choice-helper"></i>'+this.caption+"</label></div></li>":' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+this.name+'" data-caption="'+this.caption+'"><i class="bh-choice-helper"></i>'+this.caption+"</label></div></li>"}),i.html(n),h()}},c=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i="",n=$("input[type=checkbox]:checked",e);n.length>0&&(n.each(function(){var e=$(this).attr("name"),t=$(this).data("caption");i+=' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+e+'" data-caption="'+t+'"><i class="bh-choice-helper"></i>'+t+"</label></div></li>",$(this).closest("li").remove()}),a.append(i),h())},p=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i="",n=$("input[type=checkbox]:checked",a);n.length>0&&(n.each(function(){var e=$(this).attr("name"),t=$(this).data("caption");i+=' <li><div class="bh-checkbox"><label><input type="checkbox" name="'+e+'" data-caption="'+t+'"><i class="bh-choice-helper"></i>'+t+"</label></div></li>",$(this).closest("li").remove()}),e.append(i),h())},h=function(){var e=$("[bh-advanced-query-role=addList]",t.$advancedModal),a=$("[bh-advanced-query-role=addedList]",t.$advancedModal),i=$("input[type=checkbox]",e).length,n=$("input[type=checkbox]",a).length;$(".bh-advancedQuery-dialog-list-head span",e).html(i),$(".bh-advancedQuery-dialog-list-head span",a).html(n)},f=function(e){var t=$("[bh-advanced-query-role=addList]",e.$advancedModal),a=$("input[type=checkbox]:checked",t),i={};return $(a).each(function(){var e=$(this).attr("name");i[e]=""}),i},m=function(e,t){var a=$("[bh-advanced-query-role=advanceSearchForm]",e.$advanced),i=$("[bh-advanced-query-role=dropDownBtnWrap]",a);$(e.$advanced.data("modalarray")).each(function(){var e=$("[data-name="+this.name+"]",a);if(void 0!==t[this.name]&&null!=t[this.name]){if(e.length>0)return!0;i.before(s(this,!0))}else e.length>0&&e.closest(".bh-advancedQuery-form-row").remove()}),a.emapFormInputInit({defaultOptions:{tree:{unblind:!0,search:!0},"multi-tree":{search:!0},switcher:{checked:!0},"multi-select2":{width:300}}});for(var n in t){if(void 0===t[n]||null===t[n])return!0;var o=$("[data-name="+n+"]",a),l=o.attr("xtype");"switcher"==l&&""===t[n]&&(t[n]="1"),"date-range"==l&&""===t[n]&&(t[n]="all"),""!==t[n]&&WIS_EMAP_INPUT.setValue(o,n,l,t,"")}WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter()},b=function(e,t){var a=[],i=e.$advanced.data("easyarray"),n=e.$advanced.data("modalarray"),o=[];if("easy"==e.searchModel){var l=$.trim($(".bh-advancedQuery-quick-search-wrap input",e.$advanced).val());if(""!=l)if(t){var r=g(t,i),s={caption:r.caption,name:r.name,value:l,builder:"include",linkOpt:"AND"};s.builder="upper_include"==r.defaultBuilder?"upper_include":"include",a.push(s)}else{for(var d=0;d<i.length;d++){var s={caption:i[d].caption,name:i[d].name,value:l,builder:"include",linkOpt:"OR"};s.builder="upper_include"==i[d].defaultBuilder?"upper_include":"include",o.push(s)}a.push(o)}a=a.concat(v($("[bh-advanced-query-role=quickSearchForm]",e.$advanced)))}else if("advanced"==e.searchModel){var c=$.trim($("[bh-advanced-query-role=advancedInput]",e.$advanced).val());if(""!=c){for(var d=0;d<n.length;d++)n[d].xtype&&"text"!=n[d].xtype||o.push({caption:n[d].caption,name:n[d].name,value:c,builder:"include",linkOpt:"OR"});a.push(o)}a=a.concat(v($("[bh-advanced-query-role=advanceSearchForm]",e.$advanced)))}return JSON.stringify(a)},v=function(e){for(var t=[],a=$("[xtype]",e),i=0;i<a.length;i++){var n={},o=$(a[i]).attr("xtype");switch(n.name=$(a[i]).data("name"),n.caption=$(a[i]).data("caption"),n.builder=$(a[i]).data("builder"),n.linkOpt="AND",o){case"radiolist":n.value=$("input[type=radio]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"checkboxlist":n.value=$("input[type=checkbox]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"tree":n.value=$(a[i]).emapDropdownTree("getValue");break;case"buttonlist":n.value=$(".bh-label-radio.bh-active",a[i]).data("id");break;case"multi-buttonlist":n.value=$(a[i]).bhButtonGroup("getValue");break;case"date-range":n.value=$(a[i]).bhTimePicker("getValue");break;case"switcher":n.value=$(a[i]).val()?1:0;break;case"number":var l=$(a[i]).jqxNumberInput("value");n.value=null===l?"":l;break;case"multi-select":var r=$(a[i]).jqxComboBox("getSelectedItems");r.length>0?n.value=r.map(function(e){return e.value}).join(","):n.value="";break;case"multi-select2":var r=$(a[i]).jqxDropDownList("getCheckedItems");r.length>0?n.value=r.map(function(e){return e.value}).join(","):n.value="";break;case"multi-tree":n.value=$(a[i]).emapDropdownTree("getValue");break;default:n.value=$.trim($(a[i]).val())}if("date-range"===o){var s=n.value;if(!s)continue;if(s.startTime&&(n.value=s.startTime,n.builder="moreEqual",t.push(n)),s.endTime){var d=$.extend({},n);d.value=s.endTime,d.builder="lessEqual",t.push(d)}}else if("number-range"==o){var c=$(a[i]).bhNumRange("getValue");if(void 0!==c&&null!==c){var p=c.split(",");if(""!==p[0]&&(n.value=p[0],n.builder="moreEqual",t.push(n)),""!==p[1]){var d=$.extend({},n);d.value=p[1],d.builder="lessEqual",t.push(d)}}}else{if("ALL"===n.value||""===n.value||void 0===n.value)continue;n.value.toString().indexOf(",")>-1&&("text"==o&&(n.builder="m_value_include"),("multi-select"==o||"multi-select2"==o||"multi-buttonlist"==o)&&(n.builder="m_value_equal")),t.push(n)}}return t},g=function(e,t){for(var a=0;a<t.length;a++)if(t[a].name==e)return t[a]},y=function(e,t){t=$.extend(t,{schemaType:"aq"}),$.fn.emapSchema&&$(e).emapSchema(t),A(e,t)},x=function(e){var t=$(".bh-schema-btn-wrap",e.$advanced);t.removeClass("active"),$(".bh-schema-name-input",t).val(""),$("[bh-schema-role=fixCheckbox]",t).prop("checked",!1)},A=function(e,t){t.schemaList=e.emapSchema("getSchemaList"),t.schemaList=t.schemaList?t.schemaList:[];var a=t.$advanced,i=$(".bh-rules-program",a);if(t.schemaList.length>0){var n=t.schemaList.filter(function(e){return 1==e.FIXED});0==n.length?i.html('<label>构造方案: </label><a bh-schema-role="more" href="javascript:void(0)">更多 ></a>'):($(n).each(function(){var e=$('<a  data-name="'+this.SCHEMA_NAME+'" href="javascript:void(0)">'+this.SCHEMA_NAME+"</a>");e.data("info",this),$("[bh-schema-role=more]",i).before(e)}),i.show())}else i.hide()},w=function(e,t){var a=$("#schemaDialog");a.on("click","[bh-schema-role=delete]",function(i){i.stopPropagation();var n=$(this).parent(),o=n.data("info").SCHEMA_NAME;e.emapSchema("deleteSchema",o)&&(n.remove(),$(".bh-rules-program",e).find("[data-name="+o+"]").remove(),$(t.schemaList).each(function(e){this.SCHEMA_NAME==o&&t.schemaList.splice(e,1)}),k($("[bh-schema-role=unFixedUl]",a)))}),a.on("click","li",function(a){var i=$(this).data("info");e.emapAdvancedQuery("setValue",i.CONTENT),e.trigger("search",[i.CONTENT,t,a]),$.bhPropertyDialog.hide()}),a.on("click","[bh-schema-role=fixed]",function(i){i.stopPropagation();var n=$(this).closest("li"),o=n.data("info"),l=o.SCHEMA_NAME,r=o.CONTENT;e.emapSchema("saveSchema",[l,r,1]).done(function(){x(t);var i={CONTENT:r,SCHEMA_NAME:l,FIXED:1};t.schemaList.filter(function(e){return e.SCHEMA_NAME==l})[0].FIXED=1,$("[bh-schema-role=fixedUl]",a).append(n);var o=$('<a  data-name="'+l+'" href="javascript:void(0)">'+l+"</a>");o.data("info",i),$(".bh-rules-program [bh-schema-role=more]",e).before(o),k($("[bh-schema-role=unFixedUl]",a))}).fail(function(e){console&&console.log(e)})}),a.on("click","[bh-schema-role=unfixed]",function(i){i.stopPropagation();var n=$(this).closest("li"),o=n.data("info"),l=o.SCHEMA_NAME,r=o.CONTENT;e.emapSchema("saveSchema",[l,r,0]).done(function(){x(t),t.schemaList.filter(function(e){return e.SCHEMA_NAME==l})[0].FIXED=0,$("[bh-schema-role=unFixedUl]",a).append(n),$(".bh-rules-program",e).find("[data-name="+l+"]").remove(),k($("[bh-schema-role=unFixedUl]",a))}).fail(function(e){console&&console.log(e)})})},e.css({position:"relative","z-index":358}).html('<div class="bh-advancedQuery bh-mb-16" bh-advanced-query-role="advancedQuery"><div class="bh-advancedQuery-dropDown "><div class="" style="display: table-cell"><div class="bh-rules-header bh-clearfix"><h4><i class="iconfont icon-search"></i>高级搜索</h4><p class="bh-rules-program"><label>构造方案: </label><a bh-schema-role="more" href="javascript:void(0)">更多 ></a></p></div><div class="bh-advancedQuery-form" bh-advanced-query-role="advanceSearchForm" ><div class="bh-advancedQuery-form-row bh-advancedQuery-h-28"><div class="bh-advancedQuery-groupName">关键词：</div><div class="bh-advancedQuery-groupList"><input type="text" bh-advanced-query-role="advancedInput" class="bh-form-control"></div></div><div class="bh-advancedQuery-form-row bh-advancedQuery-form-btn-row bh-advancedQuery-h-28" bh-advanced-query-role="dropDownBtnWrap"> <div class="bh-advancedQuery-groupName"></div><div class="bh-advancedQuery-groupList"><a class="bh-btn bh-btn-primary bh-btn-small" bh-advanced-query-role="advancedSearchBtn" >执行高级搜索</a><a class="bh-btn bh-btn-default bh-btn-small" bh-advanced-query-role="addCondition" >添加搜索字段</a><div class="bh-schema-btn-wrap"><div class="bh-schema-edit-div"><input type="text" placeholder="请输入方案名称" class="bh-form-control bh-schema-name-input" /><a  class="bh-btn bh-btn-success bh-btn-small"  bh-advanced-query-role="saveSchemaConfirm">保存</a><a class="bh-btn bh-btn-default bh-btn-small" bh-advanced-query-role="saveSchemaCancel">取消</a><span class="bh-checkbox" style="display:inline-block;vertical-align:middle;margin-left:8px;"><label><input type="checkbox" bh-schema-role="fixCheckbox"><i class="bh-choice-helper"></i> 固定至搜索栏</label></span></div><a class="bh-btn bh-btn-default bh-btn-small " bh-advanced-query-role="saveSchema" href="javascript:void(0)">保存为方案</a></div><a class="bh-mh-4" bh-advanced-query-role="advancedClose" href="javascript:void(0)">[关闭高级搜索]</a></div></div></div></div></div><div class="bh-advancedQuery-quick"><div class="bh-advancedQuery-inputGroup bh-clearfix" style="padding-bottom: 8px;background: #fff;"><div class="bh-advancedQuery-quick-search-wrap" ><input type="text" class="bh-form-control"/><i class="iconfont icon-search" style="position: absolute;left: 6px;top: 6px;"></i></div><a class="bh-btn bh-btn bh-btn-primary bh-btn-small" bh-advanced-query-role="easySearchBtn" >搜索</a><a href="javascript:void(0);" class="bh-mh-8" bh-advanced-query-role="advancedOpen">[高级搜索]</a></div><div class="bh-advancedQuery-form" bh-advanced-query-role="quickSearchForm"></div></div><div class="bh-advancedQuery-dialog" bh-advanced-query-role="addDialog" data-guid="'+C+'"><div class="bh-advancedQuery-dialog-head">添加搜索字段</div><div class="bh-advancedQuery-dialog-content"><ul class="bh-advancedQuery-dialog-list" bh-advanced-query-role="addList"></ul></div><a href="javascript:void(0)" bh-advanced-query-role="addDialogCancel" class="bh-btn bh-btn-default bh-pull-right" >取消</a><a href="javascript:void(0)" bh-advanced-query-role="addDialogConfirm" class="bh-btn bh-btn-primary bh-pull-right" >添加完成</a></div><div class="bh-clearfix bh-advancedQuery-totalNum-wrap"><p class="bh-advancedQuery-totalNum bh-pull-left">共<span></span>条数据 <a href="javascript:void(0)" bh-advanced-query-role="clearBtn">[清空搜索]</a></p><div class="bh-advancedQuery-totalNum-line"></div></div></div>'),t.$advanced=$("div[bh-advanced-query-role=advancedQuery]",e).css({overflow:"hidden"}),t.guid=C,$("body").append('<div class="bh-advancedQuery-quick-select" bh-advanced-query-role="advancedEasySelect" data-guid="'+C+'" ></div>'),$("[bh-advanced-query-role=addDialog]",t.$advanced).jqxWindow({resizable:!1,draggable:!1,isModal:!0,modalOpacity:.3,width:548,height:400,autoOpen:!1,position:[window.innerWidth/2-274,window.innerHeight/2+$(window).scrollTop()-200]}).on("close",function(){$("body").niceScroll()}).on("open",function(){$("body").getNiceScroll().remove(),$("body").css({overflow:"hidden","overflow-x":"hidden","overflow-y":"hidden"})}),t.$advancedModal=$("[bh-advanced-query-role=addDialog][data-guid="+t.guid+"]"),i(t,e);var D="";$(F).each(function(e){var a=F.indexOf(this);return this.get("hidden")?(F.splice(a,1),!0):(this.xtype&&"text"!=this.xtype?$.inArray(this.xtype,["radiolist","checkboxlist","buttonlist","multi-buttonlist"])>-1&&t._initCount++:D+=this.caption+"/",void(this.quickSearch&&(this.xtype&&"text"!=this.xtype?S.push(this):I.push(this))))}),$("[bh-advanced-query-role=advancedInput]",e).attr("placeholder",D.substr(0,D.length-1)),t.$advanced.data("modalarray",F),t.$advanced.data("easyarray",I),t.$advanced.data("quickarray",S),"easy"==t.searchModel&&(t._initCount=S.length),0==I.length&&0==S.length&&console&&console.warn("没有配置快速搜索字段,所以高级搜索控件无法展示!"),l(I,t),S=JSON.parse(JSON.stringify(S)),$("[bh-advanced-query-role=quickSearchForm]",t.$advanced).html(r(S)).emapFormInputInit({root:"",defaultOptions:{tree:{width:295,unblind:!0,search:!0},switcher:{checked:!0},"date-range":{defaultType:"all"},select:{width:"295px"},"multi-select":{width:"295px"},"multi-select2":{width:"295px"},"multi-tree":{width:"295px"},"date-local":{width:"295px"},"date-ym":{width:"295px"},"date-full":{width:"295px"}}}),m(t,t.defaultItem),t.schema?$.fn.emapSchema&&y(e,t):$(".bh-rules-program, .bh-schema-btn-wrap",t.$advanced).hide(),9==document.documentMode&&JPlaceHolder&&JPlaceHolder.fix(e)},$.fn.emapAdvancedQuery=function(t,a){var i;return i=this.data("plugin"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return $(this).data("plugin",new e(this,t))})},$.fn.emapAdvancedQuery.defaults={allowAllOption:!0,defaultItem:[],searchModel:"easy",schema:!1,showTotalNum:!1}}.call(this),function(){function e(e,t){t.token&&null!=t.token?(t.scope=t.token.substring(0,t.token.length-1),t.displayAvatar=t.contextPath+"/sys/emapcomponent/file/getSingleImageByToken.do?fileToken="+t.token+"&date="+(new Date).getTime(),t.newToken=!1):(t.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),t.token=t.scope+1,t.displayAvatar=t.defaultAvatar,t.newToken=!0),t.$wrap=$('<div class="bh-emapAvatar-wrap"><img class="bh-emapAvatar-avatar" src="'+t.displayAvatar+'"><a class="bh-emapAvartar-btn" href="javascript:void(0)">修改头像</a></div>').css({height:t.width/t.ratio,width:t.width}),t.disabled&&$(".bh-emapAvartar-btn",t.$wrap).hide(),e.append(t.$wrap),a(e,t)}var t,a;t=function(){function t(t,a){this.options=$.extend({},$.fn.emapAvatarUpload.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.destroy=function(){this.options=null,$(this.$element).data("emapAvatarUpload",!1).empty()},t.prototype.getValue=function(){},t.prototype.disable=function(){$(".bh-emapAvartar-btn",this.$element).hide()},t.prototype.enable=function(){$(".bh-emapAvartar-btn",this.$element).show()},t}(),a=function(e,t){var a=t.$wrap;a.on("click",".bh-emapAvartar-btn",function(){$.emapAvatarUploadWindow(e,t)}),$(".bh-emapAvatar-avatar",e).one("error",function(){$(this).attr("src",t.defaultAvatar)})},$.fn.emapAvatarUpload=function(e,a){var i;return i=$(this).data("emapAvatarUpload"),i?e===!0?i:"string"===$.type(e)?i[e](a):this:this.each(function(){return"destroy"==e?this:$(this).data("emapAvatarUpload",new t(this,e))})},$.fn.emapAvatarUpload.defaults={storeId:"image",contextPath:"",ratio:1,width:100,actualWidth:null,type:["jpg","png","jpeg"],size:5120,disabled:!1},$.emapAvatarUploadWindow=function(e,t){function a(e,t){e.cropper({aspectRatio:t.ratio,viewMode:1,movable:!1,zoomOnWheel:!1,preview:".bh-emapAvatar-preview"})}function i(t){if(t.fileId){var a=n(t);if(a.success&&o(t).success&&l(t).success&&r(t).success)return t.onSubmit&&t.onSubmit(t.token),$(".bh-emapAvatar-avatar",e).attr("src",t.contextPath+"/sys/emapcomponent/file/getSingleImageByToken.do?fileToken="+t.token+"&date="+(new Date).getTime()),t.displayAvatar=t.contextPath+"/sys/emapcomponent/file/getSingleImageByToken.do?fileToken="+t.token+"&date="+(new Date).getTime(),!0;if(!a.success)return $(".bh-emapAcatar-error-msg",t.winContent).html(a.error?a.error:"裁剪失败").show(),!1}else t.newToken?t.onSubmit&&t.onSubmit():t.onSubmit&&t.onSubmit(t.token)}function n(e){var t=$(".bh-avatar-img",e.winContent).cropper("getData",!0);return e.actualWidth&&(t.actualWidth=e.actualWidth,t.actualHeight=e.actualWidth/e.ratio),s(e.contextPath+"/sys/emapcomponent/file/cutTempFile/"+e.scope+"/"+e.token+"/"+e.fileId+".do",t)}function o(e){return e.fileId?s(e.contextPath+"/sys/emapcomponent/file/deleteTempFile/"+e.scope+"/"+e.token+"/"+e.fileId+".do",{}):{success:!0}}function l(e){return s(e.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+e.token+".do",{})}function r(e){return s(e.contextPath+"/sys/emapcomponent/file/saveAttachment/"+e.scope+"/"+e.token+".do",{attachmentParam:JSON.stringify({storeId:e.storeId})})}function s(e,t){var a;return $.ajax({type:"post",data:t,url:e,dataType:"json",async:!1}).done(function(e){a=e}).fail(function(e){$(".bh-emapAcatar-error-msg").html("请求失败").show(),a=e}),a}t.winContent=$('<div id="emapAvatarUploadWindow"><ul style="display: none;"><li>本地上传</li><li>推荐头像</li></ul><div><div class="bh-emapAvatar-local"></div><div class="bh-emapAcatar-error-msg bh-text-center" style="color: red;"></div></div><div></div>');var d=function(e,t){var i="FileReader"in window;e.fileupload({url:t.uploadUrl,autoUpload:!0,multiple:!1,dataType:"json",limitMultiFileUploads:1,formData:{size:t.size,type:t.type,storeId:t.storeId},submit:function(e,a){$(".bh-emapAcatar-error-msg",t.winContent).html("").hide();var n=a.files[0];return $(".bh-emapAvatar-text-info",t.winContent).show(),$(".bh-emapAvatar-text-error",t.winContent).hide(),t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(n.name.toUpperCase())?($(".bh-emapAvatar-text-info",t.winContent).hide(),$(".bh-emapAvatar-text-error",t.winContent).html("文件类型不正确").show(),!1):i&&t.size&&n.size/1024>t.size?($(".bh-emapAvatar-text-info",t.winContent).hide(),$(".bh-emapAvatar-text-error",t.winContent).html("文件大小超出限制").show(),!1):void $(".bh-emapAvatar-loader",t.winContent).jqxLoader("open")},done:function(e,i){i.files[0];i.result.success?($(".bh-avatar-img",t.winContent).attr("src",i.result.tempFileUrl).cropper("destroy"),a($(".bh-avatar-img",t.winContent),t),$(".bh-avatar-img-block",t.winContent).show(),o(t),t.fileId=i.result.id):$(".bh-emapAcatar-error-msg",t.winContent).html("图片上传失败").show(),$(".bh-emapAvatar-loader",t.winContent).jqxLoader("close")},fail:function(e,a){a.files[0];$(".bh-emapAvatar-loader",t.winContent).jqxLoader("open"),$(".bh-emapAcatar-error-msg",t.winContent).html("图片上传失败").show()}})};t.uploadUrl=t.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+t.scope+"/"+t.token+".do",$(".bh-emapAvatar-local",t.winContent).html('<div class="bh-emapAvatar-editArea" bh-avatar-role="editArea"><div class="bh-emapAvatar-upload-block"><a href="javascript:void(0)" class="bh-btn bh-btn-default bh-emapAvatar-upload"><i class="iconfont icon-add"></i>选择图片<input type="file"></a><p class="bh-text-caption bh-color-caption bh-text-center bh-emapAvatar-text-info"></p><p class="bh-text-caption bh-color-danger bh-text-center bh-emapAvatar-text-error"></p></div><div class="bh-avatar-img-block"><img class="bh-avatar-img" src="'+t.displayAvatar+'" style="display: none;"><p ><a href="javascript:void(0)" class="bh-emapAvatar-reUpload">重新上传</a> </p></div><div class="bh-emapAvatar-loader"></div></div><div class="bh-emapAvatar-display"><div class="bh-emapAvatar-preview-100 bh-emapAvatar-preview"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-mb-8"></p><div><div class="bh-emapAvatar-preview-40 bh-pull-left bh-emapAvatar-preview" style="margin-right: 8px;"><div class="bh-emapAvatar-preview-div"></div></div><div class="bh-emapAvatar-preview-40 bh-pull-left bh-emapAvatar-preview" style="border-radius: 50%;"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-clearfix bh-mb-8"></p><div class="bh-emapAvatar-preview-28 bh-pull-left bh-emapAvatar-preview" style="margin-right: 8px;"><div class="bh-emapAvatar-preview-div"></div></div><div class="bh-emapAvatar-preview-28 bh-pull-left bh-emapAvatar-preview" style="border-radius: 50%;"><div class="bh-emapAvatar-preview-div"></div></div><p class="bh-clearfix bh-mb-8"></p></div></div>'),$(".bh-avatar-img",t.winContent).one("error",function(){$(this).attr("src",t.defaultAvatar)}).on("load",function(){a($(this),t)}),BH_UTILS.bhWindow(t.winContent,"头像上传",void 0,{width:"560px",close:function(){$(".bh-avatar-img",t.winContent).cropper("destroy")}},function(){return i(t)}),$(".bh-emapAvatar-preview",t.winContent).each(function(){var e=$(this).width(),a=parseInt($(this).width()/t.ratio),i=$(this).next("p");
$(this).css({height:a}),i.length>0&&i.html(e+" * "+a+"px")});var c=t.type.join("、").toUpperCase(),p=t.size>1024?t.size/1024+"M":t.size+"K";$(".bh-emapAvatar-text-info",t.winContent).html("只支持"+c+"，大小不超过"+p),$(".bh-emapAvatar-loader",t.winContent).jqxLoader({}),d($("input[type=file]",t.winContent),t),$(".bh-emapAvatar-reUpload",t.winContent).on("click",function(){$("input[type=file]",t.winContent).click()})}}.call(void 0),function(e){function t(){d=null,c=null,p=0,u={}}function a(e,t){i(t),e._init=!0,n(e,t)}function i(e){var t='<div> <div class="bh-emapCard-card-list"></div> <div class="bh-emapCard-card-pagination" style="clear:both;"></div></div>';e.html(t)}function n(t,a,i,s){var s=parseInt(s||c||u.pageSize||t.pageSize||12),i=parseInt(i||u.pageNumber||d||t.pageNumber||0);u.querySetting||t._init||t.params||(u.querySetting="[]"),d=i,c=s;var m=e.extend({},t.params,u,{pageSize:s,pageNumber:i+1,querySetting:u.querySetting});t.pageable||(delete m.pageSize,delete m.pageNumber),t._init=!1;var f="post",b=WIS_EMAP_SERV.getAbsPath(t.pagePath).replace(".do","/"+t.action+".do");-1==t.pagePath.indexOf(".do")&&(f="get",b=l(t.pagePath,t.action)),e.ajax({url:b,data:m,type:f}).done(function(l){h=l;var d=l.datas[t.action].totalSize;p=d;var c=l.datas[t.action].rows,u=e('<div class="bh-clearfix"></div>'),m=c.length;if(m)for(var f=0;m>f;f++){var b=t.cardBeforeRender?t.cardBeforeRender(c[f])||c[f]:c[f];u.append(r(t.template,b))}else u.html('<div style="display:table;width:100%;height:100%;padding:22px 0 16px 0"><div class="bh-color-info-3" style="text-align:center;vertical-align:middle;display:table-cell;"><i class="iconfont" style="font-size:48px;">&#xe62a;</i><h3 style="color:#999;margin-top: 12px;">暂无数据</h3></div></div>');a.find(".bh-emapCard-card-list").html(u,!0),t.pageable&&(a.find(".bh-emapCard-card-pagination").pagination({pagenum:i,pagesize:s,totalSize:d,mode:t.pageMode,pageSizeOptions:t.pageSizeOptions}),a.find(".bh-emapCard-card-pagination").off("pagersearch").on("pagersearch",function(e,i,o,l){o=parseInt(o),n(t,a,i+"",o),t.pageSizeOptionsChange&&t.pageSizeOptionsChange(o,i)})),t.cardAfterRender&&t.cardAfterRender(),o(a)})}function o(t){t.closest(".bh-paper-pile-dialog").length>0&&(e.bhPaperPileDialog.resetPageFooter(),e.bhPaperPileDialog.resetDialogFooter())}function l(t,a){var i=null,n=null;e.ajax({url:t,async:!1}).done(function(e){i=e});for(var o=0;o<i.models.length;o++)if(i.models[o].name==a){n=i.models[o];break}return n.url}function r(e,t){var a=null;return a="object"==typeof e?e:Hogan.compile(e),a.render(t)}var s,d=null,c=null,p=0,h={},u={};s=function(){function i(i,n){t(),this.settings=e.extend({},e.fn.emapCard.defaults,n),this.$element=e(i),a(this.settings,this.$element)}return i}(),s.prototype={reload:function(e,t){u=e||u,(void 0===u.pageNumber||t)&&(u.pageNumber="0"),n(this.settings,this.$element,null,null,u)},reloadFirstPage:function(e){this.reload(e,!0)},getTotalRecords:function(){return p},getResult:function(){return h}},e.fn.emapCard=function(t,a){var i;return i=this.data("emapCard"),i?t===!0?i:"string"===e.type(t)?i[t](a):this:this.each(function(){return e(this).data("emapCard",new s(this,t))})},e.fn.emapCard.defaults={template:"no template!",pagePath:null,action:null,pageMode:"advanced",pageable:!0,pageSizeOptions:[12,24,48,96],pageSize:12,params:{}}}(jQuery),function(){function e(e){var o=$.extend({},e.settings);try{delete o.pk,delete o.url,delete o.pagePath,delete o.params,delete o.datamodel,delete o.method,delete o.action,delete o.customColumns,delete o.colHasMinWidth,delete o.beforeSend,delete o.downloadComplete,delete o.schema,delete o.contextPath,delete o.searchElement,delete o.minLineNum,delete o.onceParams,delete o.alwaysHide,delete o.customModelName,delete o.formatData}catch(s){}var d=new $.jqx.dataAdapter(e.source,{formatData:function(t){o.pageable&&(t.pageSize=t.pagesize,t.pageNumber=t.pagenum+1);var a="+";return o.sortable&&t.sortdatafield&&t.sortorder&&("asc"==t.sortorder?a="+":"desc"==t.sortorder&&(a="-"),t["*order"]=a+t.sortdatafield.split("_DISPLAY")[0]),e.settings.formatData&&"function"==typeof e.settings.formatData&&(t=e.settings.formatData(t)),delete t.pagesize,delete t.pagenum,delete t.filterslength,delete t.sortdatafield,delete t.sortorder,t},beforeSend:function(t){"function"==typeof e.settings.beforeSend&&e.settings.beforeSend.call(null)},downloadComplete:function(t,a,i){return"function"==typeof e.settings.downloadComplete&&e.settings.downloadComplete(t,a,i),"undefined"!=typeof t.loginURL&&""!=t.loginURL?void(window.location.href=t.loginURL):("undefined"!=typeof window.MOCK_CONFIG?e.source.totalRecords=getTotalRecordsMock(t,e.settings.action):e.source.totalRecords=t.datas[e.settings.action].totalSize||t.datas[e.settings.action].total_size,e.$element.data("tableResult",t),void(e.settings.searchElement&&e.settings.searchElement.length>0&&e.settings.searchElement.emapAdvancedQuery("updateTotalNum",e.source.totalRecords?e.source.totalRecords:0)))}}),c=o.ready,p=o.rendered,h=o.rendered=function(){l(e),"function"==typeof p&&p()};o.columns=r(e,o,c,h),o.source=d,e.$element.jqxDataTable(o),e.$element.on("sort",function(t){var a=t.args;e.$element.data("sortfield",a)}),e.$element.on("bindingComplete",function(o){e.$element.jqxDataTable("getPageInformation");l(e),n(e),a(e),i(e),t(e)}),e.$element.trigger("emapdatatable.created",[e])}function t(e){e.$element.closest(".bh-paper-pile-dialog").length>0&&($.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter())}function a(e){var t=e.$element.attr("id"),a=$("#horizontalScrollBar"+t);if("hidden"!=a.css("visibility")){var i=e.$element.jqxDataTable("height");null!=i&&e.$element.jqxDataTable("height",i+17)}}function i(e){var t=e.$element.attr("id"),a=$("#verticalScrollBar"+t),i=e.$element.jqxDataTable("getRows"),n=e.settings.minLineNum;null==n||isNaN(n)||"hidden"!=a.css("visibility")&&i.length<=n&&e.$element.jqxDataTable("height",null)}function n(e){var t=e.$element.jqxDataTable("getRows"),a=e.settings.minLineNum;null==a||isNaN(a)||(t.length<a?e.$element.jqxDataTable("height",BH_UTILS.getTableHeight(parseInt(a))):e.$element.jqxDataTable("height",null))}function o(e,t,a){var i,n=e.$element;return e.settings.schema&&e.settings.contextPath?(n.emapSchema({schemaType:"col",contextPath:a,data:{modelName:t}}),i=n.emapSchema("getSchemaList"),i&&i[0]&&i[0].CONTENT?i[0].CONTENT.split(","):[]):!1}function l(e){var t=e.$element.data("sortfield");("undefined"==typeof t||0==t.sortdirection.ascending&&0==t.sortdirection.descending)&&e.$element.find("td.jqx-grid-cell-sort").removeClass("jqx-grid-cell-sort"),e.$element.find("div.sortasc, div.sortdesc").css("background","none")}function r(e,t,a,i){var n,l=[],r=e.settings.datamodel||WIS_EMAP_SERV.getModel(e.settings.pagePath,e.settings.action,"grid",e.settings.params);e.$element.data("tableDataModel",r),e.$element.attr("emap",JSON.stringify({"emap-pagePath":e.settings.pagePath,"emap-action":e.settings.action,"emap-url":WIS_EMAP_SERV.url,"emap-name":WIS_EMAP_SERV.name,"emap-app-name":WIS_EMAP_SERV.appName,"emap-model-name":WIS_EMAP_SERV.modelName})),n=o(e,WIS_EMAP_SERV.modelName||e.settings.customModelName,e.settings.contextPath),delete WIS_EMAP_SERV.url,delete WIS_EMAP_SERV.name,delete WIS_EMAP_SERV.appName,delete WIS_EMAP_SERV.modelName;var d=0,c=e.settings.customColumns;"undefined"!=typeof c&&null!=c&&(d=c.length);for(var p=[],u=null,m=[],f=0;d>f;f++){var b=c[f].colIndex,g=c[f].colField,v=c[f].type;if(b>40&&(b="last"),"last"==b)u=c[f];else if("undefined"!=typeof g&&""!=g)for(var y=0;y<r.length;y++)r[y].name==g&&(r[y].custom=c[f]);else"undefined"!=b&&(b=0>b?0:b,"link"!=v?p[b]={custom:c[f]}:m.push({colIndex:b,column:c[f]}))}for(var x=0;x<r.length;x++)"function"==typeof r[x].get&&(e.source.datafields.push({name:r[x].name,type:"string"}),"undefined"!=typeof r[x].url&&e.source.datafields.push({name:r[x].name+"_DISPLAY",type:"string"}));for(var A=0;A<p.length;A++)void 0==p[A]&&(r.length>0?p[A]=r.shift():(p.splice(A,1),A--));r.length>0&&(p=p.concat(r)),null!=u&&p.push({custom:u});for(var w,k,F=0;F<p.length;F++){for(var I=0;I<m.length;I++)F==m[I].colIndex&&(p[F].custom=m[I].column);"undefined"!=typeof p[F].name&&e.source.datafields.push({name:p[F].name,type:"string"}),"undefined"!=typeof p[F].url?(w=p[F].name+"_DISPLAY",e.source.datafields.push({name:w,type:"string"})):w=p[F].name;var S=null,C={},D=p[F].hidden===!0||p[F]["grid.hidden"]===!0;if("function"==typeof p[F].get&&(D=D||p[F].get("hidden")===!0),e.settings.schema&&n&&n.length&&p[F].name){k=p[F].name;var T=n.map(function(e){return e.replace("_DISPLAY","")});D=-1===$.inArray(k,T)}var P=!1;if(P=p[F].pinned,P!==!0&&(P=!1),void 0==p[F].custom)S=void 0==p[F]["grid.width"]?null:p[F]["grid.width"],C=s(S,e.settings.colHasMinWidth),l.push($.extend({},{text:p[F].caption,datafield:w,hidden:D,pinned:P,cellsRenderer:function(e,t,a,i){return'<span title="'+$("<div>"+a+"</div>").text()+'">'+a+"</span>"}},C));else{var v=p[F].custom.type,E=p[F].custom.showCheckAll;S=p[F].custom.width,void 0==S&&(S=void 0==p[F]["grid.width"]?null:p[F]["grid.width"]),C=s(S,e.settings.colHasMinWidth);var _=h(v,e,t,E,C,p[F],w,a,i);l.push($.extend({hidden:D,pinned:P},_))}}return e.$element.data("newmodel",p),e.$element.data("columns",l),l}function s(e,t){var a=null==e?"":e.toString();return a=a.replace("px","").replace("PX","").replace("%",""),a=$.trim(a),t?null==e||""==a||isNaN(a)?{minWidth:100}:(e=e.toString(),e.replace("px","").replace("PX",""),-1==e.indexOf("%")&&parseInt(e)<100&&(e=100),{width:e,minWidth:100}):e&&""!=a&&!isNaN(a)?{width:e}:{}}function d(e,t){var a=e.$element,i=[];t.forEach(function(e){e.hasOwnProperty("datafield")&&!e.hidden&&i.push(e.datafield)}),a.emapSchema("saveSchema",["emap.table",i.join(",")])}function c(e,t,a,i){var n="",o=[],l=[],r=0;$.each(a,function(a,i){if(i.datafield){if(i.hidden){var s=!1;e.settings.alwaysHide.length&&(s=$.inArray(i.datafield.replace("_DISPLAY",""),e.settings.alwaysHide)>-1),(t[a].fixed||t[a]["grid.fixed"])&&(s=!0),n=' <li class="bh-col-md-4" style="line-height: 32px; '+(s?"display: none;":"")+'"><div class="bh-checkbox"><label><input type="checkbox" name="'+i.datafield+'" data-caption="'+i.text+'"><i class="bh-choice-helper"></i>'+i.text+"</label></div></li>",l.push(n),s||r++}else n=' <li class="bh-col-md-4" style="line-height: 32px;"><div class="bh-checkbox"><label><input type="checkbox" name="'+i.datafield+'" data-caption="'+i.text+'" checked><i class="bh-choice-helper"></i>'+i.text+"</label></div></li>",l.push(n),r++;t[a].common&&o.push(n)}});var s='<div class="bh-emapdatatable-dialog"><div><h2>'+i.name+'</h2></div><div class="bh-emapdatatable-dialog-content "><div class="bh-clearfix"><ul class="bh-emapdatatable-dialog-list" bh-emapdatatable-role="commonList" style="list-style:none">'+o.join("")+'</ul></div><div class="bh-text-caption bh-color-caption">可用字段（'+r+'）</div><div class="bh-clearfix"><ul class="bh-emapdatatable-dialog-list" bh-emapdatatable-role="availableList" style="list-style:none; height: 240px;overflow-y: auto;overflow-x: hidden;">'+l.join("")+'</ul></div><div class="bh-mt-16 bh-text-right"><button bh-emapdatatable-role="confirmSelecte" class="bh-btn bh-btn-primary">确认</button><button bh-emapdatatable-role="cancel" class="bh-btn bh-btn-default">取消</button></div></div>';e.$element.after(s);var d=e.$element.next();d.jqxWindow({resizable:!1,draggable:!0,isModal:!0,modalOpacity:.3,width:548,height:400,autoOpen:!1,position:[window.innerWidth/2-274,window.innerHeight/2+$(window).scrollTop()-200]}).on("close",function(){$("body").niceScroll()}).on("open",function(){$("body").getNiceScroll().remove(),$("body").css({overflow:"hidden","overflow-x":"hidden","overflow-y":"hidden"})}),p(e,d,a,i),d.jqxWindow("open")}function p(e,t,a,i){var n=t,o=a;n.on("click",'[bh-emapdatatable-role="confirmSelecte"]',function(){n.find('input[type="checkbox"]').each(function(){for(var e=$(this).attr("name"),t={},a=0;a<o.length;a++)if(o[a].datafield==e){t=o[a];break}$(this).prop("checked")?t.hidden=!1:t.hidden=!0}),i.handler(o),n.jqxWindow("close")}),n.on("click",'[bh-emapdatatable-role="cancel"]',function(){n.jqxWindow("close")}),n.on("close",function(){n.jqxWindow("destroy")})}function h(e,t,a,i,n,o,l,r,s){var d=null;switch(e){case"checkbox":var c=o.custom.pinned;c!==!0&&(c=!1),d={text:"checkbox",width:32,minWidth:32,maxWidth:32,cellsAlign:"center",align:"center",sortable:!1,pinned:c,renderer:function(e,t,a){var n='<div class="selectAllCheckboxFlag bh-checkbox bh-mh-8"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return i===!1?" ":n},rendered:function(e,a,i){return e.on("click","input",function(e){var a=t.$element,i=a.find('table:not([id^="pinnedtable"])');a.find('table[id^="pinnedtable"]').length>0&&(i=a.find('table[id^="pinnedtable"]'));var n=i.find("div.bh-checkbox"),o=$(this);o.hasClass("selectFlag")?(o.prop("checked",!1).removeClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!1)})):(o.prop("checked",!0).addClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!0)})),$(this).trigger("checkall"),e.stopPropagation()}),!0},cellsRenderer:function(e,t,a,i){var n='<div data-sss="" class="bh-checkbox bh-mh-4" style="margin-left:0 !important;"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return n}},a.rendered=function(){var e=t.$element,a=e.find('table:not([id^="pinnedtable"])');e.find('table[id^="pinnedtable"]').length>0&&(a=e.find('table[id^="pinnedtable"]'));var i=a.find("div.bh-checkbox"),n=!0;0==i.length&&(n=!1),i.each(function(){var e=$(this);return 0===e.find("input[checked]").length?void(n=!1):void 0});var o=a.find("div.selectAllCheckboxFlag").find("input");o.hasClass("selectFlag")&&i.find("input").attr("checked",!0),"function"==typeof s&&s()},a.ready=function(){t.$element.on("click","div.bh-checkbox",function(){u($(this).find("input"),t),$(this).trigger("checkone")}),"function"==typeof r&&r()};break;case"link":var c=o.custom.pinned;c!==!0&&(c=!1);var p={text:o.caption,datafield:l,pinned:c},h={cellsRenderer:function(e,t,a,i){return isNaN(a)||(a=a.toString()),'<a class="sc-cursor-point j_link_'+t+'">'+a+"</a>"}};d=$.extend(p,h,n);break;case"tpl":var p={text:o.caption,datafield:l,sortable:!1};d=$.extend(p,o.custom.column,n)}return d}function u(e,t){if(!e.hasClass("selectAllCheckboxFlag")){var a=t.$element,i=a.find("div.selectAllCheckboxFlag").find("input"),n=a.find("table"),o=n.find("div.bh-checkbox");if(e.prop("checked")){var l=!0;o.find("input").each(function(){$(this).prop("checked")||(l=!1)}),l?i.prop("checked",!0).addClass("selectFlag"):i.prop("checked",!1).removeClass("selectFlag")}else i.prop("checked",!1).removeClass("selectFlag")}}function m(){var e;try{e=contextPath}catch(t){}return e}var f;f=function(){function t(t,a){this.settings=$.extend({},$.fn.emapdatatable.defaults,a),this.$element=$(t),this.$element.attr("emap-role","datatable").attr("emap-pagePath",this.settings.pagePath).attr("emap-action",this.settings.action);var i=this.settings.url||WIS_EMAP_SERV.getAbsPath(this.settings.pagePath).replace(".do","/"+this.settings.action+".do"),n=this.settings.method||"POST";"undefined"!=typeof window.MOCK_CONFIG&&(n=this.settings.method||getMethodMock(),"undefined"==typeof this.settings.url&&(i=getURLMock(i,this.settings)));var o=$.extend({},this.settings.params,this.settings.onceParams);this.source={root:"datas>"+this.settings.action+">rows",id:this.settings.pk||"WID",datatype:"json",url:i,data:o||{},type:n,datafields:[]},"undefined"!=typeof window.MOCK_CONFIG&&(this.source=getSourceMock(this.source)),e(this)}return t.prototype.reload=function(e,t){var a=e._gotoFirstPage;a&&delete e._gotoFirstPage,this.source.data=e,t===!0||a===!0?this.$element.jqxDataTable("goToPage",0)||this.$element.jqxDataTable("updateBoundData"):this.$element.jqxDataTable("updateBoundData");var i=this;if("function"==typeof t)var n=setInterval(function(){i.$element.jqxDataTable("isBindingCompleted")&&(clearInterval(n),t(),i.$element.jqxDataTable("refresh"))},10)},t.prototype.reloadFirstPage=function(e,t){this.reload($.extend({},e,{_gotoFirstPage:!0}),t)},t.prototype.checkedRecords=function(){var e=[],t=this.$element.jqxDataTable("getRows"),a=this.$element.find('table:not([id^="pinnedtable"]) tr');return this.$element.find('table[id^="pinnedtable"]').length>0&&(a=this.$element.find('table[id^="pinnedtable"] tr')),a.each(function(a){var i=$(this).find('input[type="checkbox"]').prop("checked");i&&e.push(t[a])}),e},t.prototype.getTotalRecords=function(){return this.source.totalRecords},t.prototype.getResult=function(){return this.$element.data("tableResult")},t.prototype.getSort=function(){var e=this.$element.data("sortfield");if(void 0!==e){var t={direction:e.sortdirection,field:e.sortcolumn,exp:""};return 1==e.sortdirection.ascending?t.exp="+"+e.sortcolumn:1==e.sortdirection.descending&&(t.exp="-"+e.sortcolumn),t}},t.prototype.getModel=function(){return this.$element.data("tableDataModel")},t.prototype.selectColumnsExport=function(e){this.selectToShowColumns({type:"export",params:e})},t.prototype.selectToShowColumns=function(e){var t=this;e.type=e.type||"toggle","export"===e.type?(e.name="导出选择字段",e.handler=function(a){var i,n;n=[],a.forEach(function(e){e.hidden===!1&&e.hasOwnProperty("datafield")&&n.push(e.datafield)}),i=$.extend({},e.params,{colnames:n.join(",").replace(/_DISPLAY/g,"").toUpperCase()}),t["export"](i)}):(e.name="显示/隐藏字段",e.handler=function(e){t.$element.jqxDataTable({columns:e}),t.settings.schema&&t.settings.contextPath&&d(t,e)});var a=this.$element.data("columns"),i=this.$element.data("newmodel");c(this,i,a,e)},t.prototype["export"]=function(e){var t=e.root;delete e.root,$.ajax({url:t+"/sys/emapcomponent/imexport/export.do",data:e,type:"POST"}).done(function(e){e=JSON.parse(e),window.location=location.protocol+"//"+location.host+t+"/sys/emapcomponent/file/getAttachmentFile/"+e.attachment+".do"})},t}(),$.fn.emapdatatable=function(e,t,a,i){var n,o;if(n=this.data("emapdatatable"),o=this.data("initParams")||{},!n)return $(this).data("initParams",e.params),this.each(function(){return $(this).data("emapdatatable",new f(this,e))});if(e===!0)return n;if("string"===$.type(e)){var l=$.extend({},o,t),r=[];return"undefined"==typeof l.querySetting,"undefined"!=typeof l.querySetting&&i!==!1&&(r=JSON.parse(l.querySetting),$.each(l,function(e,t){"querySetting"==e||"number"!=$.type(t)&&"string"!=$.type(t)&&"boolean"!=$.type(t)||r.push({name:e,value:t,linkOpt:"and",builder:"equal"})}),l.querySetting=JSON.stringify(r)),n[e](l,a)}return this};var b=null;"undefined"!=typeof BH_UTILS&&(b=BH_UTILS.getTableHeight(10));var g=null;"undefined"!=typeof Globalize&&(g=Globalize.culture("zh-CN")),$.fn.emapdatatable.defaults={width:"100%",height:b,pageable:!0,pagerMode:"advanced",serverProcessing:!0,pageSizeOptions:["10","20","50","100"],localization:g,sortable:!1,selectionMode:"custom",enableBrowserSelection:!0,columnsResize:!0,colHasMinWidth:!0,beforeSend:null,schema:!0,contextPath:m(),minLineNum:null,alwaysHide:["WID","TBRQ","TBLX","CZRQ","CZZ","CZZXM"]}}.call(this),function(){function e(e,t){if(t.eleWidth=e.width(),!t.actionName){var i=t.url.split("/");t.actionName=i[i.length-1].split(".")[0]}var n={datatype:"json",root:"datas>"+t.actionName+">rows",url:t.url,type:"POST",async:!0},o=new $.jqx.dataAdapter(n,{beforeLoadComplete:function(e){return $(e).each(function(){this._displayData=JSON.stringify(this)}),e},beforeSend:function(t,a){""===e.jqxComboBox("searchString")&&t.abort()},formatData:function(a){return void 0!=e.jqxComboBox("searchString")?(a.queryopt=e.jqxComboBox("searchString"),a.pageSize=10,a.pageNumber=1,t.formatData&&(a=t.formatData(a)),a):void 0}});e.addClass("bh-edt").jqxComboBox({remoteAutoComplete:!0,source:o,remoteAutoCompleteDelay:500,enableBrowserBoundsDetection:!0,displayMember:"_displayData",valueMember:"id",renderer:function(e,a,i,n){var o="",l=JSON.parse(a);if(!t.searchMember){t.searchMember=[];for(var r in l)"uid"!=r&&"queryopt"!=r&&($.inArray(r,t.hideMember)>-1||t.searchMember.push(r))}for(var r in l)"uid"!=r&&"queryopt"!=r&&($.inArray(r,t.hideMember)>-1||(o+='<div class="bh-mh-8" style="display: inline-block;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;max-width: '+t.eleWidth/t.searchMember.length+'px;" title="'+l[r]+'">'+(void 0===l[r]||null===l[r]?"-":l[r])+"</div>"));return o},renderSelectedItem:function(e,a){var i=JSON.parse(a.label);return i[t.valueMember]?i[t.valueMember]:i.id},search:function(e){o.dataBind()}}).on("open",function(){e.data("datainit")||(o.dataBind(),e.data("datainit",!0))}),a(e,t)}var t,a,i;t=function(){function t(t,a){this.options=$.extend({},$.fn.emapDropdownTable.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.getValue=function(){return this.$element.val()},t.prototype.setValue=function(e){var t=this.$element;""==e[0]&&t.val(""),t.jqxComboBox("getItemByValue",e[0])||t.jqxComboBox("addItem",{id:e[0],name:e[1],_displayData:function(){var t={};return t.name=e[1],t.id=e[0],JSON.stringify(t)}()}),t.jqxComboBox("selectItem",e[0])},t.prototype.destroy=function(){this.$element.jqxComboBox("destroy")},t}(),a=function(e,t){e.on("select",function(e){e.args&&(t.curValue=e.args.item.value)}),t.autoClear&&$("input.jqx-combobox-input",e).on("blur",function(){try{e.val()!=t.curValue&&e.jqxComboBox("clearSelection")}catch(a){console&&console.log(a)}})},i=function(e,t,a){$(a).each(function(){e.jqxComboBox("addItem",this)})},$.fn.emapDropdownTable=function(e,a){var i;return i=this.data("emapdropdowntable"),i?e===!0?i:"string"===$.type(e)?i[e](a):this:this.each(function(){return $(this).data("emapdropdowntable",new t(this,e))})},$.fn.emapDropdownTable.defaults={valueMember:"id",displayMember:"name",hideMember:[],autoClear:!0,width:300}}.call(void 0),function(){var e,t,a,i,n,o,l;e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapDropdownTree.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e.prototype.getValue=function(){return $(this.$element.data("values")).map(function(){return this.value}).get().join(",")},e.prototype.getText=function(){return $(this.$element.data("values")).map(function(){return this.label}).get().join(",")},e.prototype.setValue=function(e){var t=e[0],a=e[1];this.$element.jqxDropDownButton("setContent",a),this.$element.data("values",[{value:t,label:a}]),this.$element.trigger("change")},e.prototype.disable=function(){this.$element.jqxDropDownButton({disabled:!0})},e.prototype.enable=function(){this.$element.jqxDropDownButton({disabled:!1})},e}(),t=function(e,t){for(var a="",i=0;6>i;i++)a+=Math.floor(10*Math.random());t.$tree=$('<div style="border: none;" class="dropdown-tree"></div>'),t.$tree.attr("id","tree_"+a),e.attr("id","content_"+a),e.append(t.$tree),t.checkboxes?t.$tree.on("checkChange",function(e){var t=$(this),a=t.attr("id").substr("tree_".length),i=$("#content_"+a),n=e.args,o=t.jqxTree("getCheckedItems",n.element),l=[],r=o.map(function(e){return l.push({label:e.label,value:e.value}),e.label}).join(",");i.jqxDropDownButton("setContent",r),i.data({values:l}),i.trigger("change")}):t.$tree.on("select",function(e){var a=$(this),i=e.args,o=a.attr("id").substr("tree_".length),l=$("#content_"+o),r=a.jqxTree("getItem",i.element),s=[],d=n(r,t.$tree).reverse().join("/"),c=r.value;s.push({label:d,value:c});var p=l.triggerHandler("select",[s,a,i]);(void 0===p||1==p)&&(l.jqxDropDownButton("setContent",d),l.data({values:s}),l.jqxDropDownButton("close"))}),e.jqxDropDownButton({enableBrowserBoundsDetection:!0,width:t.width?t.width:"100%"}),e.on("close",function(){$(this).trigger("change")}).on("open",function(){t.treeInit||(l(e,t),t.treeInit=!0)}),e.jqxDropDownButton("setContent","请选择...")},a=function(e){if(e.url){var t=$.extend({pId:""},e.params);e.params&&e.params.searchValue&&(t=e.params);var a={datatype:"json",root:"datas>code>rows",datafields:[{name:"id"},{name:"pId"},{name:"name"},{name:"isParent"}],id:"id",url:e.url,data:t,type:"POST"},n=new $.jqx.dataAdapter(a,{beforeLoadComplete:function(t,a){var i=[];0==e.checkboxes&&i.push({name:"请选择...",pId:"...",value:""});for(var n=0;n<t.length;n++){var o=t[n];if(i.push({id:o.id,name:o.name,pId:o.pId?o.pId:"...",value:o.id}),!(1!==o.isParent||e.params&&e.params.checkParent)){var l={id:o.id+"_load",name:"加载中...",pId:o.id,value:o.id};i.push(l)}}return i},loadComplete:function(){function t(e,a){e.length&&e.map(function(e){e.label=e.name.substring(e.name.lastIndexOf(a)+1,e.name.length),e.items&&e.items.length&&t(e.items,a)})}var a=n.getRecordsHierarchy("id","pId","items",[{name:"name",map:"label"}]);o(a);var i=$.extend({width:e.width?e.width:"100%",height:220,hasThreeStates:!1,allowDrag:!1,source:a,checkSize:16},{checkboxes:e.checkboxes});e.params&&e.params.checkParent?t(i.source,e.unblind):e.$tree.on("expand",function(t){var a=$(this),i=$(t.args.element),n=!1,o=null,l=i.find("ul:first").children();if($.each(l,function(){var e=a.jqxTree("getItem",this);return e&&"加载中..."==e.label?(o=e,n=!0,!1):void 0}),n){var r=e.unblind;$.ajax({url:e.url,data:{pId:o.value.replace(".fake","")},success:function(t,n,l){var s=t;if(s.datas&&s.datas.code&&s.datas.code.rows){for(var d=s.datas.code.rows,c=[],p=d.length-1;p>=0;p--){var h=d[p].name;r&&(h=h.substring(h.lastIndexOf(e.unblind)+1,h.length));var u={label:h,value:d[p].id};1===d[p].isParent&&(u.items=[{value:d[p].id,label:"加载中..."}]),c.push(u)}a.jqxTree("addTo",c,i[0]),a.jqxTree("removeItem",o.element)}}})}}),e.$tree.jqxTree(i),setTimeout(function(){e.$tree.jqxTree({height:"220px"})},0),e.params&&e.params.checkParent&&(e.$tree.off("expand"),e.$tree.jqxTree("expandAll"))}});n.dataBind()}else{var l=i(e.datas),r=$.extend({width:e.width?e.width:"100%",height:220,hasThreeStates:!1,allowDrag:!1,source:l,checkSize:16},{checkboxes:e.checkboxes});e.$tree.jqxTree(r)}},l=function(e,t){if(t.$tree.niceScroll(),t.search){var i=$('<input style="height: 21px; top: 3px; left: 3px;  width: calc(100% - 4px); margin: 2px 0 2px 2px; border-radius: 2px;" class="treeSearchInput jqx-widget jqx-listbox-filter-input jqx-input jqx-rc-all" type="text" placeHolder="搜索..."/>');t.$tree.before(i),i.keyup(function(){window.clearTimeout(i.data("timerId")),i.data("timerId",window.setTimeout(function(){var e=i.val();if(e){var n={"*tree":"1",searchValue:e,checkParent:!0};t.$tree.jqxTree("clear"),t.params=$.extend({},t.params,n),a(t)}else t.$tree.jqxTree("clear"),t.params=i.data("originalParam"),a(t)},500))})}a(t)},i=function(e){var t={datatype:"json",datafields:[{name:"id"},{name:"pId"},{name:"name"}],id:"id",localdata:e},a=new $.jqx.dataAdapter(t);a.dataBind();var i=a.getRecordsHierarchy("id","pId","items",[{name:"name",map:"label"},{name:"id",map:"value"}]);return i},n=function(e,t){var a=[];return a.push(e.label),null!=t.jqxTree("getItem",e.parentElement)&&(a=a.concat(n(t.jqxTree("getItem",e.parentElement),t))),a},o=function(e){for(var t=0;t<e.length;t++)delete e[t].id,delete e[t].pId,e[t].items&&o(e[t].items)},$.fn.emapDropdownTree=function(t,a){var i;return i=this.data("emapDropdownTree"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return $(this).data("emapDropdownTree",new e(this,t))})},$.fn.emapDropdownTree.defaults={width:"100%",checkboxes:!1,search:!0}}.call(this),function($){function init(e,t){this.models=getModels.call(this),this.dataPath=getDataPath.call(this),this.dataFields=getDataFields.call(this,this.models),this.source=getSource.call(this),this.columns=getColumns.call(this),render.call(this)}function render(){var e=$.extend({},this.settings);e.source=this.source,e.columns=this.columns,delete e.pagePath,delete e.action,delete e.checkbox,delete e.editableFields,delete e.filter,this.$element.jqxDataTable(e)}function getColumns(){var e=[],t=null,a=(this.models,this);this.settings.checkbox&&(t=getCheckboxColumn.call(this),e.push(t));for(var i=0;i<this.models.length;i++)!function(){var t=a.models[i],n=a.settings.editable&&_.contains(a.settings.editableFields,t.name),o=generateColumnByModel.call(a,t,n);e.push(o)}();return e}function createCombo(e,t,a,i){var n={datatype:"json",datafields:[{name:"id"},{name:"name"}],url:e.url},o=new $.jqx.dataAdapter(n,{async:!1,downloadComplete:function(e,t,a){try{var i=[{id:"",name:"请选择..."}];return e.data=i.concat(e.datas.code.rows),delete e.datas,delete e.code,e}catch(o){n.totalRecords=e.recordsTotal}}});t.jqxDropDownList({placeHolder:"请选择...",source:o,displayMember:"name",valueMember:"id",width:a-10,height:25})}function generateColumnByModel(e,t){var a=getColumnWidth(e),i=this,n={text:e.caption,dataField:e.name,hidden:e.hidden,width:a,cellsRenderer:function(t,a,i,n){return e.url&&(i=n[a+"_DISPLAY"]),'<span title="'+i+'">'+i+"</span>"}};return t?(n.createEditor=function(t,a,n,o,l,r){var s=n;if(e.url){var s=$("<div class='dropDownList'></div>");n.after(s),n.hide()}createField.call(i,e,s,l,r)},n.initEditor=function(t,a,n,o,l,r){var s=this;if(e.url){n=n.parent().find(".dropDownList"),n.jqxDropDownList({width:l-10,height:r}).off("select").on("select",function(a){var o=a.args;if(o){var l=o.item,r=l.label;s.displayValue={row:t,display:r};var d=i.$element.jqxDataTable("getRows")[t];d[e.name]=o.item.value,d[e.name+"_DISPLAY"]=o.item.label,n.jqxDropDownList("selectItem",l)}});var d=n.jqxDropDownList("getItems");n.jqxDropDownList("clearSelection");for(var c=null,p=0;p<d.length;p++)if(d[p].value==a){c=d[p].index;break}n.jqxDropDownList("selectIndex",c)}else{var h=n.find("input");h.val(a)}},n.getEditorValue=function(t,a,i){return e.url&&(i=i.parent().find(".dropDownList")),getEditorValue(e,i)}):n.editable=!1,n}function createField(e,t,a,i){if(e.url)createCombo(e,t,a,i);else if("int"==e.dataType)this.createNumber(e,t,a,i);else{var n=$("<input style='padding-left: 4px; border: none;'/>").appendTo(t);n.jqxInput({source:getEditorDataAdapter.call(this,e.name),displayMember:e.name,width:a,height:i})}}function getEditorDataAdapter(e){var t=this.dataFields,a={localData:this.source.records,dataType:"array",dataFields:t},i=new $.jqx.dataAdapter(a,{uniqueDataFields:[e]});return i}function getEditorValue(e,t){if(e.url){var a=t.jqxDropDownList("getSelectedItem");return a?a.value:""}return t.find("input").val()}function getColumnWidth(e){var t=e.url,a=e["grid.width"];if(a)return a;var i=1;return t&&(i=10),null}function getCheckboxColumn(){var e=this,t={text:"checkbox",width:"32px",cellsAlign:"center",align:"center",editable:!1,renderer:function(e,t,a){var i='<div class="selectAllCheckboxFlag bh-checkbox bh-mh-8"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return i},cellsRenderer:function(e,t,a,i){var n='<div data-sss="" class="bh-checkbox bh-mh-4" style="margin-left:0 !important;"><label><input type="checkbox" value=""><i class="bh-choice-helper"></i></label></div>';return n},rendered:function(t,a,i){return t.on("click","input",function(t){var a=e.$element,i=a.find("table"),n=i.find("div.bh-checkbox"),o=$(this);o.hasClass("selectFlag")?(o.prop("checked",!1).removeClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!1)})):(o.prop("checked",!0).addClass("selectFlag"),n.each(function(){$(this).find("input").prop("checked",!0)})),$(this).trigger("checkall"),t.stopPropagation()}),!0}};return t}function getSource(){var self=this,source={datatype:"json",datafields:this.dataFields,id:"WID",url:this.dataPath},dataAdapter=new $.jqx.dataAdapter(source,{formatData:function(data){var pageSize=data.pagesize,pageNumber=data.pagenum+1,querySetting=[];if(data.querySetting&&data.querySetting.length>0){var q=eval(data.querySetting);q.length>0&&(querySetting=querySetting.concat(q))}return querySetting&&querySetting.push(eval(self.settings.filter.querySetting)),data.querySetting=JSON.stringify(querySetting),data.pageSize=pageSize,data.pageNumber=pageNumber,delete data.pagesize,delete data.pagenum,delete data.filterslength,data},downloadComplete:function(e,t,a){var i=self.settings.action;try{return source.totalRecords=e.datas[i].totalSize,e.recordsTotal=e.datas[i].totalSize,
e.data=e.datas[i].rows,delete e.datas,delete e.code,e}catch(n){source.totalRecords=e.recordsTotal}}});return dataAdapter}function getModels(){var e=WIS_EMAP_SERV.getModel(this.settings.pagePath,this.settings.action,"grid");return e}function getDataPath(){var e=this.settings.pagePath,t=this.settings.action,a=e.replace(".do","/"+t+".do"),a="http://res.wisedu.com/fe_components/mock/table.json";return WIS_EMAP_SERV.getAbsPath(a)}function getDataFields(e){for(var t=[],a=0;a<e.length;a++)e[a].url&&t.push({name:e[a].name+"_DISPLAY",type:"string"}),t.push({name:e[a].name,type:"string"});return t}var Plugin;Plugin=function(){function e(e,t){this.settings=$.extend({},$.fn.emapEditableTable.defaults,t),this.$element=$(e),init.call(this,this.settings,this.$element)}return e}(),Plugin.prototype={},$.fn.emapEditableTable=function(e,t){var a;return(a=this.data("emapEditableTable"))?e===!0?a:("string"===$.type(e)&&a[e](t),this):this.each(function(){return $(this).data("emapEditableTable",new Plugin(this,e))})},$.fn.emapEditableTable.defaults={pagePath:"",action:"",editableFields:[],checkbox:!0,pageable:!0,filter:"",editable:!0,width:"100%"}}(jQuery),function(){var e,t;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapEditor.defaults,a),this.$element=$(e),t(this.$element,this.options)}return e.prototype.isEmpty=function(){return this.$element.summernote("isEmpty")},e.prototype.clear=function(){return this.$element.summernote("reset")},e.prototype.disable=function(){return this.$element.summernote("disable")},e.prototype.enable=function(){return this.$element.summernote("enable")},e.prototype.getValue=function(){return this.$element.summernote("code")},e.prototype.setValue=function(e){return this.$element.summernote("code",e)},e.prototype.destroy=function(){return this.$element.summernote("reset"),this.$element.summernote("destroy")},e}(),t=function(e,t){if(!t.contextPath&&WIS_EMAP_SERV&&(t.contextPath=WIS_EMAP_SERV.getContextPath()),t.$element=$(e),!$.fn.summernote)return void(console&&console.warn("依赖插件summernote未引入!"));var a=function(e){var a=$.summernote.ui,i=a.button({contents:'<i class="iconfont icon-attachfile" style="line-height: 12px;font-size: 14px;" />',tooltip:"uploadFile",click:function(){var a=e.options.$element,i=e.options.uploadDiv;e.options.uploadFlag="file",$("input[type=file]",i).fileupload("option",{done:function(e,n){if(n.result.success){var o=i.emapUploadCore("saveTempFile");if(o){var l;l=$('<a href="'+(t.fullFilePath?location.origin:"")+t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+o+'.do" >'+n.result.name+"</a>")[0],a.summernote("insertNode",l),i.emapUploadCore("reload")}}}}),$("input[type=file]",e.options.uploadDiv).trigger("click")}});return i.render()};$(e).after('<div role="emap-editor-upload" style="display: none;"></div>'),t.uploadDiv=$(e).next('[role="emap-editor-upload"]'),t.uploadDiv.emapUploadCore({contextPath:t.contextPath});var i=$(".bh-txt-input__foot",$(e).parent());i.length&&i.hide();var n=$(e).closest(".bh-txt-input");n.length&&n.css("border","none"),$(e).summernote($.extend({lang:"zh-CN",buttons:{uploadFile:a}},t)),$(e).summernote("fontName","Microsoft YaHei")},$.fn.emapEditor=function(t,a){var i;return i=this.data("emapeditor"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return $(this).data("emapeditor",new e(this,t))})},$.fn.emapEditor.defaults={height:200,disableDragAndDrop:!0,fullFilePath:!1,popover:{air:[["color",["color"]],["font",["bold","underline","clear"]]]},toolbar:[["style",["style"]],["font",["bold","underline","italic","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture","uploadFile","hr"]],["view",["codeview"]]],fontNames:["SimHei","SimSun","KaiTi","Microsoft YaHei","Arial","Arial Black","Helvetica","Comic Sans MS","Courier New"],callbacks:{onImageUpload:function(e){var t=$(this),a=$(this).data("emapeditor").options,i=a.uploadDiv;a.uploadFlag="image",$("input[type=file]",i).fileupload("option",{done:null}),$("input[type=file]",i).fileupload("send",{files:e}).success(function(e,n,o){if(e.success){var l=i.emapUploadCore("saveTempFile");if(l){var r;"image"==a.uploadFlag?r=$('<img src="'+(a.fullFilePath?location.origin:"")+a.contextPath+"/sys/emapcomponent/file/getFileByToken/"+l+'.do" >')[0]:"file"==a.uploadFlag&&(r=$('<a href="'+(a.fullFilePath?location.origin:"")+a.contextPath+"/sys/emapcomponent/file/getFileByToken/"+l+'.do" ></a>')[0]),t.summernote("insertNode",r),i.emapUploadCore("reload")}}}).error(function(e,t,a){console&&console.log("图片上传失败")})}}}}.call(this),function(){var e,t;e=function(){function e(e,a){a.mode&&(a.model=a.mode),this.options=$.extend({},$.fn.emapFileDownload.defaults,a),this.$element=$(e),t(this.$element,this.options)}return e}(),t=function(e,t){function a(e,t,a){$.ajax({type:"post",url:a.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t+".do",dataType:"json",success:function(t){t.success&&i(e,t.items,a)}})}function i(e,t,a){var i="";if(!t||0==t.length){if(a.batchTokens){if(""!=$.trim($(e).html()))return;i+=" 无"}else i+=" 无";return void $(e).html(i).trigger("bh.file.download.done",[t])}"file"==a.model?(" 无"==$(e).html()&&$(e).html(""),i+=n(t),$(e).append(i)):"image"==a.model&&(i+=o(t,a),$(e).css("overflow","hidden").append(i)),$(e).trigger("bh.file.download.done",[t]),a.batchDownload&&$(e).append('<p style="clear: both;"><a class="bh-file-batch-download" href="javascript:void(0)">批量下载</a></p>')}function n(e){var t="";return $(e).each(function(){t+='<div class="bh-pull-left bh-file-upload-file" data-fileId="'+this.id+'" data-fileurl="'+this.fileUrl+'"><div class="bh-file-upload-file-icon bh-pull-left"><i class="iconfont '+WIS_EMAP_SERV._getIconImgClass(this.name)+'"></i></div><div class="bh-file-upload-file-info bh-pull-left"><span class="bh-file-upload-filename"  title="'+this.name+'" style="cursor: pointer;">'+this.name+'</span><p><a class="bh-file-upload-download" href="'+this.fileUrl+'">下载</a></p></div></div>'}),t}function o(e,t){var a=parseInt(t.width)-6,i=parseInt(t.height)-6,n="";return $(e).each(function(){n+='<div data-fileid="'+this.id+'" data-name="'+this.name+'" class="bh-file-img-block success" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-table" style="width: '+a+"px;height: "+i+'px;"><span style="width: '+a+"px;height: "+i+'px;"><img style="max-width: '+a+"px;max-height: "+i+'px;" src="'+this.fileUrl+'" alt="'+this.name+'" /></span></div></div>'}),n}return $(e).addClass("bh-clearfix").css("overflow","visible"),void 0===t.token||null===t.token?void $(e).append(" 无"):(t.token instanceof Array?(t.batchTokens=!0,t.token.map(function(i){a(e,i,t)})):(t.batchTokens=!1,a(e,t.token,t)),$(e).on("click",".bh-file-upload-filename, .bh-file-upload-file-icon",function(){var a=$(this).closest(".bh-file-upload-file"),i=$(".bh-file-upload-filename",a).attr("title"),n=$(".bh-file-upload-download",a).attr("href");if(new RegExp(/\.jpg|\.png|\.jpeg/g).test(i.toLowerCase())){if(!$.bhGallery)return void(console&&console.warn("图片轮播插件Gallery未引入"));var o=[],l=[],r=0;$(e).find(".bh-file-upload-file").each(function(){var e=$(".bh-file-upload-filename",$(this)).attr("title");if(new RegExp(/\.jpg|\.png|\.jpeg/g).test(e.toLowerCase())){var t=$(".bh-file-upload-download",$(this)).attr("href");o.push(t)}}),$(o).each(function(e){n==this&&(r=e),l.push({image:this})}),$.bhGallery({dataSource:l,show:r})}else{if(/\.pdf$/g.test(i.toLowerCase()))return a.trigger("bh.file.click.pdf",[i,n]),void(t.canPreviewPDF&&$.emapPDFViewer({url:n}));location.href=$(".bh-file-upload-download",a).attr("href")}}),$(e).on("click",".bh-file-img-table img",function(){if(!$.bhGallery)return void(console&&console.warn("图片轮播插件Gallery未引入"));var t=$(this).attr("src"),a=$(e).find(".bh-file-img-table img"),i=[],n=0;a.length>0&&(a.each(function(e){return new RegExp(/\.jpg|\.png|\.jpeg/g).test($(this).attr("alt").toLowerCase())?(t==$(this).attr("src")&&(n=e),void i.push({image:$(this).attr("src")})):!0}),$.bhGallery({dataSource:i,show:n}))}),void $(e).on("click",".bh-file-batch-download",function(){window.location.href=t.contextPath+"/sys/emapcomponent/file/getFileBatchByToken/"+t.token+".do"}))},$.fn.emapFileDownload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return $(this).data("emapfiledownload",new e(this,t))})},$.fn.emapFileDownload.defaults={model:"file",canPreviewPDF:!0,batchDownload:!1,width:200,height:150}}.call(this),function(){var e,t,a,i,n="FileReader"in window;a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAMAAABGS8AGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAMAUExURQAAACagliejmSWnmyeimCqkmSilnECmiCmlmSikmiilmyinnCeimCekmieilyimmiagliiimCimmyikmiikmiikmieglielnCimnCilmyehlyekmSijmSalnCimmyikmyilmiaglvanL9ymUCeglt2pWuejQOqXMvaRItytXuOoTO+lO96pVnmmcPaVKPOcK+6pOd6hSeaeSO6oPYmqd2qgdu6rQd+rTtyeRuaZOueVMeesRieglimmnEgrG/aOH/qiHOrAp/LXvOvIrezBqPbZviWnnj8hEkkmFkgrHP2hFujLseK5oCapnx6mov+NGEgoGCWlm/qjHCaupUcqGkoiEf+hGR+kmyqmnPHXvRuhnfeOHv+iEiesoh6flUksHPbKtPmeHUsgD/HUue/Fq+nIrUBIOiehlym2SUYvIPTZvvrfw0ojEzCEeOnAp//bv/rDqTweD0YoGPmNG/LIr/WOH/yNGzB/cxqimhielfLWu/vMryKgmOq/puK/pyajmkynmS+hlem9oiqUif359P///+/KsTO0RkU2JySflfTCqCaxqC2Og0M7LKiDbVCwo/zZvkElFTCJfT2nmNK8o/uiGle0Sz21SDR0aCqbkZx9aGWqm49xXTGonb65pDN5bezEq+vWuyOmnv/ny3q1pfWlJs2VM/qNHeqkIdbDlimjmreaTWugdf+QGzpfUnZXRFehg2BCMPORJeTSuGxOPPXj0bepWfv18HqyoImzoJ26cEm0Qx22RsOnKManSlU3JjtaTNLQt6rFsJ+0ocLMtd61nLqXgOzPtVo8K8Kiij+ija6aUzxWSF+pit3Dp+rEqOmSJ/mOHYmnOGu1XnutOzdqXf+lIdGnP2ipgpepaummMFCqkZbBrveUJ4Cda7ONd2a2psGbhFmypGK1pfTax//9/NuUKUSqdpyiOuPDm4S3YGquP72bLLO/gn+baf6mKYVqVWxhUfLo2nNuXIyuRqaqL+bHoV6sX/qeHUo8LW+qis3LsIiob0QlFfieIdrSudHUgI4AAAA8dFJOUwDtjRAiCvsDGoPPFpni2DzeT+t5a6PGuvavuFYwyEVgc/zoIfczmdfsVYN3FPzn7NtfCsN1f+K4yIiAzsFKH5gAAAhNSURBVFjDpdn3XxPZGgfgkAAhVGmiItLsuvX2ezOTEDGF3RQkCSXEZCkhkICGEhAXkKIgAhqpIiqKiuva69pXd63rqqvu3bu93O3l9vbjnZn0nDMzwf3+AU/ez3vec2ZyhsGgS1BYVDInPiE0IiYmICAgInIWMyUxkMVm/KywQ6JSZkYEI3ikWq1Q2MIlEjCdEx0Y9MRs2BxmqB1FEGGOtH1rZU+ZtMxOc8umhSeGPBEbGJcwA3FGmtNzt7e8vPfuVmfReKZzZk+d5YQi7ki1u8qLVGKxuah8JLvMLXMjmVOjg1IiEc9oK1GVUoKiEqVKUu8lc6dxptCQOUnBXq70oKEIY/FIigzbWrheiUz2d82YMxDvaLeiCtQRhbIy2xvmpsYH+uNGJSG+0Y6oUFdUI0KubyKjaeeanRwDuptGnJ3AezGSkw3Ic2NppjqIE+zLSjcdrDSI3bDYUL9R2gLQ4WFULiseKDdHW29AxahHxKihPhtsxyyKRofNBN1tr0tUXi4mm9G77VJAnk4qsyDu1l5f1k73VgrL/JWDwD5oK7vMShQWc7nPRiG6Ae0zmwNxy8UoScTl9WCfw2GzEZcH9KGni9TF5K4eUI6F7AtgfrUHDWYJOSwxGzYCUzc3GhgIcL9tetesQCmiEL8rBdo8zXcBmeBAtFM1grQZ8T7n2Qxgw+UcIRkId8nmI+DMpXqddUFJkJ3Ra4Z71a7fM/e2Qw4kz/M5Nhjs8C4FvBNKnc4pixW7wA3IZbrdkEjAlUqPqOAFi8aO2py/oXq9BTyOprmfVpw8cG+UGYpgs6azHG/71AlLVIZt4BHKDXcVHIqAcHsXbIh1IuUN/fXjNp1jlGFz4S45DuwwdvrAdrNOZOurLakdtbj2dSUE5nIceyMBgcCVqOfu0OkkqA6ttqCYm1Fy/ZbIXrJCUQ+Dp4eQzDABK1ywstomIoKe+hxzMzJr+0TVjs0HhVMTiVONiVDCSpvtytGx0bG/jY3eaKrNzMBS0nbUoqSo2H7KwZYOf+Lbe6xTiq6M3hOYTKblpsYmgsVSe/uKhaLH9hNjTjAUbndsPMvxgQlThaBRIKh44UUnnKn/VCnCt15XTzYM5mKHHDsFgcJc+xyLbg1M4KrAC24a14/aRDqSOcbngs0ImgmFpdojRVgbq219ExX5Al84o6mktk9nge88Yi5YjJAIKIydFSJLNWq7dW+iWADCuPz5KYsIdlYQb+aBjKhgOKxt/2ffcZvoVKOpEQZnVI3XXu/7ezu8E1xuIiMZ7iINf949cVtnOSow5UNhbAVLVjdvX0MCpzA4cDd3x5urKkw3lFjFZDCW1TtbV8JhJiOeBP5i95Z8gen22E0KuKq7eR0JPIuRQAJ/tmU5hpnynUsHrTizezsJHMkIpYQFywU0MEmTIxgk05a7GW+FV6bUigBGDPni0cPki0cKIw2f5a+qoIYzu6tIx40czs7de3U3JVzVPLB95cYpw5i8Y/PV5eRw987+VlIXgyMQ0mQ3fOTZZ58t3X1uzUoulxwOJYfzsjfnV+TD4arM5nUbyV1s3BIQimRfc5Xc2Cg42dzU1OQaiDeoXGyDhFPB7mmuwHKyeXx8nHaCnVuaQ1lx7kf2mSs+3dHRcRZLR34bMWmrz1G62CGUjFCWjO0TAv6yYz2RszfbqI81R+JID3rnPtl8cpWj5K/Wr//qbHEb3uXVA+vWULrY0zQsAqGWvzhJdKO44vQ/Tn853kb0gdbFHk0kD1PPmq+uwvdJY/ELL7bZ3Z10Lv4wJXn8u4cZaei/Rixgxc1mYo4z3+inc/HHPyNqBk3JSG7etS1En50DvJLOxV9YGCFJdDDSsHdtsRO+v/Y12nodf8o4tHDu3rWlN4tx+H5p6drX6AsOZ5O+xgJwaemyDePjpX7BqdFktwk+y1dAwI740QrHizf0r4Kb3SMT5p3zhM+1thS8TAnHUvy5cbJCmaz/m0f3Nrjh2oH/fnOngIp2/5+ODSZrgkz29pl/DQ/9xwPe8MqFC9++dayggOIAcv31JykZZw8UXurs/EnvhvXnjcNfyx9gdANdwfAuY8398Mw+tVp9YMj4qMRVsv67IeMPGqtVfuKtO9B+pHI8/6RDniOyHe/vK1QP8vnqfxs7z+s3LMPZZfqS743DP8rreJpJ+YNPDkL6Ecryul8BZlnWf7kwi49HzX+Myff1RL77vtP40Krh4bEefrW1gO6OhQO47xUO8u1RH/jBaHz00ytYzg9dND6um+TZ844clMN979y8Twyh7H1HvXb5YedF4/DQ0PDFi8Pf8uQOl1dnlX9SQHFbQWS214G/J+9yId8d9eClxxc6jcbOCw/3y608V+rkr5Z5LWDAHPAaK9GzzbIPP/CE+Wo1/8ClSz/ufzApn6zzhPe3vuz9qINc6MV6wn/6Yxaf702r1Yfl1kmeV6wfH/PsBRN6jcz2eMWQPeVaOldW/E+j4flEc/iQBzyTRXu5KT1TyAfgl3hANPK/5LpfUkg/AwQ5axYil/2D8dWjdzHZccUgzHvPX3i/cyziKa+82bHEbOxZ94HfMNcOM1k0t/+J+DzL3v5rlp/w13dwOCCO/nPZ7ARi2gb9gnk1Hx/DTs/QKH8+hLA4MbJDar5/MD5vc8P9/SoUlQAZYzjMkx9Kip7CB8Jfpq3IyqKHNTW8p3/FmtL3sXnzn/WlARhjF8yfN+UvevMW/2JflqftDdfU1JxYsHjqLJ70RfOfxe3BQR9Yo6mxnlgw/7n0J/5q+nz6osV/SNu3YrAQ0+1wTc07dScWLvjdovTnf+aH3qVLFy1Z8ptfp6WlPbNw4cKnn/nt75c8l76Udj/8H1/k4P/j+w/zAAAAAElFTkSuQmCC",e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapFilePhoto.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e}(),t=function(e,t){t.token&&""!=t.token&&null!=t.token?(t.defaultPhoto=t.contextPath+"/sys/emapcomponent/file/getFileByToken/"+t.token+".do?date="+(new Date).getTime(),t.scope=t.token.substring(0,t.token.length-1),t.newToken=!1):(t.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),t.token=t.scope+1,t.newToken=!0),t.uploadUrl=t.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+t.scope+"/"+t.token+".do",$(e).addClass("bh-file-photo").append('<div class="bh-file-photo-block"></div><p class="bh-file-photo-info"><span class="icon icon-spinner icon-pulse bh-file-photo-loading"></span><span class="bh-file-photo-error"></span><span class="bh-file-photo-success">上传成功</span></p><a class="bh-file-upload" href="javascript:void(0)"><input name="bhFile" type="file">上传</a>'),i(t.defaultPhoto?t.defaultPhoto:a,function(t){var a=t.width,i=t.height;a>i?$(t).css({position:"absolute",height:"88px",top:0,left:"50%","margin-left":"-"+a/2/i*88+"px"}):$(t).css({position:"absolute",width:"88px",left:0,top:"50%","margin-top":"-"+i/2/a*88+"px"}),$(e).find(".bh-file-photo-block").html(t)}),$(e).find("input[type=file][name=bhFile]").fileupload({url:t.uploadUrl,autoUpload:!0,dataType:"json",formData:{storeId:"image"},submit:function(a,i){var o=i.files[0];return $(e).addClass("loading"),t.type&&t.type.length>0&&!new RegExp(t.type.join("|").toUpperCase()).test(o.name.toUpperCase())?($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("文件类型不正确"),!1):n&&t.size&&o.size/1024>t.size?($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("文件大小超出限制"),!1):void(t.submit&&t.submit(a,i))},done:function(a,n){n.result.success?($(e).removeClass("loading").addClass("success"),t.tempUrl=n.result.tempFileUrl,t.fileUrl=n.result.fileUrl,i(n.result.tempFileUrl,function(i){var o=i.width,l=i.height;o>l?$(i).css({position:"absolute",height:"88px",top:0,left:"50%","margin-left":"-"+o/2/l*88+"px"}):$(i).css({position:"absolute",width:"88px",left:0,top:"50%","margin-top":"-"+l/2/o*88+"px"}),$(e).find(".bh-file-photo-block").html(i),t.done&&t.done(a,n)})):($(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html(n.result.error?n.result.error:"上传失败"),t.fail&&t.fail(a,n))},fail:function(a,i){$(e).removeClass("loading").addClass("error").find(".bh-file-photo-error").html("上传失败"),t.fail&&t.fail(a,i)}}),t.attachmentParams={storeId:"image",scope:t.scope,fileToken:t.token}},i=function(e,t){var a=new Image;a.src=e,a.conplete?t(a.width,a.height):a.onload=function(){t(a),a.onload=null}},e.prototype.saveTempFile=function(){var e=!1,t=this;return!this.settings.tempUrl||this.settings.tempUrl.length<1?e:($.ajax({type:"post",url:this.settings.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+this.settings.token+".do",async:!1,dataType:"json",success:function(e){}}),$.ajax({type:"post",async:!1,url:this.settings.contextPath+"/sys/emapcomponent/file/saveAttachment/"+this.settings.scope+"/"+this.settings.token+".do",data:{attachmentParam:JSON.stringify(this.settings.attachmentParams)},dataType:"json",success:function(a){t.settings.tempFileSaved=!0,e=a}}),e)},e.prototype.getFileToken=function(){return!this.settings.newToken||this.settings.tempUrl&&0!=this.settings.tempUrl.length?this.settings.token:null},e.prototype.destroy=function(){this.settings=null,$(this.$element).data("plugin",!1).removeClass("success error loading").empty().attr("class","bh-file-photo")},$.fn.emapFilePhoto=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():this:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapFilePhoto.defaults={storeId:"image",type:["jpg","png","bmp"],size:2048}}.call(this),function(){var e,t,a,i,n="FileReader"in window;e=function(){function e(e,i){this.options=$.extend({},$.fn.emapFileUpload.defaults,i),this.$element=$(e),a(this.$element,this.options),t(this.$element,this.options)}e.prototype.getFileToken=function(){return 0==this.$element.emapFileUpload("getFileNum")?"":this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileUrl")},e.prototype.getFileData=function(){return this.options.fileInput.emapUploadCore("getFileData")},e.prototype.saveTempFile=function(){function e(e){var t=e.fileInput.emapUploadCore("saveTempFile");return $(".bh-file-upload-download",e.loadedCon).each(function(){var t=$(this).attr("href");if(new RegExp("getTempFile").test(t)){var a=$(this).closest(".bh-file-upload-file").data("save",!0),i=a.data("fileid");$(this).attr("href",e.contextPath+"/sys/emapcomponent/file/getAttachmentFile/"+i+".do")}}),t}var t,a=this.options;return t=e(a)},e.prototype.saveUpload=function(){function e(e){var t={},a=e.fileInput.emapUploadCore("saveTempFile");return a===!1?t.success=!1:(t.success=!0,t.token=a,$(".bh-file-upload-download",e.loadedCon).each(function(){var t=$(this).attr("href");if(new RegExp("getTempFile").test(t)){var a=$(this).closest(".bh-file-upload-file").data("save",!0),i=a.data("fileid");$(this).attr("href",e.contextPath+"/sys/emapcomponent/file/getAttachmentFile/"+i+".do")}})),t}var t=$.Deferred(),a=this.options;return $(".bh-file-upload-file:not(.bh-error)",this.options.loadingCon).length>0?BH_UTILS.bhDialogWarning({title:"警告",content:"有文件正在上传中, 操作可能会造成文件丢失, 是否继续?",buttons:[{text:"确认并提交",className:"bh-btn-warning",callback:function(){t.resolve(e(a))}},{text:"取消",className:"bh-btn-default",callback:function(){t.reject()}}]}):t.resolve(e(a)),t},e.prototype.getFileNum=function(){return this.options.loadedCon.getFileNum()},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},a=function(e,t){t.fileName&&1!=t.limit&&delete t.fileName,$(e).css("line-height","28px").append('<a class="bh-file-upload" href="javascript:void(0)"><input style="cursor: pointer;" name="bhFile" type="file" '+(t.multiple?"multiple":"")+' />上传</a><span class="bh-text-caption bh-color-caption bh-mh-8 bh-file-upload-info">('+i(t)+')</span><div class="bh-file-upload-loading-wrap bh-clearfix"></div><div class="bh-file-upload-loaded-wrap bh-clearfix"></div><input type="hidden" class="file-array" value="" />'),t.fileInput=$("input[type=file]",e).parent(),t.loadingCon=$(e).find(".bh-file-upload-loading-wrap").bhFileUploadingList({onDelete:function(e){e.hasClass("bh-error")?e.remove():(e.data("xhr").abort(),e.remove())}}),t.loadedCon=$(e).find(".bh-file-upload-loaded-wrap").bhFileUploadedList({onDelete:function(a){var i=$(a).closest(".bh-file-upload-file");i.data("save")?(t.fileInput.emapUploadCore("deleteArrAdd",i.data("fileid")),i.remove()):t.fileInput.emapUploadCore("deleteTempFile",i.data("fileid")).done(function(e){e.success&&i.remove()}),e.trigger("bh.file.upload.delete",i)},canPreviewPDF:t.canPreviewPDF}),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(a){if(a.success){if(!a.items||0==a.items.length)return;"image"==t.storeId?$(a.items).each(function(){t.loadedCon.addImage(this.name,"",this.id,this.fileUrl,function(e){e.data("save",!0)})}):$(a.items).each(function(){t.loadedCon.add(this.name,"",this.id,this.fileUrl,function(e){e.data("save",!0)})}),e.trigger("bh.file.upload.done",a)}}}),t.fileInput.emapUploadCore($.extend({},t,{add:function(e,a){var i=a.files,n=(new Date).getTime();$(i).each(function(e){a.files[e].bhId=n+e,t.loadingCon.add(this.name,n+e)}),t.add&&t.add(e,a)},submit:function(e,a){var i=a.files[0];if(t.limit){var o=t.loadingCon.getFileNum()+t.loadedCon.getFileNum();if(o>t.limit)return t.loadingCon.error("文件数量超出限制",i.bhId),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter(),!1}return t.type&&t.type.length>0&&!new RegExp((t.type.join("|")+"$").toUpperCase()).test(i.name.toUpperCase())?(t.loadingCon.error("文件类型不正确",i.bhId),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter(),!1):n&&t.size&&i.size/1024>t.size?(t.loadingCon.error("文件大小超出限制",i.bhId),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter(),!1):(t.loadingCon._findFile(i.bhId).data("xhr",a),void(t.submit&&t.submit(e,a)))},done:function(e,a){var i=a.files[0];t.loadingCon.remove(i.bhId),"image"==t.storeId?t.loadedCon.addImage(a.result.name,i.bhId,a.result.id,a.result.tempFileUrl,function(e){e.data("deleteurl",a.result.deleteUrl)}):t.loadedCon.add(a.result.name,i.bhId,a.result.id,a.result.tempFileUrl,function(e){e.data("deleteurl",a.result.deleteUrl)}),t.done&&t.done(e,a),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter()},fail:function(e,a){var i=a.files[0],n="上传失败";a.result&&a.result.error&&(n=a.result.error),t.loadingCon.error(n,i.bhId),t.fail&&t.fail(e,a),WIS_EMAP_SERV&&WIS_EMAP_SERV._resetPageFooter()}}))},i=function(e){var t="请上传附件";return e.size&&(t+=",文件最大为"+(e.size<1024?e.size+"K":e.size/1024+"M")),e.type&&e.type.length>0&&(t+=",格式限制为"+e.type.join(",").toUpperCase()),t},t=function(e,t){},$.fn.emapFileUpload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapFileUpload.defaults={multiple:!1,dataType:"json",storeId:"file",type:[],size:0,canPreviewPDF:!0}}()}.call(this),$.fn.bhFileUploadingList=function(e){return $(this).on("click","a.bh-file-upload-delete",function(){e.onDelete&&e.onDelete($(this).closest(".bh-file-upload-file"))}),this.add=function(e,t,a){$(this).append('<div class="bh-pull-left bh-file-upload-file" data-bhid="'+t+'" data-fileid="'+(a?a:0)+'"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span><span class="bh-file-upload-error-msg"></span><i class="icon icon-spinner icon-pulse bh-file-uploading-icon"><img style="vertical-align: top;width: 100%;" src="data:image/gif;base64,R0lGODlhIAAgAPYAAP///4qEhPz8/PHw8Ono6Orp6fb29v39/fr6+t7c3Lu3t6mkpK2pqcjFxevq6vn5+eTj46yoqIuFhZeSkvDv7/T09NLPz9XT0/j4+MnGxpWQkKKdnd7d3e/u7u3s7MG+vqWgoJyXl56ZmdbU1L+8vJCKipmUlNfV1bGtrfX19cfExJiTk4+JidjW1paRkeXk5JSOjo6IiJuWlsbDw+Lh4aahoZKMjL67u8zKysvJyZSPj8nHx93b25+bm9/e3s3Ly6ijo+zr69TS0uHg4Obl5efl5bOvr5qVlcrIyMPAwL66usTBwY2Hh+Df39nX18K/v87MzLm1tbq2ttza2u7t7bWystvZ2drY2MC9vejm5sXCwrKurqCcnOPi4vLx8fv7+/f39/Py8p2YmLazs7SxsfPz8725uQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4yNjQeGCCkCjoYpBDQFKYMCHDMElYQeKgw1DA1BkAg5QAmhghUfKxK0Jh8VBwcOPBWFFR0PiQIJILTGGwmQALmEKUtGTgiIDxYhxrUW0ocEGyUKBogIFyLXEiEnlIcVz9GIBwQMLNcMRMrqHsGJBiMLGjYuC4RgeFXoAAYPLVSQ2OEDHMFBCCBkIJGBwwAD6Rwx45QggoYSAF+8cmDBAoVBAxSUu5GvUYUnE0zscEhgQbkFvRxRMEJLQc4CDMoxyNkIA5QaC0YMBGCgwQRjLnBkbGSACBGHyxwo2GBiA4mTDwtS4HAigQOMYQ89eGEhBy97iZg2uoOAQsYEED82xSVigcZSdSRgGAMyJC6HGi42ZEPUAUUMYyFGKEOAQRtTEiVoRaGCqIKCzLRA+AAgoAiSJCdyYlABg0kJKUQLdtSgo8eMAbqMwCjRwwK4d0ZqGJkytdCDBDM+WOhwQJwMY0Y8CDrgoUkBy4gEVKiQD4GQI7RKRCcENxQB3bwt/E1LmsYMJSbZFxJggLujQAAh+QQJCgAAACwAAAAAIAAgAAAH/4AAgoOEgwcVVFQpB4WNjo4PEEkoKEsvD4+ZjQI0RhoSEhpGEAKapgAVSxOgoBNJFaeFBg4EFQJBRkysoEZBsYIHDg0oDFhNREa7EiW9vwADJKsSOihOSdKgLq+CFRWMjwI8G7sTGTwoMKA2W0OlqUkDmQhCIcokFUVaDAwzBAjcUaI4yCTAyjhWK3JgQpAiBYJvAG4FKZWJgpJPEmAwgOBM3osnDCIoSIChYyMMBYYQCUKg1j+ThDA4MbIAhQVbMAsdGBKhBKgNJyDGQgDBAgGKD35gK0ECk7MORkIogAXgAY6lTTt6iCKDRDwAB5r0lMBiQwuhpxB0MUoRgAEnVZxq3syJFgDKIQQM5NQk4IAADA/q7nXLAQkUf6ceOOR7ZcGKI1GyCB6UwgKJESUfVVCQTsIRKE4dHbDSo0SNJhWjsJqAJHPEtmBHmJDAZUomDDhEMIGxIEGpAwWECCnQtoOSCEu+asYRRcoVvQA8SDGxIgoVQhVqmTqAgQJOsDx6gOrBY7LJISBAgRhivmOFHCFzUB2MvUiR+fQHBwIAIfkECQoAAAAsAAAAACAAIAAAB/+AAIKDhIUAB4aJiokHFUVdQQ+Lk4YHDksLNUYjFZSeABRPKxISJUAtkgcPGAieDwMFAwgCPkBMpBI6HwMYRBY4Jw4CixhOClsKPBUtXLilUQQnWyImGwovX4m0CyUlOgwJTRHOLk8XESW4LgpUiQYNOrgmOUEqR6QsEU4ZJs4SCxwQFUqRBAYuDRkMVLBghMGHLhWWxHO2ocWwQghOcIkhgQkIJ4gOKMQA4AGUe7hYAPFxsVAFFQt6RMgxQFEXFDbkfeigCEGFJi2GVBBoCMMVIz1CbLhBpJUhBBhCEu1ZwIkQHhSmCsJAQIiQAi09IZilrcmWEDKMQPhUSFW2QQa1VGggpUGLU7YAPEBxYmBQBRLpSim4y5YGil2DEFjg0m2DhbCfKnBoSqgCDiNGLNTEO+lACg8OOnEeTdoTBgNaSw86QADJEh+SKKUg4CU1oQ5RNMAACLnQgxw1lFCYBGEDKRNQYitKoQBGhCKTgmyBUeLj3QcUhg4ScEUKFNGKHjiJknkzAAwjoiQhQNQnSUoIKATpO8jBuCM53qsmVIBBiSM46LefIAZcoB57AxaCQXaEJUhaIAAh+QQJCgAAACwAAAAAIAAgAAAH/4AAgoOEhQcCB4WKi4yCBgRTTRSJjZWFDxdbG0BLBJSWlQdEDCUSEmIZFaCKCGAIgggtYqYSJVEOAhVFEEEPlgMtGRdBAghOIrS2BQQqDAtRLSmNFSobGj1JHQceYzC1GxYvWEemJRFTr4tFC7Q1CQAITQoLDBYePDW0EhpJqosvNZiY2mBF0IEKHSg8ENCihz5bHhhVUGCihIkoBBg1WVDKlIkZ/hQdeKHCyJImvhYN0NIjhgQYKDikW3TQQYWZigQ4yGGEgQIhQVLgXLUIQ5AuV3AsyXBlwCcwHQYMtXQAgoIeLkwAQeJvAI4tRloYIAqgAgkX+jZcACBgCoiXDLUyEiWQTx8MBfAshBjogywBhw/JADhAA8WEIwqCkA0SgYU+HUkEpeDRAAeRqY0e5GhpCgaDIYMQpDDwiaiHHQt6bIhyZSxZRge7OJlCAMNrUAdKK6pQIIxuRohAdViyQIEnS0GQJMA86MAVLqcspGyUYIEK17B9RNAB5MpMASlsEwJGRIClFC1ICAkp4EUDCyEFBQeFoMKDTwZUHInQ5fftQQ9YUANG/1VCAQcviFcgcP4tWGAgACH5BAkKAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiQAYQURBD4qRhQ88UREKPBiSkgcFRjASMFFFB4OlmwgPpwc+GxKvQDwCAAgdRUGaiQcOFxZEkAcvESUSJQxdAgYJCgxRIxWJHVg9MlEQpRU/QGILFhUIQ1s6oQtWkIdDNa89FucVHBZN0Bg/Mq8SKzPQhgdEwxIbTpwTdAqAgRxH7rl4MgBRCgsoIjToULAQAh4LSjApAUJILn4ViNAYUNFQBQsMNkTYQVHRgZKHBFR4YYUHgQEYYG4CmWDHEgsEEBR6uXMQghYoTGgQoYDAqQdELFjZt7ODEWKvTGRIAWCXAjEgLgyUBKHHvWJGOnSFsECCCxVcyHcScXWvRBQqgjwkqcFgitCdA6KMeyUGSS4BHXy8MFCUVoIqXEKASFKg4AEBOhEdMBAEQgsoP1oEmdWYEAICOaKgUGDBQc7ShYJgEfEKxgIhcQ8d6PDCS2YEFjYwuSeKAGlDHT4sQEK1kAEtg++BsHK8EIEtExSoPZRiSfRXNaZUJ1Thwo1MhAS8Bs7lrA4jpBI9+Jb+BVBBQZ70sFFCQwTcpT0AkROlCFAADlEYocAJze0kgH0OmFKBAwVQ8FFpAqgC24YcdhgIACH5BAkKAAAALAAAAAAgACAAAAf/gACCg4SFhoeIiYIHD1+Kj4cYL0JTFAKQmAddRj1AOQOYkA9QJhIlW0QHgweqkAeXgw8WMqZGBKoHFC9EFa2IBl1XQbACRWYgDBYVAAcESgsRM0G+hQIJWyBJHoMIDlMQvQApSLQSG0IYiBgNExILPtSFFAolEhIrWsuHCC0RPQq3ElVoUIoFF2UCr1jo8kARAghSNtTAQgDWoQMIMFhM9IDAFR4OGobKxOrBg40jESEIcuXECwOEDmCogCAlAAEQonDpkQwmswpCZjQRGWrAk3amUEAQhGAIChkfQI0kgKKevR4nBhFQEAGKvlBBolhlAoIHtwJdpI5MIQSIDhgiyT50KBTP1QMPFqJE2VGkps1BAgb4GNGiCwECFVCmPBAkw4IeIG4wfFS3UAoLG+xJCJFkrkAeBPwCAFNg14AvBaLA0CwhwpDKN4cwyFCGGYUfDLiAUJCgSVXWC5rAZoxkCoYDFTBrnmDkwo0VmmFEIaDoQIqGOH9rlpGhRZUjOiZEuJAilAAeNVhLgIHFwZAdCpJM+QpJQJMITFjrmEGzQocK6aQUhBIuaBYDCC0Q9RcADzRhhAklwACCCp4tGMsLGUShxAUdKFZIIAAh+QQJCgAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4wCFR0pB4yTggUZChYVlIwIFhsaKBCSm4mdIiULNKMAGBQUD4wYYbCDBElGUJqCFRZSCk4pigZXWjwYgwgUBRUCggddDDAuRkTNiARGRwpBig8jIRISNTwIiQMqEUgDis8MLiZRRauGAg4cQdaJBk4kT8aLBwTMS/SAwgBapBIq7DaAgoGBACBOqiAkSpQfHlY9cABB16YHToDAkLABioFBA3ZEaSIxUYUMLsKViEJlUIoTOwi0RGTgBzgJLpR4ZFWhHKkDL6L0EIGixTFDAXcaegDhRw4eQwUJoOBjxBUCJxcJEIAgRQWEg+qpWMBlQ5QrYdEPpSiSoGPLCkh6lAinwQiNfIQqjDBSg0GODhAP0EARrnGIHBUOgPFSFAACDhFGlthgIVghBFNqxGgsQQMWBzRUGMEUpAKUnxJ0KOkAdQgD0hJWLJlixESJElxUELHQo/GED7QNeXhigonMBRYyyCC9oAUHIy5KwAAyIi4hBEOicJkQIgKUISR0kBZhYcAUKSiMWKCQCMPwGTmmuJqxgvSGFghgQEAXBETGDgYVpFDOAzwssFduUhAwSEALpWDBFhvUoMAQaC0kiH1XcNCBUYoEAgAh+QQJCgAAACwAAAAAIAAgAAAH/4AAgoOEhYaHiImKi4wAB18HjZIADwQ+HZGTi0FPKFAVmotEKCEfA4QPBg+Nj5mCFRZPPBiDFS0NLaCKAh0+A64CKRS0ggJDDCYMCQiKBhZbLcSICE5cEhsXq4kPTTtEzIkHBQoRJASuiBgV2ooIlgTshQcCCAIH6Lv26Q4+Vl0UAkIdejAESwQgKHZ4wLfoAAYMAQEIIBJlhQQJJUTk0NXInYUcPkClsNDjoskIRBgiCoJFxJEtHBAM+ODC5EUuHFQaOjBkwUUxPwxUaGDCpgQQTSI2JGBERwkQQh48uBKhhEkYChaySjEiCooMDu51QFJjAgwZDKZIa1SBSJcO4OB4nVCBRYUFHwUqKGV0z9CDCgVOfNgSBQeBvYUEVOigNxGCF1GOlIDBRUuHaUR2KMjwDVEKHEdsApkCjtABB1gkH1FQQGWFJzpsirBQIUUQAlRWCfDh8+ICHqUJVchQ9CKTDSOCXJCC4kMTDAiGVMW4wEfwQQg4MNDBRMLqJiMWwJBgIsqLBx1UbDCxYYnWQ7aiRGBAggMBmia5WDCAoICFJRYQcJ1pFRDAQRMO2KZEbBf1AIUBACBQAQWNLSLAhZHA0kN3JUTAQzwCRVjAEkBwwYAFFIRoCC9XXBCSToQEAgA7AAAAAAAAAAAA"></i><a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></div>')},this._findFile=function(e,t){var a=t?t:e,i=t?"fileid":"bhid";return $(this).find(".bh-file-upload-file[data-"+i+"="+a+"]")},this.error=function(e,t,a){var i=this._findFile(t,a);i.length>0&&i.addClass("bh-error").find(".bh-file-upload-error-msg").text(e)},this.remove=function(e,t){var a=this._findFile(e,t);a.length>0&&a.remove()},this.getFileNum=function(){return $(this).find(".bh-file-upload-file:not(.bh-error)").length},this},$.fn.bhFileUploadedList=function(e){return $(this).on("click","a.bh-file-upload-delete",function(){e.onDelete&&e.onDelete($(this).closest(".bh-file-upload-file"))}),$(this).on("click","a.bh-file-upload-name-a, .bh-file-upload-file-icon",function(){var t=$(this).closest(".bh-file-upload-file"),a=$(".bh-file-upload-filename",t).attr("title"),i=$(".bh-file-upload-download",t).attr("href");if(new RegExp(/\.jpg|\.png|\.jpeg/g).test(a.toLowerCase())){if(!$.bhGallery)return void(console&&console.warn("图片轮播插件Gallery未引入"));var n=[],o=[],l=0;$(this).closest(".bh-file-upload-loaded-wrap").find(".bh-file-upload-file").each(function(){var e=$(".bh-file-upload-filename",$(this)).attr("title");if(new RegExp(/\.jpg|\.png|\.jpeg/g).test(e.toLowerCase())){var t=$(".bh-file-upload-download",$(this)).attr("href");n.push(t)}}),$(n).each(function(e){i==this&&(l=e),o.push({image:this})}),$.bhGallery({dataSource:o,show:l})}else{if(/\.pdf$/g.test(a.toLowerCase()))return void(e.canPreviewPDF&&$.emapPDFViewer({url:i}));location.href=$(".bh-file-upload-download",t).attr("href")}}),this.add=function(e,t,a,i,n){var o=WIS_EMAP_SERV._getIconImgClass(e),l=$('<div class="bh-pull-left bh-file-upload-file" data-bhid="'+t+'" data-fileId="'+(a?a:0)+'"><div class="bh-file-upload-file-icon bh-pull-left"><i class="iconfont icon-insertdrivefile icon-setstyle '+o+'"></i></div><div class="bh-file-upload-file-info bh-pull-left"><a class="bh-file-upload-name-a" href="javascript:void(0)" style="color:#333;"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span></a><p style="white-space: nowrap"><a class="bh-file-upload-download bh-mr-8" href="'+i+'">下载</a><a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></p></div></div>');$(this).append(l),n&&n(l)},this.addImage=function(e,t,a,i,n){var o=$('<div class="bh-pull-left bh-file-upload-file bh-file-upload-img" data-bhid="'+t+'" data-fileId="'+(a?a:0)+'"><div class="bh-file-upload-img-block"><span><img src="'+i+'" /></span></div><div class="bh-file-upload-file-info"><span class="bh-file-upload-filename" title="'+e+'">'+e+'</span><p><span class="bh-file-upload-success-info">上传成功</span> <a class="bh-file-upload-delete" href="javascript:void(0)">删除</a></p></div></div>');$(this).append(o),n&&n(o)},this._findFile=function(e,t){var a=t?t:e,i=t?"fileid":"bhid";return $(this).find(".bh-file-upload-file[data-"+i+"="+a+"]")},this.remove=function(e,t){var a=this._findFile(e,t);a.length>0&&a.remove()},this.getFileNum=function(){return $(this).find(".bh-file-upload-file").length},this},function(){var e,t,a,i,n,o,l,r,s,d,c,p,h={};e=function(){function e(e,a){if(a.mode&&(a.model=a.mode),("L"==a.model||"horizontal"==a.model)&&(a.model="h"),("S"==a.model||"vertical"==a.model)&&(a.model="v"),a.rows&&(a.cols=a.rows),this.options=$.extend({},$.fn.emapForm.defaults,a),this.options&&null!=this.options&&""!=this.options||(this.options=WIS_EMAP_SERV.getContextPath()),this.$element=$(e),this.$element.attr("emap-role","form"),this.$element.attr("emap",JSON.stringify({"emap-url":WIS_EMAP_SERV.url,"emap-name":WIS_EMAP_SERV.name,"emap-app-name":WIS_EMAP_SERV.appName,"emap-model-name":WIS_EMAP_SERV.modelName})),delete WIS_EMAP_SERV.url,delete WIS_EMAP_SERV.name,delete WIS_EMAP_SERV.appName,delete WIS_EMAP_SERV.modelName,t(this.$element,this.options),
!this.options.readonly&&this.options.data&&(this.$element.emapFormInputInit(this.options),$.isEmptyObject(h)||WIS_EMAP_INPUT.formSetValue(this.$element,h,this.options),this.options.validate&&this.$element.emapValidate(a)),!this.options.readonly&&this.options.data){var i=this.options.data.filter(function(e){return!(!e.linkageBy&&!e["form.linkageBy"])});i.length>0&&this.$element.emapLinkage({data:i})}var n=this;c(this.$element,this.options),setTimeout(function(){(n.options.readonly||"t"==n.options.model)&&n.$element.emapForm("refreshColumns"),WIS_EMAP_INPUT.placeHolder(),p(n.$element,n.options)},0)}return e.prototype.disableItem=function(e){WIS_EMAP_INPUT.formDisable(this.$element,e),this.$element.emapForm("reloadValidate")},e.prototype.enableItem=function(e){WIS_EMAP_INPUT.formEnable(this.$element,e),this.$element.emapForm("reloadValidate")},e.prototype.saveUpload=function(){var e=$("[xtype=uploadphoto], [xtype=uploadfile], [xtype=uploadsingleimage], [xtype=uploadmuiltimage]",this.$element);e.each(function(){switch($(this).attr("xtype")){case"uploadphoto":$(this).emapFilePhoto("saveTempFile");break;case"uploadfile":$(this).emapFileUpload("saveTempFile");break;case"uploadsingleimage":$(this).emapSingleImageUpload("saveTempFile");break;case"uploadmuiltimage":$(this).emapImageUpload("saveTempFile")}})},e.prototype.showItem=function(e){function t(e){"t"==i.model&&0==i.readonly?$("[data-name="+e+"]",a).closest(".bh-form-group").show():$("[data-name="+e+"]",a).closest(".bh-row").show().attr("hidden",!1)}var a=this.$element,i=this.options;l(e,t),a.emapForm("reloadValidate"),("t"==i.model||1==i.readonly)&&a.emapForm("refreshColumns")},e.prototype.hideItem=function(e){function t(e){"t"==i.model&&0==i.readonly?$("[data-name="+e+"]",a).closest(".bh-form-group").hide():$("[data-name="+e+"]",a).closest(".bh-row").hide().attr("hidden",!0)}var a=this.$element,i=this.options;l(e,t),a.emapForm("reloadValidate"),("t"==i.model||1==i.readonly)&&a.emapForm("refreshColumns")},e.prototype.getValue=function(){return WIS_EMAP_INPUT.formGetValue(this.$element,this.options)},e.prototype.clear=function(e){WIS_EMAP_INPUT.formClear(this.$element,e,this.options)},e.prototype.setValue=function(e){WIS_EMAP_INPUT.formSetValue(this.$element,e,this.options)},e.prototype.destroy=function(){$("[xtype]",this.$element).each(function(){var e=$(this),t=e.attr("xtype");switch(t){case"select":e.jqxDropDownList("destroy");break;case"multi-select":e.jqxComboBox("destroy");break;case"date-local":case"date-ym":case"date-full":e.jqxDateTimeInput("destroy");break;case"tree":e.jqxDropDownButton("destroy")}}),this.options.readonly||this.$element.emapValidate("destroy"),this.options=null,$(this.$element).removeAttr("emap-role"),$(this.$element).data("emapform",!1).empty()},e.prototype.reloadValidate=function(){this.$element.emapValidate("destroy"),this.$element.emapValidate(this.options)},e.prototype.requireItem=function(e){function t(e){var t=$("[data-name="+e+"]",a).closest(".bh-form-group");t.hasClass("bh-required")||(t.addClass("bh-required"),a.emapForm("reloadValidate"))}var a=this.$element;l(e,t)},e.prototype.unRequireItem=function(e){function t(e){var t=$("[data-name="+e+"]",a).closest(".bh-form-group");t.hasClass("bh-required")&&(t.removeClass("bh-required"),a.emapForm("reloadValidate"))}var a=this.$element;l(e,t)},e.prototype.getModel=function(e){return this.options.hasGroup&&e?n(this.options.data):this.options.data},e.prototype.refreshColumns=function(){var e=this.options;(e.readonly||"t"==e.model)&&$(".bh-form-block",this.$element).each(function(){if("t"==e.model)var t=$(".bh-form-group:visible",$(this)).parent();else var t=$(".bh-form-group:visible",$(this));t.each(function(a){t[a].className=t[a].className.replace(/bh\-col\-md\-\d+/g,"bh-col-md-"+$(t[a]).data("col")*e.colWidth)});var a=0;t.each(function(i){var n=$(this).data("col");if(a+=n,n==e.cols||3==e.cols&&n==e.cols-1){if((a-n)%e.cols){var o=t.eq(i-1).data("col")+1*e.cols-(a-n)%e.cols;t[i-1].className=t[i-1].className.replace(/bh\-col\-md\-\d+/g,"bh-col-md-"+o*e.colWidth),a=0}}else if(i==t.length-1&&a%e.cols){var o=t.eq(i).data("col")+1*e.cols-a%e.cols;t[i].className=t[i].className.replace(/bh\-col\-md\-\d+/g,"bh-col-md-"+o*e.colWidth),a=0}})})},e.prototype.changeLabelColor=function(e){function t(e,t,a){var i=a.$element,n=a.options.model;if("t"==n){var o=$("[data-name="+e+"]",i).closest(".bh-form-group");o.removeClass("bh-primary bh-info bh-success bh-warning bh-danger bh-normal").addClass("bh-"+t)}}var a=this;for(var i in e)"primary"!=i&&"info"!=i&&"success"!=i&&"warning"!=i&&"danger"!=i&&"normal"!=i&&console&&console.error(i+"不是有效的label color 属性!"),e[i]instanceof Array?e[i].map(function(e){t(e,i,a)}):t(e[i],i,a)},e}(),t=function(e,t){if(t.data){var o=t.readonly?t.readonly:!1,l=$('<div class="bh-form-horizontal" bh-form-role="bhForm" ></div>');if(o||"t"==t.model?(l.addClass("bh-form-readonly"),"t"==t.model&&l.addClass("bh-table-form")):"v"==t.model&&l.addClass("bh-form-S"),t.hasGroup=t.data.filter(function(e){return!!e.groupName&&""!=e.groupName}).length>0,t.hasGroup&&t.renderByGroup)for(var s=n(t.data),d=0;d<s.length;d++){var c=$('<div bh-form-role=groupContainer><div class="bh-col-md-12 bh-form-groupname sc-title-borderLeft bh-mb-24" bh-role-form-outline="title" title="'+s[d].groupName+'" >'+s[d].groupName+'</div><div class="bh-form-block bh-mb-36" bh-role-form-outline="container" style="margin-left: 12px;margin-bottom: 36px;"></div></div>');t.showCollapseBtn&&$(".bh-form-groupname",c).append('<a bh-form-role="collapseBtn" data-collapse=false class="bh-text-caption bh-mh-8" style="font-weight: normal;" href="javascript:void(0)">收起</a>');var p=$("[bh-role-form-outline=container]",c),h=s[d].items.filter(function(e){return!e.get("hidden")});s[d].groupName&&0!=h.length||(c.css("display","none"),$(".bh-form-groupname",c).removeAttr("bh-role-form-outline"),$(".bh-form-block",c).attr("bh-role-form-outline","hidden")),"t"==t.model?r(p,s[d].items,t):o?a(p,s[d].items,t):i(p,s[d].items,t),l.append(c)}else"t"==t.model?r(l,t.data,t):o?a(l,t.data,t):i(l,t.data,t);e.append(l)}},n=function(e){for(var t=[],a=0;a<e.length;a++){var i=t.filter(function(t){return t.groupName==e[a].groupName});0==i.length?t.push({groupName:e[a].groupName,items:[e[a]]}):i[0].items.push(e[a])}return t},a=function(e,t,a){a.cols=a.cols?a.cols:3,a.colWidth=12/a.cols;var i="",n=0;$(t).each(function(e){var t=o(this);t.hidden||(n+=t.col),"textarea"==t.xtype&&(t.col=12/a.colWidth),i+='<div class="bh-form-group  bh-col-md-'+t.col*a.colWidth+'" '+(t.hidden?'style="display: none;"':"")+' data-col="'+t.col+'" ><label class="bh-form-label bh-form-readonly-label" title="'+t.caption+'">'+t.caption+'</label><div class="bh-form-readonly-input">',i+=s(this,a),i+="</div></div>"}),e.append(i).addClass("bh-form-block")},r=function(e,t,a){var i=[];a.cols=a.cols?a.cols:3,a.colWidth=12/a.cols,$(t).each(function(){var e="",t=o(this);"textarea"==t.xtype&&(t.col=a.cols),e+='<div class="form-validate-block bh-col-md-'+t.col*a.colWidth+'" data-col="'+t.col+'" '+(t.col==a.cols?"":'style="max-height: 33px;"')+'><div class="bh-form-group '+t.required+'" '+(t.hidden?'style="display: none;"':"")+' ><label class="bh-form-label bh-form-readonly-label" title="'+t.caption+'">'+t.caption+'</label><div class="bh-ph-8 bh-form-readonly-input" emap-role="input-wrap">',e+='<div class="bh-form-placeholder bh-form-flow">'+t.placeholder+"</div>",e+="</div></div></div>",e=$(e);var n=$('[emap-role="input-wrap"]',e);t.inputReadonly?n.append(s(this,a)):(n.append(d(this)),(void 0==t.xtype||"text"==t.xtype)&&n.append('<i class="iconfont icon-edit bh-table-form-icon"></i>')),i.push(e)}),e.append(i).addClass("bh-form-block"),$(".form-validate-block",e).hover(function(){$(this).toggleClass("bh-actived")})},i=function(e,t,a){$(t).each(function(){var t=o(this),i="",n=d(this),l=12-parseInt(a.inputWidth);"h"==a.model?i='<div class="bh-row form-validate-block" {{hidden}} data-field='+t.name+' ><div class="bh-form-group bh-col-md-'+a.inputWidth+" "+t.required+' {{inputReadonly}}"><label class="bh-form-label bh-form-h-label bh-pull-left" title="'+t.caption+'">'+t.caption+'</label><div class="bh-ph-8" style="margin-left: 115px;" emap-role="input-wrap"></div></div><div class="bh-form-group bh-col-md-'+l+' bh-color-caption bh-form-placeholder">'+t.placeholder+"</div></div>":"v"==a.model&&(i='<div class="bh-row form-validate-block" {{hidden}} data-field='+t.name+'><div class="bh-form-group bh-col-md-12 '+t.required+' {{inputReadonly}}" style="padding: 0 4px 0 12px;"><label class="bh-form-label  ">'+t.caption+'</label><div class="bh-form-vertical-input-wrap" emap-role="input-wrap"></div></div><div class="bh-form-group bh-col-md-12 bh-color-caption bh-form-placeholder">'+t.placeholder+"</div></div>"),i=i.replace(/\{\{hidden\}\}/g,t.hidden?'style="display: none;" hidden=true':""),i=$(i),$('[emap-role="input-wrap"]',i).append(n),e.append(i),"v"==a.model&&"switcher"==t.xtype&&$(".bh-form-group",i).addClass("bh-form-vertical-switcher"),"hidden"!=e.attr("bh-role-form-outline")&&e.attr("bh-role-form-outline","container")})},s=function(e,t){var a="",i=o(e);switch("textarea"==i.xtype&&(i.col=t.cols),i.xtype){case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":a+='<div xtype="'+i.xtype+'" class="" data-name="'+i.name+'" data-JSONParam="'+encodeURI(JSON.stringify(i.JSONParam))+'"></div>';break;case"textarea":a+='<textarea xtype="textarea" data-name="'+i.name+'" class="bh-form-control" rows="3" maxlength="'+i.dataSize+'" unselectable="on" readOnly  style="background: #fff;resize: none;border: none!important;box-shadow: none!important;overflow: auto;" ></textarea>';break;default:a+='<p data-name="'+i.name+'" data-url="'+i.url+'" xtype="'+i.xtype+'" class="bh-form-static bh-ph-8"></p>'}return a},d=function(e){return WIS_EMAP_INPUT.renderPlaceHolder(e)},o=function(e){var t=WIS_EMAP_SERV.getAttr(e);return void 0!==t.defaultValue&&(h[e.get("name")]=t.defaultValue),t},l=function(e,t){$.isArray(e)?$(e).each(function(){t(this)}):t(e)},p=function(e,t){("t"==t.model||1==t.readonly)&&$(".bh-form-readonly-label",e).each(function(){var e=$(this).height();e>30&&($(this).css({"line-height":"13px","max-height":"30px"}),e>35&&$.bhCutStr({dom:{selector:$(this),line:2}}))})},c=function(e,t){var a=$('[bh-form-role="bhForm"]',e);a.on("click",'[bh-form-role="collapseBtn"]',function(){var e=$(this),t=$(this).closest('[bh-form-role="groupContainer"]').find(".bh-form-block");e.data("collapse")?(t.slideDown(200),e.data("collapse",!1).text("收起")):(t.slideUp(200),e.data("collapse",!0).text("展开"))})},$.fn.emapForm=function(t,a){var i;return i=this.data("emapform"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return"destroy"==t?this:$(this).data("emapform",new e(this,t))})},$.fn.emapForm.defaults={readonly:!1,model:"h",size:"M",cols:"3",root:"",validate:!0,renderByGroup:!0,autoColumn:!0,inputWidth:"6",showCollapseBtn:!1}}.call(this),function(e){function t(){c="table",p={},h=null,u=null}function a(e,t){l(t),e.showCustomColumnSetting===!1||e.schema===!1?t.find(".bh-switch-setting").remove():(e.schema=!0,e.contextPath=e.contextPath||window.contextPath),o(e.type,e,t),n(e,t)}function i(t,a){e(".bh-switch-item").removeClass("bh-active"),"list"==t||"table"==t?a.find(".bh-switch-list").addClass("bh-active"):"card"==t&&a.find(".bh-switch-card").addClass("bh-active")}function n(t,a){a.find(".bh-switch-item").click(function(i){var n=e(i.currentTarget).attr("data-x-type");return"setting"==n?void a.find(".bh-grid-table").emapdatatable("selectToShowColumns"):("card"==n?a.find(".bh-switch-setting").hide():"list"==n&&a.find(".bh-switch-setting").show(),o(n,t,a),void(t.gridAfterSwitch&&t.gridAfterSwitch(n)))}),a.find(".bh-grid-table").on("pageSizeChanged",function(e){var t=e.args;h=t.pagenum,u=t.pageSize}),a.find(".bh-grid-table").on("pageChanged",function(e){var t=e.args;h=t.pagenum,u=t.pageSize})}function o(t,a,n,o){c=t,i(t,n),"list"==t||"table"==t?(n.find(".bh-grid-table").prop("rendered")?(n.find(".bh-grid-table").jqxDataTable({pageSize:u||12}),n.find(".bh-grid-table").emapdatatable(!0).source.data=e.extend({},a.params,p),n.find(".bh-grid-table").jqxDataTable("goToPage",h||0)||n.find(".bh-grid-table").jqxDataTable("updateBoundData")):r(a,n),n.find(".bh-grid-table").show(),n.find(".bh-grid-card").hide(),a.afterCardRender&&a.afterCardRender()):"card"==t&&(p.pageSize=u,p.pageNumber=0===h?h+"":h,n.find(".bh-grid-card").prop("rendered")?0==p.pageNumber?n.find(".bh-grid-card").emapCard("reloadFirstPage",p):n.find(".bh-grid-card").emapCard("reload",p):s(a,n),n.find(".bh-grid-table").hide(),n.find(".bh-grid-card").show())}function l(e){var t='<div class="bh-grid-container"> <div class="bh-switch-card-view">   <span class="bh-switch-item bh-switch-setting" data-x-type="setting" style="margin-right: 8px;"><i class="iconfont icon-settings"></i><span>设置</span></span>     <span class="bh-switch-item bh-switch-list bh-active" data-x-type="list"><i class="iconfont icon-viewlist"></i><span>列表</span></span>     <span class="bh-switch-item bh-switch-card" data-x-type="card"><i class="iconfont icon-viewmodule"></i><span>卡片</span></span> </div> <div class="bh-grid-table"></div> <div class="bh-grid-card"></div></div>';e.html(t)}function r(t,a){var i=e.extend({},t);i.params=e.extend({},i.params,p),delete i.template,delete i.cardAfterRender,delete i.gridAfterSwitch,delete i.cardBeforeRender,delete i.showCustomColumnSetting,delete i.type,i.pageSize=u||12,i.pageSizeOptions=[12,24,48,96],a.find(".bh-grid-table").prop("rendered",!0),a.find(".bh-grid-table").emapdatatable(i)}function s(t,a){var i=e.extend({},t);i.params=e.extend({},i.params,p),i.pageSize=u,i.pageNumber=h,i.pageSizeOptionsChange=function(e,t){u=e,h=t},a.find(".bh-grid-card").prop("rendered",!0),a.find(".bh-grid-card").emapCard(i)}var d,c="table",p={},h=null,u=null;d=function(){function i(i,n){t(),this.settings=e.extend({},e.fn.emapGrid.defaults,n),this.$element=e(i),a(this.settings,this.$element)}return i}(),d.prototype={reload:function(e,t){p=e||p,t===!0&&(h=0),o(c,this.settings,this.$element,e)},getTable:function(){return this.$element.find(".bh-grid-table")},getCard:function(){return this.$element.find(".bh-grid-card")},getType:function(){return c}},e.fn.emapGrid=function(t,a,i){var n;return n=this.data("emapGrid"),n?t===!0?n:"string"===e.type(t)?n[t](a,i):this:this.each(function(){return e(this).data("emapGrid",new d(this,t))})},e.fn.emapGrid.defaults={type:"list",cardBeforeRender:null,cardAfterRender:null,gridAfterSwitch:null,showCustomColumnSetting:!0}}(jQuery),function(){var e,t,a,i="FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapImageUpload.defaults,a),this.$element=$(e),t(this.$element,this.options)}e.prototype.getFileToken=function(){return 0==this.$element.emapImageUpload("getFileNum")?"":this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileUrl")},e.prototype.saveTempFile=function(){var e=this.options,t=this.options.fileInput.emapUploadCore("saveTempFile");return $(".bh-file-img-block img",this.$element).each(function(){var t=$(this).attr("src"),a=$(this).closest(".bh-file-img-block");if(new RegExp("getTempFile").test(t)){var i=a.data("fileid");$(this).attr("src",e.contextPath+"/sys/emapcomponent/file/getAttachmentFile/"+i+".do")}}),t},e.prototype.getFileNum=function(){return $(".bh-file-img-container .saved, .bh-file-img-container .success",this.$element).length},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},t=function(e,t){var a=parseInt(t.width)-6,n=parseInt(t.height)-6;t.fileName&&1!=t.limit&&delete t.fileName,$(e).addClass("bh-clearfix").append('<p class="bh-file-img-info"></p><div class="bh-file-img-container"><div class="bh-file-img-input bh-file-img-block" style="width: '+t.width+"px;height: "+t.height+'px;"><span><span class="bh-file-img-plus">+</span><span class="bh-file-img-text">点击上传</span></span><input type="file" '+(t.multiple?"multiple":"")+"></div></div>"),t.fileInput=$("input[type=file]",e).parent();var o="请上传图片";t.type&&t.type.length>0&&(o+=", 支持"+t.type.join(",").toUpperCase()+"类型"),t.size&&t.size>0&&(o+=",大小在"+(t.size<1024?t.size+"K":t.size/1024+"M")+"以内"),t.limit&&t.limit>0&&(o+=",数量在"+t.limit+"以内"),$(".bh-file-img-info",e).html(o),t.height<=100&&$(".bh-file-img-text",e).hide(),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(i){if(i.success){var o="";$(i.items).each(function(){o+='<div class="bh-file-img-block saved" data-fileid="'+this.id+'" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-loading" style="line-height: '+n+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+a+"px;height: "+n+'px;"><span style="width: '+a+"px;height: "+n+'px;"><img src="'+this.fileUrl+'" style="max-width: '+a+"px;max-height: "+n+'px;" /></span></div><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div>'}),$(".bh-file-img-input",e).before(o)}}}),t.fileInput.emapUploadCore($.extend({},t,{add:function(i,o){var l=o.files,r=(new Date).getTime();$(l).each(function(i){o.files[i].bhId=r+i,$(".bh-file-img-input",e).before('<div class="bh-file-img-block loading" data-bhid="'+o.files[i].bhId+'" style="width: '+t.width+"px;height: "+t.height+'px;"><div class="bh-file-img-loading" style="line-height: '+n+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+a+"px;height: "+n+'px;"><span style="width: '+a+"px;height: "+n+'px;"><img style="max-width: '+a+"px;max-height: "+n+'px;" /></span></div><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div>')}),t.add&&t.add(i,o),o.submit()},submit:function(a,n){var o=n.files[0],l=$(".bh-file-img-block[data-bhid="+o.bhId+"]",e);if(t.limit){var r=$(".bh-file-img-block",e).length-1;if(r>t.limit)return l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件数量超出限制"),!1}return t.type&&t.type.length>0&&!new RegExp((t.type.join("|")+"$").toUpperCase()).test(o.name.toUpperCase())?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件类型不正确"),!1):i&&t.size&&o.size/1024>t.size?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件大小超出限制"),!1):(l.data("xhr",n),void(t.submit&&t.submit(a,n)))},done:function(a,i){var n=i.files[0],o=$(".bh-file-img-block[data-bhid="+n.bhId+"]",e);o.removeClass("loading").addClass("success"),$("img",o).attr("src",i.result.tempFileUrl),o.data({fileid:i.result.id,deleteurl:i.result.deleteUrl}),t.done&&t.done(a,i),$.bhPaperPileDialog&&($.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter())},fail:function(a,i){var n=i.files[0],o=$(".bh-file-img-block[data-bhid="+n.bhId+"]",e);o.removeClass("loading").addClass("error").find(".bh-file-img-fail").html(i.result.error?i.result.error:"上传失败"),t.fail&&t.fail(a,i),$.bhPaperPileDialog&&($.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter())}})),$(e).on("click",".bh-file-img-delete",function(){var e=$(this).closest(".bh-file-img-block");e.hasClass("success")?t.fileInput.emapUploadCore("deleteTempFile",e.data("fileid")).done(function(t){t.success&&e.remove()}):e.hasClass("error")?e.remove():e.hasClass("loading")?(e.data("xhr").abort(),e.remove()):e.hasClass("saved")&&(t.fileInput.emapUploadCore("deleteArrAdd",e.data("fileid")),e.remove())}),$(e).on("click",".bh-file-img-table img",function(){if(!$.bhGallery)return void(console&&console.warn("图片轮播插件Gallery未引入"));var e=$(this).attr("src"),t=$(this).closest(".bh-file-img-container").find(".bh-file-img-table img"),a=[],i=0;t.length>0&&(t.each(function(t){e==$(this).attr("src")&&(i=t),a.push({image:$(this).attr("src")})}),$.bhGallery({dataSource:a,show:i}))})},a=function(e,t){var a=$(".bh-file-img-block",e).length-1,i=$(".bh-file-img-input",e);a>=t.limit?i.hide():i.show()},$.fn.emapImageUpload=function(t,a){var i;return i=this.data("plugin"),i?t===!0?i:"string"===$.type(t)?i[t](a):void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapImageUpload.defaults={multiple:!1,dataType:"json",storeId:"image",width:200,height:150,type:["jpg","jpeg","png"],size:0}}()}.call(this),$.emapImport=function(e){e.params&&e.params.read?(e.params.readTemplate=e.params.readImport=e.params.read,delete e.params.read):e.params&&e.params.readTemplate&&e.params.readImport&&e.params.readTemplate==e.params.readImport&&console&&console.error("readTemplate 与 readImport不能相同!"),e.content='<div class="bh-import-content"><div class="bh-import-step active"><h5 class="bh-import-step-title"><span>1</span>上传文件<i class="bh-color-caption bh-import-p bh-import-step1-intro">如果您是初次使用，建议您<a role="downTplBtn" href="javascript:void(0)">下载导入模板</a>进行查看。</i></h5><div class="bh-import-step-content bh-import-step1-content"><a href="javascript:void(0)" class="bh-btn bh-btn-primary bh-btn-small bh-import-input-a">开始上传<input type="file" role="fileInput"/></a></p></div><div class="bh-import-step-content bh-import-step1-content" style="display: none;"><p class="bh-color-caption bh-import-p  bh-import-step1-file"><span class="bh-import-file-name"></span><span class="bh-import-file-size"></span></p><a href="javascript:void(0)" class="bh-import-reload-a bh-mh-8" role="reImportBtn">重新上传</a><a href="javascript:void(0)" role="importConfirmBtn" class="bh-btn bh-btn-primary bh-btn-small">确认上传</a></div></div><div class="bh-import-step "><h5 class="bh-import-step-title"><span>2</span>导入数据</h5><div class="bh-import-step-content"><p class="bh-import-step2-intro">等待文件上传完毕后自动导入数据</p><div class="bh-import-step2-content"><div class="bh-import-loading-bar"><div></div></div><p class="bh-import-step2-count"></p></div></div></div><div class="bh-import-step "><h5 class="bh-import-step-title"><span>3</span>完成</h5><div class="bh-import-step-content bh-import-step3-content"><p class="bh-import-result-detail">该文件全部导入数据10000条，其中失败导入2条</p><p>具体结果可查看<a class="bh-import-export" href="javascript:void(0)">下载导入结果</a>查看明细。</p><button role="closeConfirmBtn" class="bh-btn bh-btn-default bh-btn-small bh-pull-right bh-mh-8 bh-mb-8">确定关闭</button></div></div></div>',BH_UTILS.bhWindow(e.content,"导入数据",{},{height:450,close:function(){e.closeCallback&&""!=e.closeCallback&&e.closeCallback()}}),e.preCallback&&""!=e.preCallback&&e.preCallback(),$("[role=fileInput]").emapImportData(e)},$.fn.emapImportData=function(e){function t(e){$("[role=fileInput]",o).data("loading",!1),$("div.bh-import-step-content:eq(2)",o).html("<p></p>"),$("div.bh-import-step:eq(2)",o).addClass("active").find(".bh-import-result-detail").html('<span style="color: red">'+(e.msg||"导入失败")+"</span>")}function a(e,t,a){$("[role=fileInput]",o).data("loading",!1),$("div.bh-import-step-content:eq(2)",o).html('<p class="bh-color-success">数据导入完成</p>'),$("div.bh-import-step:eq(2)",o).addClass("active").find(".bh-import-result-detail").html("导入已完成， 其中导入成功"+t+"条，导入失败"+(e-t)+"条"),a&&""!=a&&a($("div.bh-import-step:eq(2)",o).find(".bh-import-export"))}var i,n,o=$(this).closest(".bh-import-content"),l={app:e.app,module:e.module,page:e.page,action:e.action,storeId:e.storeId?e.storeId:"imexport"},r=e.contextPath;e.params&&$.extend(l,e.params),i=Date.parse(new Date),n=i+1,$(this).fileupload({autoUpload:!1,url:r+"/sys/emapcomponent/file/uploadTempFile/"+i+"/"+n+".do",dataType:"json",formData:{storeId:e.storeId?e.storeId:"file"},add:function(e,t){var a=t.files,i=$(this).closest(".bh-import-step").find(".bh-import-step-content");i.eq(0).hide(),i.eq(1).show();var n=a[0].name.split(".");return new RegExp("xlsx|xlsm|xltx|xltm|xlsb|xlam|xls").test(n[n.length-1].toLowerCase())?(i.eq(1).find("span.bh-import-file-name").text(a[0].name).attr("title",a[0].name),i.eq(1).find("span.bh-import-file-size").text("("+parseInt(a[0].size/1024)+"k)"),$("[role=importConfirmBtn]",o).attr("disabled",!1),void $("[role=importConfirmBtn]",o).unbind("click").bind("click",function(){$("[role=fileInput]",o).data("loading",!0);var e=$(this).closest(".bh-import-step-content");e.children("a").hide(),e.prepend('<div class="bh-import-step1-loading-block bh-pull-right"><div class="sk-spinner sk-spinner-fading-circle bh-pull-right" style="height: 28px; width: 28px;"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div><p class="bh-pull-right" style="margin-right: 12px;line-height:28px;">上传中……</p></div>'),t.submit()})):(i.eq(1).find("span.bh-import-file-name").html('<span class="bh-color-danger">请上传正确的Excel文件</span>').attr("title",a[0].name),$("[role=importConfirmBtn]",o).attr("disabled",!0),!1)},done:function(s,d){if(d.result.success){var c=d.result.id;l.attachment=d.result.id,$.ajax({type:"post",url:r+"/sys/emapcomponent/file/saveAttachment/"+i+"/"+n+".do",data:{attachmentParam:JSON.stringify({scope:i,fileToken:n,attachmentParam:{storeId:l.storeId}})},success:function(i){$.ajax({type:"post",dataType:"json",url:r+"/sys/emapcomponent/imexport/importRownum.do",data:$.extend(l,{app:l.app,attachment:c}),success:function(i){return"500"==i.code?void t(i):($(".bh-import-step2-count",o).html("本次共导入数据"+i.rowNumber+"条"),$(".bh-import-step1-content",o).find("div.bh-import-step1-loading-block").remove(),$("div.bh-import-step:eq(1)",o).addClass("active"),$(".bh-import-loading-bar div",o).animate({width:"87%"},3e3),l.read&&delete l.read,l.readImport&&(l.read=l.readImport),l.action=e.action,l.actionImport&&(l.action=l.actionImport),void $.ajax({type:"post",dataType:"json",url:r+"/sys/emapcomponent/imexport/import.do",data:l,success:function(t){1==t.status?$(".bh-import-loading-bar div",o).stop().animate({width:"100%"},500,function(){if(e.importCallback&&""!=e.importCallback){var i=$.extend({total:t.total,success:t.success,callback:null},e.importCallback(t.total,t.success));a(i.total,i.success,i.callback)}else a(t.total,t.success,function(e){});$("div.bh-import-step:eq(2)",o).find(".bh-import-export").attr("href",r+"/sys/emapcomponent/file/getAttachmentFile/"+t.attachment+".do").parent().show(),1==e.autoClose&&BH_UTILS.bhWindow.close()}):($("[role=fileInput]",o).data("loading",!1),$("div.bh-import-step-content:eq(2)",o).html("<p></p>"),$("div.bh-import-step:eq(2)",o).addClass("active").find(".bh-import-result-detail").html('<span style="color: red">导入失败'+(t.msg||"")+"</span>"),t.attachment||$("div.bh-import-step:eq(2)",o).find(".bh-import-export").parent().hide())}}))},error:function(e){t(e)}})}})}}}),$("[role=reImportBtn]",o).on("click",function(){if(9==document.documentMode){var e=$(".bh-import-step1-content");e.eq(0).show(),e.eq(1).hide()}else $("[role=fileInput]",o).trigger("click")}),$("[role=closeConfirmBtn]",o).on("click",function(){e.closeCallback&&""!=e.closeCallback&&e.closeCallback(),BH_UTILS.bhWindow.close()}),$("[role=downTplBtn]",o).on("click",function(){e.tplUrl&&""!=e.Url?location.href=e.tplUrl:(l.read&&delete l.read,l.readTemplate&&(l.read=l.readTemplate),l.actionTemplate&&(l.action=l.actionTemplate),$.ajax({type:"post",url:r+"/sys/emapcomponent/imexport/importTemplate.do",data:l,success:function(e){location.href=r+"/sys/emapcomponent/file/getAttachmentFile/"+JSON.parse(e).attachment+".do"},error:function(e){console&&console.log(e)}}))})},function(){function e(e,t){$(t.data).each(function(){var t=this.linkageBy||this["form.linkageBy"],i=this.linkageName||this["form.linkageName"],n=this.name,o=$("[data-name="+t+"]",e);o.data({emaplinkagename:i,emaplinkageitem:n}),"select"==o.attr("xtype")?$("[data-name="+t+"]",e).on("select",function(){var t=[{name:$(this).data("emaplinkagename"),value:$(this).val(),builder:"equal",linkOpt:"AND"}];a($("[data-name="+$(this).data("emaplinkageitem")+"]",e),JSON.stringify(t))}):"tree"==o.attr("xtype")&&$("[data-name="+t+"]",e).on("close",function(){var t=[{name:$(this).data("emaplinkagename"),value:$(this).val(),builder:"equal",linkOpt:"AND"}];a($("[data-name="+$(this).data("emaplinkageitem")+"]",e),JSON.stringify(t))})})}var t,a;t=function(){function t(t,a){this.options=$.extend({},$.fn.emapLinkage.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t}(),a=function(e,t){e.jqxDropDownList("clear");var a=WIS_EMAP_SERV.getCode(e.data("url"),void 0,void 0,void 0,t);"select"==e.attr("xtype")?(e.data("loaded",!0),e.jqxDropDownList({source:a})):"selecttable"==e.attr("xtype")&&e.jqxDropDownList({source:a})},$.fn.emapLinkage=function(e,a){var i;return i=$(this).data("emapLinkage"),i?e===!0?i:"string"===$.type(e)?i[e](a):this:this.each(function(){return"destroy"==e?this:$(this).data("emapLinkage",new t(this,e))})},$.fn.emapLinkage.defaults={storeId:"image",contextPath:"/emap",defaultAvatar:"../u20.png",ratio:1,width:100,type:["jpg","png","gif"],size:5120}}.call(void 0),function(){function e(e,t){e.toggleClass("jqx-widget",!0),e.data("jqxWidget",t)}function t(e,t){return this.each(function(t,a){var n=$(a),o=n.data("we.bhNumRange"),l="object"==typeof e;o||n.data("we.bhNumRange",o=new i(a,l))}),"string"==typeof e?this.data("we.bhNumRange")[e](t):void 0}var a=['<div class="bh-num-range">','<div class="bh-num-range__input-wrap bh-pull-left">','<div class="bh-num-range__input bh-num-input__1 "></div>',"</div>",'<span class="bh-num-range__linkLine"></span>','<div class="bh-num-range__input-wrap bh-pull-right">','<div class="bh-num-range__input bh-num-input__2"></div>',"</div>","</div>"].join(""),i=function(t,n){return this.$elem=$(t),this.template=a,this.$input1=null,this.$line=null,this.$input2=null,this.options=$.extend(i.DEFAULT,n),this.init(),e(this.$elem,this),this};i.DEFAULT={value:null,spinButtons:!0,inputMode:"simple",decimal:null,decimalDigits:0,promptChar:"",input1:null,input2:null},i.prototype.init=function(){var e=this.$elem;e.html(this.template),this.$input1=e.find(".bh-num-input__1"),this.$input2=e.find(".bh-num-input__2"),this.$line=e.find(".bh-num-range__linkLine");var t=_.cloneDeep(this.options),a=t.input1,i=t.input2;delete t.input1,delete t.input2;var n=Math.floor((this.$elem.width()-15)/2);this.$elem.find(".bh-num-range__input-wrap").width(n),a=$.extend({},t,a),i=$.extend({},t,i),this.$input1.jqxNumberInput(a),this.$input2.jqxNumberInput(i),this.bindEvent()},i.prototype.bindEvent=function(){},i.prototype.upgradeInputWidth=function(){var e=Math.floor((this.$elem.width()-20)/2);this.$input1.jqxNumberInput("width",e),this.$input2.jqxNumberInput("width",e)},i.prototype.val=function(e){return arguments.length?this.setValue(e):this.getValue()},i.prototype.setValue=function(e){null!=e.input1&&this.$input1.val(e.input1),null!=e.input2&&this.$input2.val(e.input2)},i.prototype.getValue=function(){return[this.$input1.val(),this.$input2.val()].join(",")},i.prototype.disabled=function(e){"boolean"==typeof e&&(e={input1:e,input2:e}),this.$input1.jqxNumberInput("disabled",e.input1),this.$input2.jqxNumberInput("disabled",e.input2)},$.fn.bhNumRange=t,$.fn.bhNumRange.constructor=i}(),function(e){e.emapPDFViewer=function(e){e.contextPath||(e.contextPath=WIS_EMAP_SERV.getContextPath()),window.open(e.contextPath+"/sys/emapcomponent/pdf/index.do?file="+e.url)}}(jQuery),function(){var e,t;e=function(){function e(e,a){this.settings=$.extend({},$.fn.emapRepeater.defaults,a),this.$element=$(e),t(this.$element,this.settings)}return e.prototype.getValue=function(){var e=[];$(this.$element).find(".repeateritem").each(function(){var t=$(this).data("value");void 0!==t&&e.push($(this).data("value"))}),this.$element.val(e)},e.prototype.setValue=function(e){$(this.$element).find(".repeateritem").each(function(){
$(this).trigger("setValue",[e])})},e}(),t=function(e,t){var a=e,i={datatype:"json",root:"datas>code>rows",datafields:[{name:"id"},{name:"name"}],id:"id",url:t.url,data:t.params},n=new $.jqx.dataAdapter(i,{loadComplete:function(){for(var e=n.records,i=0;i<e.length;i++){var o=e[i],l=$("<div class='repeateritem'></div>");"horizontal"==t.align&&l.css({"float":"left"}),t.render(l,o),a.append(l)}}});n.dataBind()},$.fn.emapRepeater=function(t,a){var i;return(i=this.data("emapRepeater"))?t===!0?i:("string"===$.type(t)&&i[t](a),this):this.each(function(){return $(this).data("emapRepeater",new e(this,t))})},$.fn.emapRepeater.defaults={align:"vertical",itemWidth:"50%"}}.call(this),function(){function e(e,a){e.html(d),t(e,a)}function t(e,t){$(".bh-ers-j-add-btn",e).on("click",function(){a(e,t)}),e.on("click",".bh-ers-close",function(){var e=$(this);BH_UTILS.bhDialogWarning({title:"确定要删除该条件吗？",buttons:[{text:"确定",className:"bh-btn-warning",callback:function(){e.parent().remove()}},{text:"取消",className:"bh-btn-default"}]})}),e.on("change",".bh-ers-select .bh-ers-nice-select",function(){var e=$(this).closest(".bh-ers-row"),a=t.data.controls,i=$(this).val(),n=a.filter(function(e){return e.name==i})[0];o(t,n,e)})}function a(e,t,a){var n=$('<div class="bh-clearfix bh-ers-row" ></div>'),l=t.data.controls;if(n.append('<div class="'+(t.showBuilder?"bh-ers-col-3":"bh-ers-col-2")+'"><div class="bh-ers-select"></div></div>'),t.showBuilder&&n.append('<div class="bh-ers-col-3"><div class="bh-ers-builder"></div></div>'),n.append('<div class="'+(t.showBuilder?"bh-ers-col-3":"bh-ers-col-2")+'"><div class="bh-ers-option"></div></div>'),n.append('<i class="iconfont icon-close bh-ers-close"></i>'),i({dom:$(".bh-ers-select",n),source:l}),$(".bh-ers-j-condition",e).append(n),a){var r=l.filter(function(e){return e.name==a.name})[0];$(".bh-ers-select select",n).val(a.name),o(t,r,n)}else o(t,l[0],n);a&&($(".bh-ers-builder select",n).val(a.builder),$(".bh-ers-option select, .bh-ers-option input",n).val(a.value))}function i(e){var t=$('<select class="bh-ers-nice-select"></select>');$(e.source).each(function(){t.append('<option value="'+this.name+'">'+this.caption+"</option>")}),e.dom.html(t),e.dom.append('<i class="iconfont icon-arrowdropdown bh-ers-nice-select-arrow"></i>')}function n(e){var t=$('<select class="bh-ers-nice-select"></select>');$(e.source).each(function(){t.append('<option value="'+this.id+'">'+this.name+"</option>")}),e.dom.html(t),e.dom.append('<i class="iconfont icon-arrowdropdown bh-ers-nice-select-arrow"></i>')}function o(e,t,a){var o=t.builderList;switch(i({dom:$(".bh-ers-builder",a),source:e.data.builderLists[o]}),t.xtype){case"select":case"radiolist":case"checkboxlist":l(t.url,function(e){n({dom:$(".bh-ers-option",a),source:e})});break;case"date-local":case"date-ym":case"date-full":$(".bh-ers-option",a).empty().append('<div class="bh-ers-control"></div>'),$(".bh-ers-option div",a).jqxDateTimeInput({width:"100%",value:null,formatString:"yyyy-MM-dd",culture:"zh-CN"});break;default:$(".bh-ers-option",a).html('<input class="bh-form-control bh-ers-control" type="text">')}}function l(e,t){var a=new $.jqx.dataAdapter({url:e,datatype:"json",async:!1,root:"datas>code>rows"},{loadComplete:function(e){t(e.datas.code.rows)}});a.dataBind()}function r(e,t){var a=[];return $(".bh-ers-row",e).each(function(){var e,t=$(this);if(e=0==$(".bh-ers-option .bh-ers-control",t).length?$(".bh-ers-option .bh-ers-nice-select",t).val():$(".bh-ers-option .bh-ers-control",t).val(),!e||""==$.trim(e))return!0;var i={name:$(".bh-ers-select .bh-ers-nice-select",t).val(),value:e,linkOpt:"AND"};$(".bh-ers-builder .bh-ers-nice-select",t).length>0?i.builder=$(".bh-ers-builder .bh-ers-nice-select",t).val():i.builder=$("bh-.ers-control",t).val(),a.push(i)}),JSON.stringify(a)}var s,d='<div class="bh-ers-j-condition"></div><div class="bh-ers-add bh-ph-8 bh-ers-j-add-btn"><i class="iconfont icon-addcircle"></i><span>添加条件</span></div>';s=function(){function t(t,a){this.options=$.extend({},$.fn.emapRuleSetting.defaults,a),this.$element=$(t),e(this.$element,this.options)}return t.prototype.getValue=function(){return r(this.$element,this.options)},t.prototype.setValue=function(e){var t,i=this;$(".bh-ers-j-condition",i.$element).empty(),e&&null!=e&&""!=e&&(t="string"==typeof e?JSON.parse(e):e,t.length&&t.length>0&&$(t).each(function(){a(i.$element,i.options,this)}))},t}(),$.fn.emapRuleSetting=function(e,t){var a;return a=this.data("emapRuleSetting"),a?e===!0?a:"string"===$.type(e)?a[e](t):this:this.each(function(){return $(this).data("emapRuleSetting",new s(this,e))})},$.fn.emapRuleSetting.defaults={showBuilder:!0,builderData:[{name:"等于",id:"equal"}]}}.call(void 0),function(){var e,t,a,i,n,o,l,r,s,d,c,p,h,u,m,f,b,g,v,y,x=[];e=function(){function e(e,a){this.options=$.extend({},$.fn.emapRulesConstructor.defaults,a),this.$element=$(e),this.$element.attr("emap-role","advancedQuery").attr("emap-pagePath","").attr("emap-action",this.options.data.name),this.options._initCount=0,this.options._initCounter=0,t(this.$element,this.options)}return e.prototype.getValue=function(){return c(this.options)},e.prototype.setValue=function(e){this.$element.emapRulesConstructor("clear");var t="string"==typeof e?JSON.parse(e):e,a=this.options.$advanced,i=$(".bh-rules-block",a);$(a).addClass("bh-active"),this.options.searchModel="advanced",$(".bh-rules-block",a).show(),$(".bh-rules-body > .bh-rules-editor",a).hide();for(var n=0;n<t.length;n++)if($.isArray(t[n]))for(var o=0;o<t[n].length;o++)0==o?g(this.options,t[n][o]):v(this.options,t[n][o],$(".bh-rules-row:eq("+n+")",i))},e.prototype.clear=function(){this.options.$advanced;$(".bh-rules-row:not([rules-role=addOrRow])").remove(),y(this.options)},e}(),t=function(e,t){e.attr("emap",JSON.stringify({"emap-url":WIS_EMAP_SERV.url,"emap-name":WIS_EMAP_SERV.name,"emap-app-name":WIS_EMAP_SERV.appName,"emap-model-name":WIS_EMAP_SERV.modelName})),delete WIS_EMAP_SERV.url,delete WIS_EMAP_SERV.name,delete WIS_EMAP_SERV.appName,delete WIS_EMAP_SERV.modelName;var A=t.data.controls,w=[],k=[],F=BH_UTILS.NewGuid();a=function(){return 450},i=function(t){var a=t.$advanced;a.on("click","[bh-advanced-query-role=advancedOpen]",function(){$(a).addClass("bh-active"),t.searchModel="advanced"}),a.on("click","[bh-advanced-query-role=advancedClose]",function(){$(a).removeClass("bh-active"),t.searchModel="easy"}),a.on("keyup",".bh-advancedQuery-quick-search-wrap input[type=text]",function(i){var n=28*a.data("easyarray").length+1,o=$(this).outerWidth(),l=$(this).val(),r=$(this).offset(),s=$(".bh-advancedQuery-quick-select[data-guid="+t.guid+"]");return r.top+=28,13==i.keyCode?(s.css({height:0,"border-width":"0"}),void e.trigger("search",[c(t),t])):void(""==l?s.css({height:0,"border-width":"0"}):($(".bh-advancedQuery-easy-query",s).html(l),s.css({height:n+"px",width:o+"px","border-width":"1px",top:r.top,left:r.left})))}),$("[bh-advanced-query-role=advancedEasySelect][data-guid="+t.guid+"]").on("click","p",function(){var a=$(this).closest("[bh-advanced-query-role=advancedEasySelect]");a.height()>0&&a.css({height:0,"border-width":"0"}),e.trigger("search",[c(t,$(this).data("name")),t])}),a.on("click","[bh-advanced-query-role=easySearchBtn]",function(){e.trigger("search",[c(t),t])}),a.on("click","[bh-advanced-query-role=quickSearchForm] .bh-label-radio",function(){setTimeout(function(){e.trigger("search",[c(t),t])},200)}),a.on("click","[bh-advanced-query-role=advancedSearchBtn]",function(){e.trigger("search",[c(t),t])}),e.on("bhInputInitComplete",function(){t._initCounter++,t._initCounter==t._initCount&&(e.trigger("init",[t]),t.initComplete&&t.initComplete())}),$(document).on("click",function(e){var t=e.target;if(0==$(t).closest("[bh-advanced-query-role=advancedEasySelect]").length){var a=$(".bh-advancedQuery-quick-select");a.css({height:0,"border-width":"0"})}}),a.on("click","[rules-role=addAndBtn]",function(){var e=$(this).closest(".bh-rules-row");r(t,"+ 新增[且]条件",$(this),function(a,i){var n=s(i);return n?void v(t,n,e):!1})}),a.on("click","[rules-role=addOrBtn]",function(){r(t,"+ 新增[或]条件",$(this),function(e,a){var i=s(a);return i?void g(t,i):!1})}),a.on("click",".bh-rules-body > .bh-rules-editor [rules-role=editorAddBtn]",function(){var e=s($(this).closest(".bh-rules-editor"));e&&(g(t,e),$(".bh-rules-block",a).show(),$(".bh-rules-body > .bh-rules-editor",a).hide())}),a.on("click",".bh-rules-body > .bh-rules-editor [rules-role=editorCloseBtn]",function(){var e=$(this).closest(".bh-rules-editor");$("[rules-role^=editorInput]",e).each(function(e){if(2==e)switch($(this).attr("xtype")){case"select":$(this).jqxDropDownList("clearSelection");break;default:$(this).val("")}else $(this).jqxDropDownList("clearSelection")})}),a.on("click","[rules-role=closeTag]",function(){var e=$(this).parent(),a=e.prev(".bh-rules-and-text");if(a.length>0)a.remove(),e.remove();else{var i=e.closest(".bh-rules-row");$(".bh-tag",i).length>1?(e.next(".bh-rules-and-text").remove(),e.remove()):(i.remove(),y(t))}$.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter()}),a.on("click","[rules-role=tagTxt]",function(e){var a=$(e.currentTarget),i=a.closest(".bh-tag"),n=i.data("data");x=[n.name,n.builder,n.value,n.value_display];var o=function(e,t){var a=s(t);return a?(i.data("data",a),$("span",i).text('"'+a.caption+'" '+a.builder_display+' "'+(a.value_display?a.value_display:a.value)+'"'),!0):!1};r(t,"编辑: "+a.text(),i,o)})},n=function(e,t){var a="",i="";e.length&&e.length>0?(i+="请输入",$(e).each(function(){i+=this.caption+"/",a+='<p data-name="'+this.name+'">搜索 <span class="bh-advancedQuery-easy-caption">'+this.caption+'</span> : <span class="bh-advancedQuery-easy-query"></span></p>'}),$(".bh-advancedQuery-quick-select[data-guid="+t.guid+"]").html(a),i=i.substring(0,i.length-1),$(".bh-advancedQuery-quick-search-wrap input[type=text]",t.$advanced).attr("placeholder",i)):($(".bh-advancedQuery-quick-search-wrap",t.$advanced).hide(),$("[bh-advanced-query-role=easySearchBtn]",t.$advanced).hide())},o=function(e){var t=$("<div></div>");return $(e).each(function(e){("select"==this.xtype||"radiolist"==this.xtype||"checkboxlist"==this.xtype)&&(this.xtype="buttonlist"),t.append(d(this))}),t},d=function(e,a){var i=e;i.get=function(e){return i[e]};var n=i.get("xtype"),o=i.get("caption"),l=i.get("defaultBuilder"),r=i.get("url"),s=i.get("name"),d=i.get("hidden")?"hidden":"",c=(i.get("placeholder")?i.get("placeholder"):"",i.get("checkType"),i.get("checkSize"),i.get("dataSize"),i.get("checkExp"),i.get("format")?i.get("format"):"yyyy-MM-dd",$(' <div class="bh-advancedQuery-form-row bh-advancedQuery-h-28"><div class="bh-advancedQuery-groupName">'+o+'：</div><div class="bh-advancedQuery-groupList bh-label-radio-group"></div></div>'));a&&c.append('<a class="bh-bh-advancedQuery-group-dismiss" href="javascript:void(0)" bh-advanced-query-role="conditionDismiss"> <i class="icon-close iconfont"></i></a>');var p="";switch(n){case"tree":p+='<div xtype="{{xtype}}" data-name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" data-url="{{url}}" {{hidden}} ></div>';break;case"date-local":p+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM-dd" {{hidden}}></div>';break;case"date-ym":p+='<div xtype="{{xtype}}" data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" data-format="yyyy-MM" {{hidden}}></div>';break;case"switcher":p+='<div xtype="{{xtype}}"  data-builder="{{builder}}" data-caption="{{caption}}" data-name="{{name}}" {{hidden}}></div>';break;case"radiolist":p+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-radio" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"checkboxlist":p+='<div xtype="{{xtype}}" data-name="{{name}}" class="bh-checkbox" data-url="{{url}}" data-builder="{{builder}}" data-caption="{{caption}}" {{hidden}}></div>';break;case"buttonlist":case"select":p+='<div xtype="{{xtype}}" data-name="{{name}}" data-url="{{url}}" data-builder="{{builder}}" data-alloption={{allOption}} data-caption="{{caption}}" {{hidden}}></div>';break;default:p+='<input class="bh-form-control" data-name="{{name}}" name="{{name}}" data-builder="{{builder}}" data-caption="{{caption}}" xtype="text" type="text" {{hidden}} />'}return p=p.replace(/\{\{xtype\}\}/g,n).replace(/\{\{name\}\}/g,s).replace(/\{\{builder\}\}/g,l).replace(/\{\{caption\}\}/g,o).replace(/\{\{url\}\}/g,r).replace(/\{\{hidden\}\}/g,d?'style="display:none;"':"").replace(/\{\{allOption\}\}/g,t.allowAllOption),$(".bh-advancedQuery-groupList",c).html(p),c},c=function(e,t){var a=[],i=e.$advanced.data("easyarray"),n=(e.$advanced.data("modalarray"),[]);if("easy"==e.searchModel){var o=$(".bh-advancedQuery-quick-search-wrap input",e.$advanced).val();if(""!=$.trim(o))if(t){var l=p(t,i);a.push({caption:l.caption,name:l.name,value:o,builder:"include",linkOpt:"AND"})}else{for(var r=0;r<i.length;r++)n.push({caption:i[r].caption,name:i[r].name,value:o,builder:"include",linkOpt:"OR"});a.push(n)}a=a.concat(h($("[bh-advanced-query-role=quickSearchForm]",e.$advanced)))}else if("advanced"==e.searchModel){var s=$(".bh-rules-block",e.$advanced);$(".bh-rules-row",s).each(function(){var e=[],t=$(".bh-tag",$(this));t.length>0&&(t.each(function(){var t=$(this).data("data");t.linkOpt="and",e.push(t)}),e[0].linkOpt="or",a.push(e))})}return JSON.stringify(a)},h=function(e){for(var t=[],a=$("[xtype]",e),i=0;i<a.length;i++){var n={};switch($(a[i]).attr("xtype")){case"radiolist":n.value=$("input[type=radio]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"checkboxlist":n.value=$("input[type=checkbox]:checked",a[i]).map(function(){return $(this).val()}).get().join(",");break;case"tree":n.value=$(a[i]).emapDropdownTree("getValue");break;case"buttonlist":n.value=$(".bh-label-radio.bh-active",a[i]).data("id");break;default:n.value=$(a[i]).val()}"ALL"!=n.value&&""!=$.trim(n.value)&&(n.name=$(a[i]).data("name"),n.caption=$(a[i]).data("caption"),n.builder=$(a[i]).data("builder"),n.linkOpt="AND",t.push(n))}return t},p=function(e,t){for(var a=0;a<t.length;a++)if(t[a].name==e)return t[a]},l=function(e,t){var a=e.$advanced.data("modalarray"),i=e.data.builderLists.cbl_String,n=$("[rules-role=editorInput1]",t).jqxDropDownList({placeHolder:"选择查询项目...",width:200,source:a,displayMember:"caption",filterable:!0,searchMode:"containsignorecase",filterPlaceHolder:"请查找",valueMember:"name"}),o=$("[rules-role=editorInput2]",t).jqxDropDownList({placeHolder:"选择条件...",width:100,source:i,filterable:!0,searchMode:"containsignorecase",displayMember:"caption",filterPlaceHolder:"请查找",valueMember:"name"}),l=void 0;if(x[0]){n.val(x[0]);var r=$(".bh-rules-input-wrap3",t),s=e.data.controls.filter(function(e){return e.name==x[0]})[0];o.jqxDropDownList({source:e.data.builderLists[s.builderList]}),o.val(x[1]),r.html(m(s)).emapFormInputInit({defaultOptions:{tree:{unblind:"/"}}}),l=$("[xtype]",r),l.attr("rules-role","editorInput3");var d={},c=l.data("name");d[c+"_DISPLAY"]=x[3],d[c]=x[2],WIS_EMAP_INPUT.setValue(l,c,l.attr("xtype"),d)}u(e,t),x=[]},r=function(e,t,a,i){var n=$('<div style="display: none" id="bhRulesPopover">'+e.editorHtml+"</div>");$("body").append(n);var o=document.documentElement.clientWidth,r=$(a).offset().left,s=728,d=0;24>r-s/2&&(d=Math.abs(r-s/2-24)),r+s/2>o-24&&(d=o-100-r-s/2);var c=$(a).offset().top,p="bottom";window.scrollY+document.documentElement.clientHeight-c<200&&(p="top"),n.jqxPopover({offset:{left:d,top:0},arrowOffsetValue:-d,showArrow:!1,autoClose:!0,isModal:!0,title:t,selector:a,position:p}),l(e,$("#bhRulesPopover")),setTimeout(function(){n.jqxPopover("open");var e=$("#bhRulesPopover");e.on("close",function(){$(document).off("click.bhRules.stop"),$("div[rules-role=editorInput1],div[rules-role=editorInput2],div[rules-role=editorInput3]",e).jqxDropDownList("destroy"),$(this).jqxPopover("destroy")}).on("click","[rules-role=editorCloseBtn]",function(){e.jqxPopover("close")}).on("click","[rules-role=editorAddBtn]",function(t){i(t,e)!==!1&&e.jqxPopover("close")}),$(document).on("click.bhRules.stop",".jqx-listbox, .jqx-calendar, .jqx-dropdownbutton-popup",function(e){e.stopPropagation()})},0)},s=function(e){if(f(e)){var t=$("[rules-role=editorInput1]",e).jqxDropDownList("getSelectedItem"),a=$("[rules-role=editorInput2]",e).jqxDropDownList("getSelectedItem"),i=$(".bh-rules-input-wrap3 [xtype]",e),n=i.val(),o={caption:t.label,name:t.value,builder:a.value,builder_display:a.label,value:n};return"select"==i.attr("xtype")?o.value_display=i.jqxDropDownList("getSelectedItem").label:"multi-select"==i.attr("xtype")?(o.value_display=i.jqxComboBox("getSelectedItems").map(function(e){return e.label}).join(","),o.value=i.jqxComboBox("getSelectedItems").map(function(e){return e.value}).join(",")):"multi-select2"==i.attr("xtype")?(o.value_display=i.jqxDropDownList("getCheckedItems").map(function(e){return e.label}).join(","),o.value=i.jqxDropDownList("getCheckedItems").map(function(e){return e.value}).join(",")):("tree"==i.attr("xtype")||"multi-tree"==i.attr("xtype"))&&(o.value_display=i.emapDropdownTree("getText"),o.value=i.emapDropdownTree("getValue")),o}return!1},f=function(e){var t=$("[rules-role=editorInput1]",e),a=$("[rules-role=editorInput2]",e),i=$(".bh-rules-input-wrap3",e);return t.val()?a.val()?$("[xtype]",i).val()?!0:($("[xtype]",i).addClass("bh-error"),!1):(a.addClass("bh-error"),!1):(t.addClass("bh-error"),!1)},u=function(e,t){var a=$("[rules-role=editorInput1]",t),i=$("[rules-role=editorInput2]",t),n=$(".bh-rules-input-wrap3",t);$("[xtype]",n);a.on("select",function(t){var o=t.args.item.value,l=e.data.controls.filter(function(e){return e.name==o})[0];a.val()&&a.removeClass("bh-error"),i.jqxDropDownList({source:e.data.builderLists[l.builderList]}),i.jqxDropDownList("selectIndex",0),n.html(m(l)).emapFormInputInit({defaultOptions:{tree:{unblind:"/",search:!0}}}),$("[xtype]",n).attr("rules-role","editorInput3")}),i.on("select",function(){i.val()&&i.removeClass("bh-error");var t=e.data.controls.filter(function(e){return e.name==a.val()})[0];$.inArray(t.xtype,["select","radiolist","checkboxlist"])>-1&&$.inArray($(this).val(),["m_value_include","m_value_equal","m_value_not_include","m_value_not_equal"])>-1?(t=JSON.parse(JSON.stringify(t)),t.get=function(e){return void 0!==this["search."+e]?this["search."+e]:this[e]},t.xtype="multi-select2",n.empty(),n.html(m(t)).emapFormInputInit({defaultOptions:{tree:{unblind:"/",search:!0}}})):"multi-select2"==$("[xtype]",n).attr("xtype")?(n.empty(),n.html(m(t)).emapFormInputInit({defaultOptions:{tree:{unblind:"/",search:!0}}})):$.inArray($(this).val(),["m_value_include","m_value_equal","m_value_not_include","m_value_not_equal"])>-1&&"tree"==t.xtype?(t=JSON.parse(JSON.stringify(t)),t.get=function(e){return void 0!==this["search."+e]?this["search."+e]:this[e]},t.xtype="multi-tree",n.empty(),n.html(m(t)).emapFormInputInit({defaultOptions:{"multi-tree":{unblind:"/",search:!0}}})):"multi-tree"==$("[xtype]",n).attr("xtype")&&(n.empty(),n.html(m(t)).emapFormInputInit({defaultOptions:{tree:{unblind:"/",search:!0}}}))}),n.on("select, input","[xtype]",function(){$(this).val()&&$(this).removeClass("bh-error")})},m=function(e){var t=WIS_EMAP_SERV.getAttr(e),a="";switch(t.xtype=t.xtype?t.xtype:"text",("checkboxlist"==t.xtype||"radiolist"==t.xtype)&&(t.xtype="select"),t.xtype){case void 0:case"text":t.xtype="text",a='<input class="bh-form-control" data-type="{{dataType}}" data-name="{{name}}" name="{{name}}" xtype="{{xtype}}" type="{{xtype}}" {{checkType}}  {{dataSize}} {{checkSize}} {{checkExp}} '+(t.inputReadonly?"readOnly":"")+"  />";break;case"textarea":a='<textarea xtype="{{xtype}}" data-type="{{dataType}}" class="bh-form-control" rows="3" data-name="{{name}}" {{checkType}} {{dataSize}} {{checkSize}} {{checkExp}} '+(t.inputReadonly?"readOnly":"")+" ></textarea>";break;case"selecttable":case"select":case"tree":case"multi-tree":case"date-local":case"date-ym":case"date-full":case"switcher":case"uploadfile":case"uploadphoto":case"uploadsingleimage":case"uploadmuiltimage":case"buttonlist":case"multi-select":case"multi-select2":case"div":a='<div xtype="{{xtype}}" data-type="{{dataType}}" data-name="{{name}}" {{url}} {{format}} {{checkType}} {{JSONParam}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"radiolist":a='<div xtype="{{xtype}}" data-type="{{dataType}}" class="bh-radio jqx-radio-group" data-name="{{name}}" {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>';break;case"checkboxlist":a='<div xtype="{{xtype}}" data-type="{{dataType}}" class="bh-checkbox" data-name="{{name}}" {{checkType}} {{url}} {{checkSize}} data-disabled={{inputReadonly}}></div>'}return a=a.replace(/\{\{xtype\}\}/g,t.xtype).replace(/\{\{name\}\}/g,t.name).replace(/\{\{dataType\}\}/g,t.dataType).replace(/\{\{inputReadonly\}\}/g,t.inputReadonly),a=a.replace(/\{\{url\}\}/g,t.url?'data-url="'+t.url+'"':""),a=a.replace(/\{\{format\}\}/g,t.format?'data-format="'+t.format+'"':""),a=a.replace(/\{\{JSONParam\}\}/g,t.JSONParam?'data-jsonparam="'+encodeURI(JSON.stringify(t.JSONParam))+'"':""),a=a.replace(/\{\{checkType\}\}/g,t.checkType?'data-checktype="'+encodeURI(JSON.stringify(t.checkType))+'"':""),a=a.replace(/\{\{dataSize\}\}/g,t.dataSize?'data-size="'+t.dataSize+'"':""),a=a.replace(/\{\{checkSize\}\}/g,t.checkSize?'data-checksize="'+t.checkSize+'"':""),a=a.replace(/\{\{checkExp\}\}/g,t.checkExp?"data-checkexp="+encodeURI(t.checkExp):"")},b=function(e){var t=$('<label class="bh-tag"><span class="bh-tag__txt" rules-role="tagTxt"></span><a rules-role="closeTag" href="javascript:void(0)"><i class="iconfont icon-close"></i></a></label>');return t.data("data",e),$("span",t).text('"'+e.caption+'" '+e.builder_display+' "'+(e.value_display?e.value_display:e.value)+'"'),t},v=function(e,t,a){var i=$("[rules-role=addAndBtn]",a);i.before(e.andSpan).before(b(t)),$.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter()},g=function(e,t){var a=$('<div class="bh-rules-row"><div class="bh-rules-row-indent">或</div><a rules-role="addAndBtn" href="javascript:void(0)">+ 新增[且]条件</a></div>');$("[rules-role=addAndBtn]",a).before(b(t)),$("[rules-role=addOrRow]",e.$advanced).before(a),y(e)},y=function(e){var t=e.$advanced,a=$(".bh-rules-row",t);a.each(function(e){e>0&&$(this).css("margin-left",20*(e-1))}),$.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter()},t.editorHtml='<div class="bh-rules-editor bh-clearfix bh-mb-16"><div class="bh-rules-input-wrap"><div rules-role="editorInput1"></div></div><div class="bh-rules-input-wrap"><div rules-role="editorInput2"></div></div><div class="bh-rules-input-wrap bh-rules-input-wrap3"><input rules-role="editorInput3" class="bh-form-control" type="text" placeholder="多值请用逗号隔开"></div><div class="bh-rules-input-wrap bh-rules-input-wrap4"><a class="bh-btn bh-btn-small bh-btn-primary" rules-role="editorAddBtn"><i class="iconfont icon-check" style="margin-right: 0;"></i></a><a class="bh-btn bh-btn-small bh-btn-default" rules-role="editorCloseBtn"><i class="iconfont icon-close" style="margin-right: 0;"></i></a></div></div>',t.andSpan='<span class="bh-rules-and-text">且</span>',t.orSpan='<span class="bh-rules-or-text">或</span>',t.tag='<label class="bh-tag"><span class="bh-tag__txt" rules-role="tagTxt"></span><a rules-role="closeTag" href="javascript:void(0)"><i class="iconfont icon-close"></i></a></label>',e.css({position:"relative","z-index":358}).html('<div class="bh-advancedQuery bh-mb-16" bh-advanced-query-role="advancedQuery"><div class="bh-advancedQuery-dropDown "><div class="" style="display: table-cell"><div class="bh-advancedQuery-form" bh-advanced-query-role="advanceSearchForm" ><div class="bh-rules-container"><div class="bh-rules-header bh-clearfix"><h4><i class="iconfont icon-search"></i>条件构造器</h4></div><div class="bh-rules-body">'+t.editorHtml+'<div class="bh-rules-block"><div class="bh-rules-row" rules-role="addOrRow"><div class="bh-rules-row-indent"></div><a rules-role="addOrBtn" href="javascript:void(0)">+ 新增[或]条件</a></div></div></div></div><div class="bh-advancedQuery-form-row bh-advancedQuery-form-btn-row bh-advancedQuery-h-28" bh-advanced-query-role="dropDownBtnWrap"> <div class="bh-advancedQuery-groupList"><a class="bh-btn bh-btn-primary" bh-advanced-query-role="advancedSearchBtn">执行条件搜索</a><a class="bh-mh-4" bh-advanced-query-role="advancedClose" href="javascript:void(0)">[关闭条件构造器]</a></div></div></div></div></div><div class="bh-advancedQuery-quick"><div class="bh-advancedQuery-inputGroup bh-clearfix"><div class="bh-advancedQuery-quick-search-wrap" ><input type="text" class="bh-form-control"/><i class="iconfont icon-search" style="position: absolute;left: 6px;top: 6px;"></i></div><a class="bh-btn bh-btn bh-btn-primary bh-btn-small" bh-advanced-query-role="easySearchBtn">搜索</a><a href="javascript:void(0);" class="bh-mh-8" bh-advanced-query-role="advancedOpen">[条件构造器]</a></div><div class="bh-advancedQuery-form bh-mt-8" bh-advanced-query-role="quickSearchForm"></div></div></div>'),t.$advanced=$("div[bh-advanced-query-role=advancedQuery]",e).css({overflow:"hidden"}),t.guid=F,"advanced"==t.searchModel&&t.$advanced.addClass("bh-active"),$("body").append('<div class="bh-advancedQuery-quick-select" bh-advanced-query-role="advancedEasySelect" data-guid="'+F+'" ></div>'),t.formType&&e.addClass("bu-rules-form-type");var I="";i(t),$(A).each(function(e){var a=A.indexOf(this);return this.get("hidden")?(A.splice(a,1),!0):(this.xtype&&"text"!=this.xtype?t._initCount++:I+=this.caption+"/",void(this.quickSearch&&(this.xtype&&"text"!=this.xtype?k.push(this):w.push(this))))}),$("[bh-advanced-query-role=advancedInput]",e).attr("placeholder",I.substr(0,I.length-1)),t.$advanced.data("modalarray",A),t.$advanced.data("easyarray",w),t.$advanced.data("quickarray",k),"easy"==t.searchModel&&(t._initCount=k.length),0==w.length&&0==k.length,n(w,t),k=JSON.parse(JSON.stringify(k)),$("[bh-advanced-query-role=quickSearchForm]",t.$advanced).html(o(k)).emapFormInputInit({root:"",defaultOptions:{tree:{unblind:"/"}}}),l(t,$(".bh-rules-editor",e))},$.fn.emapRulesConstructor=function(t,a){var i;return i=this.data("plugin"),i?t===!0?i:"string"===$.type(t)?i[t](a):this:this.each(function(){return $(this).data("plugin",new e(this,t))})},$.fn.emapRulesConstructor.defaults={allowAllOption:!0,defaultItem:[],searchModel:"easy",formType:!1}}.call(this),function(){function e(e,t){o(t),i(e,t)}function t(e,t){var a=$.Deferred();return $.ajax({type:"post",data:t,url:e,dataType:"json"}).done(function(e){a.resolve(e)}).fail(function(e){a.reject(e)}),a.promise()}var a,i,n,o;a=function(){function a(t,a){this.options=$.extend({},$.fn.emapSchema.defaults,a),this.$element=$(t),e(this.$element,this.options)}return a.prototype.destroy=function(){this.options=null,$(this.$element).data("emapSchema",!1).empty()},a.prototype.saveSchema=function(){var e=$.Deferred(),a=arguments[0][0],i=arguments[0][1],n=arguments[0][2]?1:0,o=this.options;this.$element;return""!=a?(t(o.contextPath+"/sys/emapcomponent/schema/save.do",{condition:i,schemaName:a,schemaType:o.schemaType,pageFlag:o.pageFlag,fixed:n}).done(function(t){t.success&&$.bhTip&&$.bhTip({content:"保存成功",state:"success",iconClass:"icon-check"}),e.resolve(t)}).fail(function(t){$.bhTip&&$.bhTip({content:"保存失败",state:"danger",iconClass:"icon-close"}),e.reject(t)}),e.promise()):void 0},a.prototype.getSchemaList=function(){var e,t=this.options,a=this.options.pageFlag,i=this.options.schemaType;return $.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/schema/getList.do",async:!1,data:{schemaType:i,pageFlag:a}}).done(function(t){t.success&&(e=t.data)}),e},a.prototype.deleteSchema=function(e){var t=this.options,a=!1;return $.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/schema/deleteSingle.do",async:!1,data:{schemaName:e,schemaType:t.schemaType,pageFlag:t.pageFlag}}).done(function(e){e.success&&($.bhTip&&$.bhTip({content:"删除成功",state:"success",iconClass:"icon-check"}),a=!0)}),a},a}(),o=function(e){var t=location.hash.replace(/\/|#/g,""),a=e.data.modelName||e.customModelName;e.pageFlag=t+","+a},i=function(e,t){},n=function(e,t){var a=$(".bh-schema-btn-wrap",e);$(".bh-schema-name-input",a).val(),a.removeClass("active")},$.fn.emapSchema=function(e,t){var i;return i=$(this).data("emapSchema"),i?e===!0?i:"string"===$.type(e)?i[e](t):this:this.each(function(){return"destroy"==e?this:$(this).data("emapSchema",new a(this,e))})},$.fn.emapSchema.defaults={}}.call(void 0),function(e,t){var a=["7Z","AAC","ASP","AVI","BAT","BMP","CAD","CSS","DOC","DOCX","EXE","FLV","GIF","HTML","ISO","JAVA","JAR","JPEG","JPG","MOV","MP3","MP4","MPEG","PHP","PNG","PPT","PPTX","PSD","RAR","RMVB","SVG","SWF","BT","TXT","XLS","XLSX","ZIP"];e.getFileInfoByName=function(e){var t=e.substring(e.lastIndexOf(".")+1);return t=t.toUpperCase(),a.indexOf(t)>-1?{tag:t,text:t}:{tag:"unknown",text:"???"}},e._sortModel=function(e){for(var t=[],a=0;a<e.length;a++){var i=t.filter(function(t){return t.groupName==e[a].groupName});0==i.length?t.push({groupName:e[a].groupName,items:[e[a]]}):i[0].items.push(e[a])}return t},e.getPageMeta=function(t,a){var a=$.extend({"*json":"1"},a),i=BH_UTILS.doSyncAjax(e.getAbsPath(t),a);return window._EMAP_PageMeta=window._EMAP_PageMeta||{},window._EMAP_PageMeta[t]=i,"undefined"!=typeof i.loginURL&&(window._EMAP_PageMeta={}),i},e.getModel=function(t,a,i,n){var o,l=this.getPageMeta(t,n);if("search"==i){var r=e.getAbsPath(t).replace(".do","/"+a+".do");l=BH_UTILS.doSyncAjax(r,$.extend({"*searchMeta":"1"},n)),o=l.searchMeta}else{var s=l.models.filter(function(e){return e.name==a});o=s[0]}return e.modelName=o.modelName,e.appName=o.appName,e.url=o.url,e.name=o.name,this.convertModel(o,i)},e.convertModel=function(e,a){return e===t||null==e?t:a===t?e.controls:(e.controls.map(function(e){e.get=function(e){return this[a+"."+e]!==t&&""!==this[a+"."+e]?this[a+"."+e]:this[e]}}),"search"==a?e:e.controls)},e.getData=function(a,i,n){window._EMAP_PageMeta=window._EMAP_PageMeta||{};var o=window._EMAP_PageMeta[a];o===t&&(o=this.getPageMeta(a));var l=o.models.filter(function(e){return e.name==i}),r=a.substring(0,a.indexOf("/"))+"/"+l[0].url,s=BH_UTILS.doSyncAjax(e.getAbsPath(r),n);return s===t||null==s?(s={code:0,msg:"没有数据",datas:{}},{rows:[]}):(s.result!==t&&s.result.datas!==t&&(s=s.result),s.datas[i])},e.getCode=function(e,a,i,n,o){var l={};a&&(l.id=a),i&&(l.name=i),n&&(l.pid=n),o&&(l.searchValue=o);var r=BH_UTILS.doSyncAjax(e,l);return r===t||null==r?t:r.datas.code.rows},e.buildCodeSearchParam=function(e,t){if($.isArray(e)){for(var a=e,i=[],n=a.length-1;n>=0;n--)i.push({name:a[n].name,value:a[n].value,linkOpt:"and",builder:"equal"});return{searchValue:JSON.stringify(i)}}return{searchValue:JSON.stringify([{name:e,value:t,linkOpt:"and",builder:"equal"}])}},e.getContextPath=function(){var e=window.location.pathname,t=e.indexOf("/sys/");return e.substring(0,t)||"/emap"},e.getAppPath=function(){var t=window.location.pathname,a=t.indexOf("/sys/")+"/sys/".length,i=t.substring(a,t.length),n=i.substring(0,i.indexOf("/"));return e.getContextPath()+"/sys/"+n},e.getAbsPath=function(t){if("http://"==t.substring(0,7)||"https://"==t.substring(0,8))return t;"/"==t.substring(0,1)&&(t=t.substring(1,t.length));var a=(t.match(/module*(.*?)\//),e.getAppPath()+"/"+t);return a},e.batchDownloadFiles=function(e){if(e){$("body").append('<form method="post" class="bh-hide"></form>');var a=$("form").last(),i=$.type(e.tokens);a.attr("action",(e.contextPath||"..")+"/sys/emapcomponent/file/getFileBatchByTokenArray.do"),e.imageSize&&a.append('<input type="hidden" name="imageSize" value="'+e.imageSize+'"/>'),e.nameType&&a.append('<input type="hidden" name="nameType" value="'+e.nameType+'"/>'),e.zipName!==t&&null!==e.zipName&&a.append('<input type="hidden" name="zipName" value="'+e.zipName+'"/>'),"array"===i&&(a.append('<input type="hidden" name="fileTokenArray" value="'+e.tokens.join(",")+'"/>'),a.submit()),"string"===i&&(a.append('<input type="hidden" name="fileTokenArray" value="'+e.tokens+'"/>'),
a.submit()),a.remove()}},e._html2Escape=function(e){return e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]})},e.getAttr=function(e){return{xtype:e.get("xtype"),dataType:e.get("dataType"),caption:e.get("caption"),col:e.get("col")?e.get("col"):1,url:e.get("url"),name:e.get("name"),hidden:e.get("hidden"),placeholder:e.get("placeholder")?e.get("placeholder"):"",inputReadonly:e.get("readonly")?!0:!1,required:e.get("required")?"bh-required":"",checkType:e.get("checkType")?e.get("checkType"):!1,checkSize:e.get("checkSize"),dataSize:e.get("dataSize")?e.get("dataSize"):99999,checkExp:e.get("checkExp"),JSONParam:e.get("JSONParam")?e.get("JSONParam"):"{}",format:e.get("format"),defaultValue:e.get("defaultValue"),optionData:e.get("optionData")}},e.inputSetValue=function(a,i,n){n.readonly?(n.formValue=a,i.find("[xtype]").each(function(){function i(e,t){null!=e&&l.text(e).attr("title",e).data("value",t)}var o=$(this).data("name"),l=$(this),r=null;if(a[o]!==t&&null!==a[o])switch($(this).attr("xtype")){case"multi-select":case"select":a[o+"_DISPLAY"]?i(a[o+"_DISPLAY"],a[o]):e._getInputOptions(l.data("url"),function(e){l.data("model",e);var t=a[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),i(n.join(","),a[o])});break;case"multi-select2":break;case"radiolist":a[o+"_DISPLAY"]?i(a[o+"_DISPLAY"],a[o]):e._getInputOptions(l.data("url"),function(e){l.data("model",e),$(e).each(function(){return this.id==a[o]?(r=this.name,!1):void 0})});break;case"checkboxlist":a[o+"_DISPLAY"]?i(a[o+"_DISPLAY"],a[o]):e._getInputOptions(l.data("url"),function(e){l.data("model",e);var t=a[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),i(n.join(","),a[o])});break;case"tree":a[o+"_DISPLAY"]?i(a[o+"_DISPLAY"],a[o]):e._getInputOptions(l.data("url"),function(e){l.data("model",e);var t=a[o].split(","),n=[];$(e).each(function(){$.inArray(this.id,t)>-1&&n.push(this.name)}),i(n.join(","),a[o])});break;case"uploadfile":$(this).emapFileDownload($.extend({},{contextPath:n.root,token:a[o]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadsingleimage":case"uploadmuiltimage":$(this).emapFileDownload($.extend({},{model:"image",contextPath:n.root,token:a[o]},JSON.parse(decodeURI($(this).data("jsonparam")))));break;case"uploadphoto":$(this).emapFilePhoto("destroy"),$(this).emapFilePhoto($.extend({},{token:a[o],contextPath:n.root},JSON.parse(decodeURI($(this).data("jsonparam"))))),$("a",this).hide();break;case"switcher":a[o+"DISPLAY"]=parseInt(a[o])?"是":"否",i(a[o+"DISPLAY"],a[o]);break;default:i(a[o])}})):i.find("[xtype]").each(function(){var e=$(this).data("name"),i=$(this),o=i.attr("xtype");"t"==n.model&&i.hasClass("bh-form-static")&&null!=a[e]&&(a[e+"_DISPLAY"]!==t&&null!==a[e+"_DISPLAY"]?i.text(a[e+"_DISPLAY"]).attr("title",a[e+"_DISPLAY"]).data("value",a[e]):i.text(a[e]).attr("title",a[e])),a===t||a[e]!==t&&null!==a[e]&&WIS_EMAP_INPUT.setValue(i,e,o,a,n.root)})},e._getIconImgClass=function(e){var t="",a=e.split(".").pop();switch(a){case"docx":t="icon-wenjiangeshidoc";break;case"doc":t="icon-wenjiangeshidoc";break;case"pdf":t="icon-wenjiangeshipdf";break;case"rar":t="icon-wenjiangeshirar";break;case"txt":t="icon-wenjiangeshitxt";break;case"xls":t="icon-wenjiangeshixls";break;case"xlsx":t="icon-wenjiangeshixls";break;case"zip":t="icon-wenjiangeshizip";break;default:t="icon-wenjian"}return t},e._resetPageFooter=function(){$.bhPaperPileDialog&&($.bhPaperPileDialog.resetPageFooter(),$.bhPaperPileDialog.resetDialogFooter())},e.toDateStp=function(e){if(!e)return!1;var t=new Date,a=e.toString().split(" "),i=a[0].split("-");if(t.setFullYear(i[0]),t.setMonth(i[1]-1),i[2]?t.setDate(i[2]):t.setDate(0),t.setMilliseconds(0),a.length>1){var n=a[1].split(":");n[0]?t.setHours(i[0]):t.setHours(0),n[1]?t.setMinutes(i[1]):t.setMinutes(0),n[2]?t.setSeconds(i[2]):t.setSeconds(0)}return parseInt(t.getTime()/1e3)},window.WIS_CONFIG==t||WIS_CONFIG.ROOT_PATH!==t&&""!=WIS_CONFIG.ROOT_PATH||(WIS_CONFIG.ROOT_PATH=e.getAppPath()),e._getAttr=function(t){e.getAttr(t)},e._setEditControlValue=function(e,t,a,i,n){WIS_EMAP_INPUT.setValue(e,t,a,i,n)},e._getInputOptions=function(e,t){WIS_EMAP_INPUT.getInputOptions(e,t)}}(window.WIS_EMAP_SERV=window.WIS_EMAP_SERV||{}),function(){var e,t,a,i="FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapSingleImageUpload.defaults,a),this.$element=$(e),t(this.$element,this.options)}e.prototype.getFileToken=function(){return 0==this.$element.emapSingleImageUpload("getFileNum")?"":this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.getFileUrl=function(){return this.options.fileInput.emapUploadCore("getFileToken")},e.prototype.saveTempFile=function(){return this.options.fileInput.emapUploadCore("saveTempFile")},e.prototype.getFileNum=function(){return $(".bh-file-img-container.saved, .bh-file-img-container.success",this.$element).length},e.prototype.destroy=function(){$(this.$element).off("click"),this.options=null,$(this.$element).data("plugin",!1).empty()},a=function(e){return e.size<1024?e.size+"K":parseInt(e.size/1024*100)/100+"M"},t=function(e,t){var n=parseInt(t.width)-6,o=parseInt(t.height)-6;$(e).addClass("bh-clearfix").append('<p class="bh-file-img-info"></p><div class="bh-file-img-container" style="width: '+t.width+'px;"><div class="bh-file-img-input bh-file-img-block bh-file-img-single-block" style="width: '+t.width+"px;height: "+t.height+'px;"><span class="bh-file-img-single-info"><span class="bh-file-img-plus">+</span><span class="bh-file-img-text">点击上传</span></span><input type="file"><div class="bh-file-img-loading" style="line-height: '+o+'px;">上传中...</div><div class="bh-file-img-fail"></div><div class="bh-file-img-table" style="width: '+n+"px;height: "+o+'px;"><span style="width: '+n+"px;height: "+o+'px;"><img style="max-width: '+n+"px;max-height: "+o+'px;" /></span></div></div><div class="bh-file-img-single-edit"><a href="javascript:void(0)" class="bh-file-img-retry">重新上传</a><a href="javascript:void(0)" class="bh-file-img-delete">删除</a></div></div>'),9==document.documentMode&&$(".bh-file-img-retry",e).hide();var l="请上传图片";t.type&&t.type.length>0&&(l+=", 支持"+t.type.join(",").toUpperCase()+"类型"),t.size&&t.size>0&&(l+=",大小在"+a(t)+"以内"),$(".bh-file-img-info",e).html(l),t.height<=100&&$(".bh-file-img-text",e).hide(),t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",success:function(t){if(t.success&&t.items&&t.items.length>0){var a=$(".bh-file-img-container",e);$(".bh-file-img-table img",a).attr("src",t.items[0].fileUrl),a.addClass("saved").data({fileid:t.items[0].id})}e.trigger("bh.file.upload.done",t)}}),t.fileInput=$("input[type=file]",e).parent(),t.fileInput.emapUploadCore($.extend({},t,{isSingle:"1",add:function(a,i){i.files[0];$(".bh-file-img-container",e).addClass("loading"),t.add&&t.add(a,i),i.submit()},submit:function(a,n){var o=n.files[0],l=$(".bh-file-img-container",e);return t.type&&t.type.length>0&&!new RegExp((t.type.join("|")+"$").toUpperCase()).test(o.name.toUpperCase())?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件类型不正确"),!1):i&&t.size&&o.size/1024>t.size?(l.removeClass("loading").addClass("error").find(".bh-file-img-fail").html("文件大小超出限制"),!1):(l.data("xhr",n),void(t.submit&&t.submit(a,n)))},done:function(a,i){var n=(i.files[0],$(".bh-file-img-container",e));n.removeClass("loading").addClass("success"),t.tempUpload=!0,$("img",n).attr("src",i.result.tempFileUrl),n.data({fileid:i.result.id,deleteurl:i.result.deleteUrl}),t.done&&t.done(a,i),e.trigger("bh.file.upload.done",i)},fail:function(a,i){var n=(i.files[0],$(".bh-file-img-container",e));n.removeClass("loading").addClass("error").find(".bh-file-img-fail").html(i.result.error?i.result.error:"上传失败"),t.fail&&t.fail(a,i)}})),$(e).on("click",".bh-file-img-delete",function(){var e=$(this).closest(".bh-file-img-container");e.hasClass("success")?t.fileInput.emapUploadCore("deleteTempFile",e.data("fileid")).done(function(t){t.success&&(e.removeClass("success"),$(".bh-file-img-table img",e).attr("src",""))}):e.hasClass("error")?e.removeClass("error"):e.hasClass("loading")?(e.data("xhr").abort(),e.removeClass("loading")):e.hasClass("saved")&&(t.fileInput.emapUploadCore("deleteArrAdd",e.data("fileid")),e.removeClass("saved"),$(".bh-file-img-table img",e).attr("src",""),t.tempUpload=!0)}),$(e).on("click",".bh-file-img-retry",function(){var a=$(".bh-file-img-container",e);a.hasClass("saved")?t.fileInput.emapUploadCore("deleteArrAdd",a.data("fileid")):a.hasClass("success")&&t.fileInput.emapUploadCore("tempDeleteArrAdd",a.data("fileid")),a.removeClass("saved success fail loading error"),$(".bh-file-img-table img",a).attr("src",""),9!=document.documentMode&&$("input[type=file]",a).click()}),$(e).on("click",".bh-file-img-table img",function(){return $.bhGallery?void $.bhGallery({dataSource:[{image:$(this).attr("src")}]}):void(console&&console.warn("图片轮播插件Gallery未引入"))})},$.fn.emapSingleImageUpload=function(t){var a;return a=this.data("plugin"),a?t===!0?a:"string"===$.type(t)?a[t]():void 0:this.each(function(){return"destroy"==t?this:$(this).data("plugin",new e(this,t))})},$.fn.emapSingleImageUpload.defaults={tempUpload:!1,multiple:!1,dataType:"json",storeId:"image",width:200,height:150,type:["jpg","jpeg","png"],size:0}}()}.call(this),function(e){function t(e){return e.replace(/[\u0391-\uFFE5]/g,"***").length}function a(e,t){e.toggleClass("jqx-widget",!0),e.data("jqxWidget",t)}function i(e,t){var a=this,i=a.data("we.bhTxtInput");return i?"string"==typeof e?i[e](t):void 0:(a.data("we.bhTxtInput",new n(this,e)),a)}var n=function(t,i){return this.$container=e(t),this.$inner=void 0,this.$txtArea=void 0,this.$curLen=void 0,this.options={limit:i.limit||140,name:i.name,easyCheck:i.textareaEasyCheck||!1},this.init(),a(this.$container,this),this};n.prototype.render=function(){var t=e('<div class="bh-txt-input"><textarea class="bh-txt-input__txtarea"></textarea><div class="bh-txt-input__foot"><span class="bh-txt-input__cur-len">0</span>/<span class="bh-txt-input__max-len">'+this.options.limit+"</span></div></div>");t.find(".bh-txt-input__txtarea").attr({name:this.options.name}).end().appendTo(this.$container),this.$inner=t,this.$txtArea=t.find(".bh-txt-input__txtarea"),this.$curLen=t.find(".bh-txt-input__cur-len")},n.prototype.init=function(){this.render(),this.bindEvents()},n.prototype.bindEvents=function(){var t=this;this.$container.on("input",".bh-txt-input__txtarea",e.proxy(this.inputHandler,this)),this.$txtArea.on("focus",function(){t.$inner.toggleClass("bh-txt-input--focus",!0)}).on("blur",function(){t.$inner.toggleClass("bh-txt-input--focus",!1),t.$inner.trigger("c-blur")})},n.prototype.inputHandler=function(e){this.checkLen(e.currentTarget.value)},n.prototype.checkLen=function(e){var a;a=this.options.easyCheck||this.options.textareaEasyCheck?e.length:t(e),this.$inner.toggleClass("bh-txt-input--outlen",a>this.options.limit),this.$curLen.text(a)},n.prototype.val=function(e){return arguments.length?this.setValue(arguments[0]):this.getValue()},n.prototype.getValue=function(){return e.trim(this.$txtArea.val())},n.prototype.setValue=function(e){return this.checkLen(e),this.$txtArea.val(e)},n.prototype.disabled=function(e){var t=this;t.$txtArea.prop("disabled",e),this.$inner.toggleClass("bh-txt-input--disabled",e)},n.prototype.readonly=function(e){this.$txtArea.prop("readonly",e)},e.fn.bhTxtInput=i,e.fn.bhTxtInput.prototype.constructor=n,window.BhTxtInput=n}(jQuery),function(){var e,t;"FileReader"in window;e=function(){function e(e,a){this.options=$.extend({},$.fn.emapUploadCore.defaults,a),this.$element=$(e),this.options.token&&""!=this.options.token?(this.options.scope=this.options.token.substring(0,this.options.token.length-1),this.options.newToken=!1):(this.options.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),this.options.token=this.options.scope+1,this.options.newToken=!0),this.options.arrToDelete=[],this.options.tempArrToDelete=[],this.options.uploadUrl=this.options.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+this.options.scope+"/"+this.options.token+".do",t(this.$element,this.options)}e.prototype.getFileToken=function(){return this.options.token},e.prototype.getFileUrl=function(){var e,t=this.options;return $.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",async:!1,success:function(t){t.success&&(e=$(t.items).map(function(){return this.fileUrl}).get())}}),e},e.prototype.getFileData=function(){var e,t=this.options;return $.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/getUploadedAttachment/"+t.token+".do",dataType:"json",async:!1,success:function(t){t.success&&(e=t.items)}}),e},e.prototype.deleteArrAdd=function(e){-1==this.options.arrToDelete.indexOf(e)&&this.options.arrToDelete.push(e)},e.prototype.deleteArrRemove=function(e){var t=this.options.arrToDelete.indexOf(e);t>-1&&this.options.arrToDelete.splice(t,1)},e.prototype.tempDeleteArrAdd=function(e){-1==this.options.tempArrToDelete.indexOf(e)&&this.options.tempArrToDelete.push(e)},e.prototype.tempDeleteArrRemove=function(e){var t=this.options.tempArrToDelete.indexOf(e);t>-1&&this.options.tempArrToDelete.splice(t,1)},e.prototype.saveTempFile=function(e){var t=this.options,a=this.$element,i=e||{};this.$element.emapUploadCore("deleteFormalFile"),t.tempArrToDelete&&t.tempArrToDelete.length>0&&t.tempArrToDelete.map(function(e){a.emapUploadCore("deleteTempFile",e).done(function(e){})}),i&&(i.attachmentParam=$.extend({},this.options.attachmentParam,i.attachmentParam),i.attachmentParam=JSON.stringify(i.attachmentParam));var n=!1,o={type:"post",async:!1,url:t.contextPath+"/sys/emapcomponent/file/saveAttachment/"+t.scope+"/"+t.token+".do",data:i,dataType:"json",success:function(e){e.success&&(t.arrToDelete=[],n=a.emapUploadCore("getFileUrl").length>0?t.token:"")}};if(t.arrToDelete.length){var l=[];t.arrToDelete.map(function(e){var t=e.replace(/_[1|2]$/g,"");l.push(t),l.push(t+"_1"),l.push(t+"_2")}),o.data.widsOfAttsToDelete=l.join(",")}return $.ajax(o),n},e.prototype.deleteFormalFile=function(e){function t(e){e=e.replace(/_[1|2]$/g,"");var t=[e,e+"_1",e+"_2"];t.map(function(e){$.ajax({type:"post",async:!1,url:a.contextPath+"/sys/emapcomponent/file/deleteFileByWid/"+e+".do",dataType:"json",success:function(e){}})})}var a=this.options;if(e)t(e);else{var i=this.options.arrToDelete;if(i.length>0)for(var n=0;n<i.length;n++)t(i[n])}},e.prototype.deleteTempFile=function(e){var t=this.options,a=t.contextPath+"/sys/emapcomponent/file/deleteTempFile.do";return $.ajax({type:"post",url:a,dataType:"json",async:!1,data:{scope:t.scope,fileToken:t.token,attachId:e,attachmentParam:JSON.stringify({storeId:t.storeId,scope:t.scope,fileToken:t.token,items:[{id:e,status:"Delete"}]})}})},e.prototype.deleteFileByToken=function(){var e=this.options;$.ajax({type:"post",url:e.contextPath+"/sys/emapcomponent/file/deleteFileByToken/"+e.token+".do",async:!1,dataType:"json"}).done(function(e){})},e.prototype.destroy=function(){this.options=null,$(this.$element).data("plugin",!1).empty()},e.prototype.reload=function(){var e=this.options;e.newToken=!0,e.scope=(new Date).getTime()+""+parseInt(100*Math.random()).toString(),e.token=this.options.scope+1,e.uploadUrl=this.options.contextPath+"/sys/emapcomponent/file/uploadTempFile/"+this.options.scope+"/"+this.options.token+".do",e.arrToDelete=[],e.tempArrToDelete=[],e.attachmentParam={storeId:e.storeId,scope:e.scope,fileToken:e.token,params:e.params},$("input[type=file]",this.$element).fileupload({url:e.uploadUrl})},e.prototype.getFileBatch=function(){window.location.href=options.contextPath+"/sys/emapcomponent/file/getFileBatchByToken/"+options.token+".do"},t=function(e,t){t.newToken||$.ajax({type:"post",url:t.contextPath+"/sys/emapcomponent/file/deleteTempFile.do",async:!1,data:{scope:t.scope,fileToken:t.token},success:function(){}}),t.attachmentParam={storeId:t.storeId,scope:t.scope,fileToken:t.token,params:t.params};var a;"INPUT"==e[0].nodeName&&"file"==e[0].getAttribute("type")?a=e:(0==$("input[type=file]",e).length&&e.append('<input type="file" name="bhFile" />'),a=$("input[type=file]",e)),a.fileupload({url:t.uploadUrl,autoUpload:!0,multiple:!0,dataType:"json",limitMultiFileUploads:10,formData:{size:t.size,type:t.type,storeId:t.storeId,isSingle:"1"==t.isSingle?"1":"0",fileName:t.fileName?t.fileName:""},add:function(e,a){var i=!0;return t.add&&(i=t.add(e,a)),i===!1?!1:void a.submit()},submit:function(a,i){var n=!0;return t.submit&&(n=t.submit(a,i)),n===!1?(e.trigger("bh.file.upload.done",i),!1):void 0},done:function(a,i){i.files[0];i.result.success?(t.done&&t.done(a,i),e.trigger("bh.file.upload.done",i)):t.fail&&t.fail(a,i)},fail:function(e,a){t.fail&&t.fail(e,a)}})},$.fn.emapUploadCore=function(t,a){var i;return i=this.data("emapuploadcore"),i?t===!0?i:"string"===$.type(t)?i[t](a):void 0:this.each(function(){return"destroy"==t?this:$(this).data("emapuploadcore",new e(this,t))})},$.fn.emapUploadCore.defaults={multiple:!1,dataType:"json",storeId:"file",type:[],size:0}}()}.call(this),function(){var Plugin,_init,_getValidateCondition,_getValueLength;Plugin=function(){function e(e,t){$.fn.emapValidate.rules?$.fn.emapValidate.allRules=$.extend({},$.fn.emapValidate.defaultRules,$.fn.emapValidate.rules):$.fn.emapValidate.allRules=$.fn.emapValidate.defaultRules,this.options=$.extend({},$.fn.emapValidate.defaults,t),this.$element=$(e),_init($(e),t)}return e.prototype.validate=function(){return this.$element.jqxValidator("validate")},e.prototype.destroy=function(){return this.options=null,$(this.$element).data("validate",!1).find(".jqx-validator-error-info").remove(),this.$element.jqxValidator("destroy")},e}(),_init=function(e,t){var a=_getValidateCondition(e,t);t.callback&&t.callback(a),e.jqxValidator({useHintRender:!0,rules:a})},_getValidateCondition=function(element,options){var rules=[];return $("[xtype]",element).each(function(){var _this=$(this),itemRules;if(_this.closest(".bh-row").attr("hidden")||"none"===_this.closest(".bh-form-group").css("display")||_this.closest(".bh-form-group").hasClass("bh-disabled")||"P"==_this[0].nodeName||"div"==_this.attr("xtype"))return!0;var row=_this.closest(".form-validate-block"),name=_this.data("name"),label=$("label.bh-form-label",row).text(),xtype=_this.attr("xtype"),dataType=_this.data("type");if($(".bh-required",row).length>0){if("static"==xtype)return;itemRules={input:"[data-name="+name+"]",message:label+"不能为空",action:"change, blur, valuechanged",rule:"required"},("select"==xtype||"multi-select2"==xtype||"date-local"==xtype||"date-ym"==xtype||"date-full"==xtype||"selecttable"==xtype)&&(itemRules.rule=function(){return _this.hasClass("jqx-rc-b-expanded")?!0:""!=_this.val()}),("date-local"==xtype||"date-ym"==xtype||"date-full"==xtype)&&(itemRules.action="change, valuechanged, close"),("select"==xtype||"multi-select2"==xtype)&&(itemRules.action="change, select"),"tree"==xtype&&(itemRules.rule=function(){return""!=_this.emapDropdownTree("getValue")}),"multi-select"==xtype&&(itemRules.rule=function(){return""!=_this.jqxComboBox("getSelectedItems").map(function(e){return e.value}).join(",")}),"textarea"===xtype&&(itemRules.action="c-blur",itemRules.rule=function(){return""!=_this.bhTxtInput("getValue")}),"number-range"===xtype&&(itemRules.rule=function(){var e=_this.bhNumRange("getValue").split(",");return""!=e[0]&&""!=e[1]}),("uploadfile"==xtype||"uploadsingleimage"==xtype||"uploadmuiltimage"==xtype)&&(itemRules.action="blur",itemRules.rule=function(){return"uploadfile"==xtype?0!=_this.emapFileUpload("getFileNum"):"uploadsingleimage"==xtype?0!=_this.emapSingleImageUpload("getFileNum"):"uploadmuiltimage"==xtype?0!=_this.emapImageUpload("getFileNum"):void 0}),rules.push(itemRules)}"double"==_this.data("type")&&(rules.push({input:"[data-name="+name+"]",message:"无效的数字格式",action:"change, blur, valuechanged",rule:function(){return""===_this.val()?!0:/^\d+(\.\d+)?$/g.test(_this.val())}}),rules.push({input:"[data-name="+name+"]",message:"长度超出限制",action:"change, blur, valuechanged",rule:function(){return""==_this.val()?!0:/^\d+(\.\d+)?$/g.test(_this.val())}})),"int"==_this.data("type")&&rules.push({input:"[data-name="+name+"]",message:$.fn.emapValidate.allRules.integer.alertText,action:"change, blur, valuechanged",rule:function(){if(""==_this.val())return!0;var e=_this.val();return"switcher"==_this.attr("xtype")&&(e===!0?e=1:e===!1&&(e=0)),new RegExp($.fn.emapValidate.allRules.integer.regex).test(e)}});var maxLength=_this.data("checksize");if(maxLength||(maxLength=options.textareaEasyCheck&&"String"==dataType&&"textarea"==xtype?_this.data("size")?Math.floor(_this.data("size")/3):0:_this.data("size")?_this.data("size"):0),maxLength){if(itemRules={input:"[data-name="+name+"]",message:label+"长度超出限制",action:"change, blur, valuechanged",rule:function(){return _getValueLength(_this.val())<=maxLength}},options.textareaEasyCheck&&"textarea"==xtype&&(itemRules.message=label+"长度不能超过"+maxLength+"个字",itemRules.rule=function(){return _this.val().length<=maxLength}),("text"==xtype||!xtype)&&maxLength.toString().indexOf(",")>-1){var lengthArr=maxLength.split(",");itemRules.rule=function(){if(""==_this.val())return!0;var e=_this.val().toString().split(".");return e.length>1&&e[1].length>lengthArr[1]?!1:e[0].length<=lengthArr[0]-lengthArr[1]},rules.push({input:"[data-name="+name+"]",message:"金额类型不正确",action:"change, blur, valuechanged",rule:function(){return""==_this.val()?!0:_this.val().length<22}})}"multi-select"==xtype&&(itemRules.message="最多选择"+maxLength+"项",itemRules.rule=function(){return _this.jqxComboBox("getSelectedItems").length<=maxLength}),"multi-select2"==xtype&&(itemRules.message="最多选择"+maxLength+"项",itemRules.rule=function(){return _this.jqxDropDownList("getCheckedItems").length<=maxLength}),rules.push(itemRules)}var exp=decodeURI(_this.data("checkexp"));exp&&"undefined"!=exp&&rules.push({input:"[data-name="+name+"]",message:label+"不正确",action:"change, blur, valuechanged",rule:function(){return""==_this.val()?!0:eval(exp).test(_this.val())}}),$.inArray(xtype,["date-loacl","date-ym","date-full"])>-1&&rules.push({input:"[data-name="+name+"]",message:"日期格式不正确",action:"change, blur, valuechanged",rule:function(){return""==_this.val()?!0:!isNaN(parseInt(_this.val()))}});var jsonType=decodeURI(_this.data("jsonparam")),checkType=decodeURI(_this.data("checktype"));if(checkType&&"undefined"!=checkType||(checkType=jsonType),checkType=checkType.replace(/\[|\]|\"|\{|\}|custom/g,""),$.fn.emapValidate.allRules[checkType])itemRules={input:"[data-name="+name+"]",message:$.fn.emapValidate.allRules[checkType].alertText,action:"change, blur, valuechanged"},$.fn.emapValidate.allRules[checkType].regex?itemRules.rule=function(){return""==_this.val()?!0:new RegExp($.fn.emapValidate.allRules[checkType].regex).test(_this.val())}:$.fn.emapValidate.allRules[checkType].func&&(itemRules.rule=function(){return""==_this.val()?!0:$.fn.emapValidate.allRules[checkType].func(_this.val())}),rules.push(itemRules);else if(/^after/g.test(checkType)||/^before/g.test(checkType)){itemRules={input:"[data-name="+name+"]",action:"change, blur, valuechanged"};var formEle=_this.closest("[bh-form-role=bhForm]"),targetLabel;if(/^before/g.test(checkType)){var checkField=checkType.replace("before","");targetLabel="now"==checkField?"今天":$("[data-name="+checkField.replace("=","")+"]",formEle).data("caption"),itemRules.message=$.fn.emapValidate.allRules.before.alertText.replace("*1",label).replace("*2",targetLabel),/=/g.test(checkField)?(checkField=checkField.replace("=",""),itemRules.rule=function(){return _this.val()?$.fn.emapValidate.allRules["before="].func(_this.val(),checkField,_this.closest("[bh-form-role=bhForm]")):!0}):itemRules.rule=function(){return _this.val()?$.fn.emapValidate.allRules.before.func(_this.val(),checkField,_this.closest("[bh-form-role=bhForm]")):!0}}if(/^after/g.test(checkType)){var checkField=checkType.replace("after","");targetLabel="now"==checkField?"今天":$("[data-name="+checkField.replace("=","")+"]",formEle).data("caption"),itemRules.message=$.fn.emapValidate.allRules.after.alertText.replace("*1",label).replace("*2",targetLabel),/=/g.test(checkField)?(checkField=checkField.replace("=",""),itemRules.rule=function(){return _this.val()?$.fn.emapValidate.allRules["after="].func(_this.val(),checkField,_this.closest("[bh-form-role=bhForm]")):!0}):itemRules.rule=function(){return _this.val()?$.fn.emapValidate.allRules.after.func(_this.val(),checkField,_this.closest("[bh-form-role=bhForm]")):!0}}rules.push(itemRules)}$.inArray(checkType,["number","integer"])>-1&&rules.push({input:"[data-name="+name+"]",message:label+"长度超出限制",action:"change, blur, valuechanged",rule:function(){return _this.val().length<22}})}),rules},_getValueLength=function(e){return e.replace(/[\u0391-\uFFE5]/g,"***").length},$.fn.emapValidate=function(e){var t;return t=this.data("validate"),t?e===!0?t:"string"===$.type(e)?t[e]():this:this.each(function(){return $(this).data("validate",new Plugin(this,e))})},$.fn.emapValidate.defaults={easyCheck:!1,textareaEasyCheck:!1},$.fn.emapValidate.defaultRules=WIS_EMAP_INPUT.validateRules}.call(this);